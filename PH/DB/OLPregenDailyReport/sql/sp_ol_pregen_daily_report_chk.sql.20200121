


CREATE OR REPLACE FUNCTION sp_ol_pregen_daily_report_chk (
   in_report_code       ol_pregen_daily_report.opdr_report_code%TYPE,
   in_merchant_id       ol_pregen_daily_report.opdr_merchant_id%TYPE,
   in_ccy               ol_pregen_daily_report.opdr_currency_id%TYPE,
   in_country           ol_pregen_daily_report.opdr_country_id%TYPE,
   in_service_code      ol_pregen_daily_report.opdr_service_code%TYPE,
   in_report_date       ol_pregen_daily_report.opdr_report_date%TYPE)

RETURN NUMBER IS
        iCnt    integer := 0;

BEGIN

   IF in_report_code = 'OBS' THEN
                SELECT  COUNT(*)
                INTO    iCnt
                FROM    OL_PREGEN_DAILY_REPORT
                WHERE   OPDR_REPORT_CODE = in_report_code
                AND     OPDR_MERCHANT_ID = in_merchant_id
                AND     OPDR_CURRENCY_ID = in_ccy
                AND     OPDR_COUNTRY_ID = in_country
                AND     OPDR_SERVICE_CODE = in_service_code
                AND     OPDR_REPORT_DATE = in_report_date;

   ELSIF in_report_code IN ('DCL','DTD') THEN
                SELECT  COUNT(*)
                INTO    iCnt
                FROM    OL_PREGEN_DAILY_REPORT
                WHERE   OPDR_REPORT_CODE = in_report_code
                AND     OPDR_MERCHANT_ID = in_merchant_id
                AND     OPDR_REPORT_DATE = in_report_date;

   ELSE
                RETURN 1;
   END IF;

   IF iCnt > 0 THEN
                RETURN 0;
   ELSE
                RETURN 2;
   END IF;

EXCEPTION
   WHEN OTHERS
   THEN
      RETURN 9;
END sp_ol_pregen_daily_report_chk;
/
