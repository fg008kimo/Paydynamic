CREATE OR REPLACE FUNCTION sp_psp_detail_rpl(
	in_replicate_psp_id              psp_detail.psp_id%type,
	in_create_psp_id		         psp_detail.psp_id%type,
	in_psp_name                      psp_detail.psp_name%type,
	in_processor_name		         psp_detail.processor_name%type,
	in_create_user                   psp_detail.create_user%type,
	in_psp_merchant_id               psp_detail.psp_merchant_id%type,
	in_overrided_bank_code_channel   psp_detail.overrided_bank_code_channel%type
	)
  RETURN NUMBER IS

	iRecCnt		      	  INTEGER := 0;
	
BEGIN

	SELECT COUNT(1)
	INTO iRecCnt
	FROM psp_detail
	WHERE psp_id = in_replicate_psp_id;

	IF iRecCnt > 1 or iRecCnt = 0
	THEN
		RETURN 2;
	END IF;
  
	INSERT INTO psp_detail(
	psp_id,
	psp_name,
	processor_name,
	disabled,
	online_mode,
	psp_type,
	create_timestamp,
	create_user,
	update_timestamp,
	update_user,
	client_id,
	psp_merchant_id,
	psp_channel_code,
	txn_type,
	currency_id,
	status,
	overrided_bank_code_channel,
	pd_psp_replicate_en
	)
	SELECT in_create_psp_id, 
			in_psp_name, 
			in_processor_name,
			0,
			'Y',
			psp_type,
			sysdate,
			in_create_user,
			sysdate,
			in_create_user,
			client_id,
			in_psp_merchant_id,
			psp_channel_code,
			txn_type,
			'CNY',
			'O',
			in_overrided_bank_code_channel,
			pd_psp_replicate_en
	from psp_detail
	where psp_id = in_replicate_psp_id;
	

  IF SQL%ROWCOUNT = 0 THEN
     RETURN 1;
  ELSE
     RETURN 0;
  END IF;

EXCEPTION
  WHEN OTHERS THEN
     RETURN 9;

END sp_psp_detail_rpl;
/


