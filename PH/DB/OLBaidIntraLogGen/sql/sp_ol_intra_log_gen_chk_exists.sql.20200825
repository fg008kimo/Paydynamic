CREATE OR REPLACE FUNCTION sp_ol_intra_log_gen_chk_exists(
	in_txn_id		OL_BAID_INTRA_LOG_GEN.OALG_GEN_TXN_ID_FR%TYPE)
RETURN NUMBER IS
	v_cnt    		integer := 0;
	v_gen_txn_id_fr 	OL_BAID_INTRA_LOG_GEN.OALG_GEN_TXN_ID_FR%TYPE;
	v_gen_txn_id_to 	OL_BAID_INTRA_LOG_GEN.OALG_GEN_TXN_ID_TO%TYPE;
	v_txn_id		OL_BAID_INTRA_LOG_GEN.OALG_GEN_TXN_ID_FR%TYPE;
BEGIN

	/* Check Input Txn Id */
	select 	count(*)
	into 	v_cnt
	from  	ol_baid_intra_log_gen
       	where  	(oalg_gen_txn_id_fr = in_txn_id or oalg_gen_txn_id_to = in_txn_id)
       	and  	oalg_ret_code = 0;

	IF v_cnt = 0 THEN
		return 2;
	ELSE
		select  count(*)
             	into    v_cnt
              	from    ol_baid_intra_log_gen
               	where   (oalg_gen_txn_id_fr = in_txn_id or oalg_gen_txn_id_to = in_txn_id)
                and     (oalg_status = 'P' or oalg_status IS NULL)
              	and     oalg_ret_code = 0;

		IF v_cnt > 0 THEN
                   	return 1;
               	ELSE

			select  count(*)
        		into    v_cnt
        		from    ol_baid_intra_log_gen
        		where   (oalg_gen_txn_id_fr = in_txn_id or oalg_gen_txn_id_to = in_txn_id)
        		and	oalg_status = 'A'
			and     oalg_ret_code = 0;
		
			IF v_cnt = 0 THEN
				return 2;
			ELSIF v_cnt = 1 THEN
				select  oalg_gen_txn_id_fr,
	        	                oalg_gen_txn_id_to
	        		into    v_gen_txn_id_fr,
					v_gen_txn_id_to
	        		from    ol_baid_intra_log_gen
	        		where   (oalg_gen_txn_id_fr = in_txn_id or oalg_gen_txn_id_to = in_txn_id)
				and	oalg_status = 'A'
	        		and     oalg_ret_code = 0;	

				IF (v_gen_txn_id_fr IS NULL OR v_gen_txn_id_to IS NULL) THEN
					return 1;
				ELSE
					IF in_txn_id = v_gen_txn_id_fr THEN
						v_txn_id := v_gen_txn_id_to;
					ELSIF in_txn_id = v_gen_txn_id_to THEN
						v_txn_id := v_gen_txn_id_fr;
					END IF;
				END IF;
			ELSE 
				return 1;
			END IF;
		END IF;
	END IF;

	/* Check Corresponding Txn ID */
	select  count(*)
       	into    v_cnt
      	from    ol_baid_intra_log_gen
      	where   (oalg_gen_txn_id_fr = v_txn_id or oalg_gen_txn_id_to = v_txn_id)
       	and     (oalg_status = 'P' or oalg_status IS NULL)
      	and     oalg_ret_code = 0;

      	IF v_cnt > 0 THEN
              	return 1;
      	ELSE
		select  count(*)
            	into    v_cnt
              	from    ol_baid_intra_log_gen
               	where   (oalg_gen_txn_id_fr = v_txn_id or oalg_gen_txn_id_to = v_txn_id)
              	and     oalg_status = 'A'
              	and     oalg_ret_code = 0;

             	IF v_cnt = 1 THEN
                     	return 0;
               	ELSE
                     	return 1;
              	END IF;
	END IF;

EXCEPTION
	WHEN OTHERS THEN
		RETURN 9;

END sp_ol_intra_log_gen_chk_exists;
/
