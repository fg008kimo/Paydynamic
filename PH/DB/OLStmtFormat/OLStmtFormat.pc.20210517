/*
Partnerdelight (c)2010. All rights reserved. No part of this software may be reproduced in any form without written permission 
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2013/07/17              Stan Poon
Get update_bal in GetTxnCodeKeywords               2014/07/16              David Wong
Add GetTxnCodeKeywordsAll			   2018/05/16		   David Wong
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sqlca.h>
#include "common.h"
#include "utilitys.h"
#include "dbutility.h"
#include "OLStmtFormat.h"
#include "internal.h"

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

#define PD_DEFAULT_DATE_FORMAT          "%Y%m%d"
#define PD_DEFAULT_TIME_FORMAT          "%H%M%S"

char cDebug;

void OLStmtFormat(char cdebug)
{
	cDebug = cdebug;
}


int GetFormat(const char* csIntBankCode, recordset_t* myRec)
{
	int iRet = PD_OK;
	int iCnt = 0;

	char csFormatId[PD_FORMAT_ID_LEN + 1];
	char csCurrFormatId[PD_FORMAT_ID_LEN + 1];

	char csFormatType[PD_FORMAT_TYPE_LEN + 1];
	char csFormatValue[PD_FORMAT_VALUE_LEN + 1];

	char *csTmp;
	char *csTag = (char*) malloc (64);

	hash_t *myHash;
	myHash = (hash_t*) malloc (sizeof(hash_t));
	hash_init(myHash, 0);

	EXEC SQL WHENEVER SQLERROR GOTO getformat_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar hv_int_bank_code[PD_BANK_CODE_LEN + 1];
		varchar	v_format_id[PD_FORMAT_ID_LEN + 1];
		varchar	v_format_type[PD_FORMAT_TYPE_LEN + 1];
		int	v_format_value;
		varchar	v_cont_desc[PD_CONT_DESC_LEN + 1];
		varchar	v_cont_desc_2[PD_CONT_DESC_LEN + 1];
		varchar	v_cont_template[PD_CONT_TEMPLATE_LEN + 1];
		int	v_cont_next_lvl;

		short ind_format_id = -1;
		short ind_format_type = -1;
		short ind_format_value = -1;
		short ind_cont_desc = -1;
		short ind_cont_desc_2 = -1;
		short ind_cont_template = -1;
		short ind_cont_next_lvl = -1;
	EXEC SQL END DECLARE SECTION;

	hv_int_bank_code.len = strlen(csIntBankCode);
	strncpy((char*)hv_int_bank_code.arr, csIntBankCode, hv_int_bank_code.len);
DEBUGLOG(("GetFormat int_bank_code = [%.*s]\n", hv_int_bank_code.len, hv_int_bank_code.arr));

	EXEC SQL DECLARE getformatcursor CURSOR FOR
		SELECT	OLFT_FORMAT_ID,
			lower(OLFT_FORMAT_TYPE) OLFT_FORMAT_TYPE,
			OLFT_FORMAT_VALUE,
			OLFT_CONT_DESC,
			OLFT_CONT_DESC_2,
			OLFT_CONT_TEMPLATE,
			OLFT_CONT_NEXT_LVL
		FROM	OL_STMT_FORMAT_TEMPLATE, OL_STMT_FORMAT
		WHERE	OLSF_INT_BANK_CODE = :hv_int_bank_code
		AND	(OLFT_FORMAT_ID = OLSF_FORMAT_ID or OLFT_FORMAT_ID like OLSF_FORMAT_ID||'.%')
		AND	OLSF_DISABLED = 0
		AND	OLSF_EFFECT_TIMESTAMP <= sysdate
		ORDER BY OLSF_EFFECT_TIMESTAMP DESC, OLFT_FORMAT_ID ASC, OLFT_FORMAT_TYPE ASC, OLFT_FORMAT_VALUE ASC;

	EXEC SQL OPEN getformatcursor;
	for (;;) {
		EXEC SQL FETCH getformatcursor
		INTO	:v_format_id:ind_format_id,
			:v_format_type:ind_format_type,
			:v_format_value:ind_format_value,
			:v_cont_desc:ind_cont_desc,
			:v_cont_desc_2:ind_cont_desc_2,
			:v_cont_template:ind_cont_template,
			:v_cont_next_lvl:ind_cont_next_lvl;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		iCnt++;

/* format_id */
		if (ind_format_id >= 0) {
			v_format_id.arr[v_format_id.len] = '\0';
			strcpy(csCurrFormatId, (const char*)v_format_id.arr);
			if (iCnt == 1) {
				strcpy(csFormatId, (const char*)v_format_id.arr);
				PutField_CString(myHash, "format_id", csFormatId); //
DEBUGLOG(("GetFormat read (%s) = [%s]\n", "format_id", csFormatId));
			} else {
				csTmp = mystrtok(csCurrFormatId, ".");
				if (csTmp != NULL && strcmp(csTmp, csFormatId)) {
					RecordSet_Add(myRec, myHash);
DEBUGLOG(("GetFormat ** hash added - (format_id) = [%s]\n", csFormatId));
					myHash = (hash_t*) malloc (sizeof(hash_t));
					hash_init(myHash, 0);
					strcpy(csFormatId, (const char*)v_format_id.arr);
					PutField_CString(myHash, "format_id", csFormatId); //
DEBUGLOG(("GetFormat read (%s) = [%s]\n", "format_id", csFormatId));
				}
				strcpy(csCurrFormatId, (const char*)v_format_id.arr);
			}
		} else {
			iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetFormat format_id NOT FOUND!!!\n"));
			break;
		}

/* format_type */
		if (ind_format_type >= 0) {
			v_format_type.arr[v_format_type.len] = '\0';
			sprintf(csFormatType, "%s", (char*)v_format_type.arr);
		} else {
			iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetFormat format_type NOT FOUND!!!\n"));
			break;
		}

/* format_value - All Except CONTENT */
		if (ind_format_value >= 0) {
			sprintf(csFormatValue,"%d",v_format_value);

			if (strcmp(csFormatType,"content")) {
				if (!strcmp(csFormatType,"delimiter")) {
					sprintf(csTag, "%s_%s", csFormatType, csCurrFormatId);
				} else {
					sprintf(csTag, "%s", csFormatType);
				}
				PutField_CString(myHash, csTag, csFormatValue); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", csTag, csFormatValue));
			}
		} else {
			iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetFormat format_value NOT FOUND!!!\n"));
			break;
		}

/* cont_desc - CONTENT */
		if (ind_cont_desc >= 0) { 
			v_cont_desc.arr[v_cont_desc.len] = '\0';
			sprintf(csTag, "%s_desc_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
			PutField_CString(myHash, csTag, (const char *)v_cont_desc.arr); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", csTag, v_cont_desc.arr));

		/* cont_template - CONTENT */
			if (ind_cont_template >= 0) {
				v_cont_template.arr[v_cont_template.len] = '\0';
				if (!strcmp((char*)v_cont_desc.arr,"statement_date")) {
					PutField_CString(myHash, "DATE_FORMAT", (const char *)v_cont_template.arr); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", "DATE_FORMAT", (const char *)v_cont_template.arr));
				} else if (!strcmp((char*)v_cont_desc.arr,"statement_time")) {
					PutField_CString(myHash, "TIME_FORMAT", (const char *)v_cont_template.arr); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", "TIME_FORMAT", (const char *)v_cont_template.arr));
				}
			} else {
				if (!strcmp((char*)v_cont_desc.arr,"statement_date")) {
					PutField_CString(myHash, "DATE_FORMAT", PD_DEFAULT_DATE_FORMAT); //
DEBUGLOG(("GetFormat (%s) default = [%s]\n", "DATE_FORMAT", PD_DEFAULT_DATE_FORMAT));
				} else if (!strcmp((char*)v_cont_desc.arr,"statement_time")) {
					PutField_CString(myHash, "TIME_FORMAT", PD_DEFAULT_TIME_FORMAT); //
DEBUGLOG(("GetFormat (%s) default = [%s]\n", "TIME_FORMAT", PD_DEFAULT_TIME_FORMAT));
				}
			}
		}

/* cont_desc_2 - CONTENT */
		if (ind_cont_desc_2 >= 0) { 
			v_cont_desc_2.arr[v_cont_desc_2.len] = '\0';
			sprintf(csTag, "%s_desc_2_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
			PutField_CString(myHash, csTag, (const char *)v_cont_desc_2.arr); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", csTag, v_cont_desc_2.arr));
		}


/* cont_next_lvl - CONTENT */
		if (ind_cont_next_lvl >= 0) {
			if (v_cont_next_lvl == 1) {
				sprintf(csTag, "%s_nxlv_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
				PutField_Int(myHash, csTag, v_cont_next_lvl); //
DEBUGLOG(("GetFormat (%s) = [%d]\n", csTag, v_cont_next_lvl));

			/* cont_template - CONTENT */
				if (ind_cont_template >= 0) {
					v_cont_template.arr[v_cont_template.len] = '\0';
					sprintf(csTag, "%s_temp_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
					PutField_CString(myHash, csTag, (const char *)v_cont_template.arr); //
DEBUGLOG(("GetFormat (%s) = [%s]\n", csTag, v_cont_template.arr));

					if (strlen(csCurrFormatId) >= strlen((char*)v_cont_template.arr)) {
						iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetFormat cont_template INVALID!!!\n"));
						break;
					}
				} else {
					iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetFormat cont_template NOT FOUND!!!\n"));
				}
			}
		}

	}
	EXEC SQL CLOSE getformatcursor;

	if (iCnt > 0) {
		RecordSet_Add(myRec, myHash);
DEBUGLOG(("GetFormat ** hash added - (format_id) = [%s]\n", csFormatId));
	} else {
DEBUGLOG(("GetFormat NOT FOUND!!!\n"));
ERRLOG("OLStmtFormat::GetFormat NOT FOUND!!!\n");
		iRet = PD_ERR;
	}

	FREE_ME(csTag);

DEBUGLOG(("GetFormat Normal Exit! iRet = [%d]\n", iRet));
	return iRet;

getformat_error:
DEBUGLOG(("getformat_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
ERRLOG("OLStmtFormat getformat_error code %d\n", sqlca.sqlcode);
ERRLOG("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
	EXEC SQL CLOSE getformatcursor;
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	return PD_ERR;
}


int GetByFormatId(const char* csFormatId, recordset_t* myRec)
{
	int iRet = PD_OK;
	int iCnt = 0;

	char csCurrFormatId[PD_FORMAT_ID_LEN + 1];

	char csFormatType[PD_FORMAT_TYPE_LEN + 1];
	char csFormatValue[PD_FORMAT_VALUE_LEN + 1];

	char *csTag = (char*) malloc (64);

	hash_t *myHash;
	myHash = (hash_t*) malloc (sizeof(hash_t));
	hash_init(myHash, 0);

	strcpy(csCurrFormatId,csFormatId);
	PutField_CString(myHash, "format_id", csCurrFormatId); //

	EXEC SQL WHENEVER SQLERROR GOTO getformat_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar hv_format_id[PD_BANK_CODE_LEN + 1];
		varchar	v_format_id[PD_FORMAT_ID_LEN + 1];
		varchar	v_format_type[PD_FORMAT_TYPE_LEN + 1];
		int	v_format_value;
		varchar	v_cont_desc[PD_CONT_DESC_LEN + 1];
		varchar	v_cont_desc_2[PD_CONT_DESC_LEN + 1];
		varchar	v_cont_template[PD_CONT_TEMPLATE_LEN + 1];
		int	v_cont_next_lvl;

		short ind_format_id = -1;
		short ind_format_type = -1;
		short ind_format_value = -1;
		short ind_cont_desc = -1;
		short ind_cont_desc_2 = -1;
		short ind_cont_template = -1;
		short ind_cont_next_lvl = -1;
	EXEC SQL END DECLARE SECTION;

	hv_format_id.len = strlen(csFormatId);
	strncpy((char*)hv_format_id.arr, csFormatId, hv_format_id.len);
DEBUGLOG(("GetByFormatId format_id = [%.*s]\n", hv_format_id.len, hv_format_id.arr));

	EXEC SQL DECLARE getbyformatidcursor CURSOR FOR
		SELECT	OLFT_FORMAT_ID,
			lower(OLFT_FORMAT_TYPE) OLFT_FORMAT_TYPE,
			OLFT_FORMAT_VALUE,
			OLFT_CONT_DESC,
			OLFT_CONT_DESC_2,
			OLFT_CONT_TEMPLATE,
			OLFT_CONT_NEXT_LVL
		FROM	OL_STMT_FORMAT_TEMPLATE
		WHERE	OLFT_FORMAT_ID like :hv_format_id||'%'
		ORDER BY OLFT_FORMAT_ID ASC, OLFT_FORMAT_TYPE ASC, OLFT_FORMAT_VALUE ASC;

	EXEC SQL OPEN getbyformatidcursor;
	for (;;) {
		EXEC SQL FETCH getbyformatidcursor
		INTO	:v_format_id:ind_format_id,
			:v_format_type:ind_format_type,
			:v_format_value:ind_format_value,
			:v_cont_desc:ind_cont_desc,
			:v_cont_desc_2:ind_cont_desc_2,
			:v_cont_template:ind_cont_template,
			:v_cont_next_lvl:ind_cont_next_lvl;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		iCnt++;

/* format_type */
		if (ind_format_type >= 0) {
			v_format_type.arr[v_format_type.len] = '\0';
			sprintf(csFormatType, "%s", (char*)v_format_type.arr);
		} else {
			iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetByFormatId format_type NOT FOUND!!!\n"));
			break;
		}

/* format_value - All Except CONTENT */
		if (ind_format_value >= 0) {
			sprintf(csFormatValue,"%d",v_format_value);

			if (strcmp(csFormatType,"content")) {
				if (!strcmp(csFormatType,"delimiter")) {
					sprintf(csTag, "%s_%s", csFormatType, csCurrFormatId);
				} else {
					sprintf(csTag, "%s", csFormatType);
				}
				PutField_CString(myHash, csTag, csFormatValue); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", csTag, csFormatValue));
			}
		} else {
			iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetByFormatId format_value NOT FOUND!!!\n"));
			break;
		}

/* cont_desc - CONTENT */
		if (ind_cont_desc >= 0) { 
			v_cont_desc.arr[v_cont_desc.len] = '\0';
			sprintf(csTag, "%s_desc_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
			PutField_CString(myHash, csTag, (const char *)v_cont_desc.arr); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", csTag, v_cont_desc.arr));

		/* cont_template - CONTENT */
			if (ind_cont_template >= 0) {
				v_cont_template.arr[v_cont_template.len] = '\0';
				if (!strcmp((char*)v_cont_desc.arr,"statement_date")) {
					PutField_CString(myHash, "DATE_FORMAT", (const char *)v_cont_template.arr); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", "DATE_FORMAT", (const char *)v_cont_template.arr));
				} else if (!strcmp((char*)v_cont_desc.arr,"statement_time")) {
					PutField_CString(myHash, "TIME_FORMAT", (const char *)v_cont_template.arr); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", "TIME_FORMAT", (const char *)v_cont_template.arr));
				}
			} else {
				if (!strcmp((char*)v_cont_desc.arr,"statement_date")) {
					PutField_CString(myHash, "DATE_FORMAT", PD_DEFAULT_DATE_FORMAT); //
DEBUGLOG(("GetByFormatId (%s) default = [%s]\n", "DATE_FORMAT", PD_DEFAULT_DATE_FORMAT));
				} else if (!strcmp((char*)v_cont_desc.arr,"statement_time")) {
					PutField_CString(myHash, "TIME_FORMAT", PD_DEFAULT_TIME_FORMAT); //
DEBUGLOG(("GetByFormatId (%s) default = [%s]\n", "TIME_FORMAT", PD_DEFAULT_TIME_FORMAT));
				}
			}
		}

/* cont_desc_2 - CONTENT */
		if (ind_cont_desc_2 >= 0) { 
			v_cont_desc_2.arr[v_cont_desc_2.len] = '\0';
			sprintf(csTag, "%s_desc_2_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
			PutField_CString(myHash, csTag, (const char *)v_cont_desc_2.arr); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", csTag, v_cont_desc_2.arr));
		}


/* cont_next_lvl - CONTENT */
		if (ind_cont_next_lvl >= 0) {
			if (v_cont_next_lvl == 1) {
				sprintf(csTag, "%s_nxlv_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
				PutField_Int(myHash, csTag, v_cont_next_lvl); //
DEBUGLOG(("GetByFormatId (%s) = [%d]\n", csTag, v_cont_next_lvl));

			/* cont_template - CONTENT */
				if (ind_cont_template >= 0) {
					v_cont_template.arr[v_cont_template.len] = '\0';
					sprintf(csTag, "%s_temp_%s_%s", csFormatType, csCurrFormatId, csFormatValue);
					PutField_CString(myHash, csTag, (const char *)v_cont_template.arr); //
DEBUGLOG(("GetByFormatId (%s) = [%s]\n", csTag, v_cont_template.arr));

					if (strlen(csCurrFormatId) >= strlen((char*)v_cont_template.arr)) {
						iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetByFormatId cont_template INVALID!!!\n"));
						break;
					}
				} else {
					iRet = INT_FORMAT_TEMPLATE_ERROR;
DEBUGLOG(("GetByFormatId cont_template NOT FOUND!!!\n"));
				}
			}
		}

	}
	EXEC SQL CLOSE getbyformatidcursor;

	if (iCnt > 0) {
		RecordSet_Add(myRec, myHash);
DEBUGLOG(("GetByFormatId ** hash added - (format_id) = [%s]\n", csFormatId));
	} else {
DEBUGLOG(("GetByFormatId NOT FOUND!!!\n"));
ERRLOG("OLStmtFormat::GetByFormatId NOT FOUND!!!\n");
		iRet = PD_ERR;
	}

	FREE_ME(csTag);

DEBUGLOG(("GetByFormatId Normal Exit! iRet = [%d]\n", iRet));
	return iRet;

getformat_error:
DEBUGLOG(("getformat_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
ERRLOG("OLStmtFormat getformat_error code %d\n", sqlca.sqlcode);
ERRLOG("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
	EXEC SQL CLOSE getbyformatidcursor;
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	return PD_ERR;
}


int GetTxnCodeKeywords(const hash_t* hContext, recordset_t* myRec)
{
	int iRet = PD_FOUND;
	int iCnt = 0;
	char *csTmp;

	hash_t *hRec;

	EXEC SQL WHENEVER SQLERROR GOTO gettxncode_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar	hv_format_id[PD_FORMAT_ID_LEN];
		varchar	hv_int_bank_code[PD_BANK_CODE_LEN];
		varchar	hv_bank_acct_type[PD_ACCT_TYPE_LEN];
		varchar	hv_ccy[PD_CCY_ID_LEN];
		varchar	v_txn_code[PD_TXN_CODE_LEN + 1];
		varchar	v_amt_type[PD_AMT_TYPE_LEN + 1];
		int	v_full_match;
		int	v_default;
		double	v_min_amt;
		double	v_max_amt;
		int	v_min_dp;
		int	v_max_dp;
		int	v_display_order;
		varchar	v_cont_desc[PD_CONT_DESC_LEN + 1];
		varchar	v_format_template[PD_FORMAT_TEMPLATE_LEN + 1];

		short	ind_txn_code = -1;
		short	ind_amt_type = -1;
		short	ind_full_match = -1;
		short	ind_default = -1;
		short	ind_min_amt = -1;
		short	ind_max_amt = -1;
		short	ind_min_dp = -1;
		short	ind_max_dp = -1;
		short	ind_display_order = -1;
		short	ind_cont_desc = -1;
		short	ind_format_template = -1;
	EXEC SQL END DECLARE SECTION;

	if (GetField_CString(hContext,"format_id",&csTmp)) {
		hv_format_id.len = strlen(csTmp);
		strncpy((char*)hv_format_id.arr, csTmp, hv_format_id.len);
DEBUGLOG(("GetTxnCodeKeywords format_id = [%.*s]\n", hv_format_id.len, hv_format_id.arr));
	}

	if (GetField_CString(hContext,"int_bank_code",&csTmp)) {
		hv_int_bank_code.len = strlen(csTmp);
		strncpy((char*)hv_int_bank_code.arr, csTmp, hv_int_bank_code.len);
DEBUGLOG(("GetTxnCodeKeywords int_bank_code = [%.*s]\n", hv_int_bank_code.len, hv_int_bank_code.arr));
	}

	if (GetField_CString(hContext,"bank_acct_type",&csTmp)) {
		hv_bank_acct_type.len = strlen(csTmp);
		strncpy((char*)hv_bank_acct_type.arr, csTmp, hv_bank_acct_type.len);
DEBUGLOG(("GetTxnCodeKeywords bank_acct_type = [%.*s]\n", hv_bank_acct_type.len, hv_bank_acct_type.arr));
	}

	if (GetField_CString(hContext,"acct_ccy",&csTmp)) {
		hv_ccy.len = strlen(csTmp);
		strncpy((char*)hv_ccy.arr, csTmp, hv_ccy.len);
DEBUGLOG(("GetTxnCodeKeywords ccy = [%.*s]\n", hv_ccy.len, hv_ccy.arr));
	}

	EXEC SQL DECLARE gettxncodecursor CURSOR FOR
		SELECT	OBTC_CODE,
			OBTC_AMT_TYPE,
			OBTM_FULL_MATCH,
			OBTM_DEFAULT,
			OLFR_MIN_AMT,
			OLFR_MAX_AMT,
			OLFR_MIN_DP,
			OLFR_MAX_DP,
			OLFK_DISPLAY_ORDER,
			OLFT_CONT_DESC,
			OLFK_FORMAT_TEMPLATE
		FROM	(SELECT OBTC_CODE,
				OBTC_AMT_TYPE,
				OBTM_RANGE,
				NVL(OFKO_IS_DEFAULT, OBTM_DEFAULT) OBTM_DEFAULT,
				OBTM_PRIORITY,
				OBTM_FULL_MATCH,
				OBTM_REAL_TIME_POST, //@@
				OBTM_UPDATE_BAL //@@
			FROM	OL_BAID_TXN_CODE,
				OL_BAID_TXN_CODE_MAPPING
				LEFT JOIN OL_STMT_FORMAT_KEYWORDS_OVER
				ON OFKO_INT_BANK_CODE = :hv_int_bank_code
				AND OBTM_BANK_ACCT_TYPE = OFKO_BANK_ACCT_TYPE
				AND OBTM_CODE = OFKO_BAID_TXN_CODE
			WHERE	OBTM_CODE = OBTC_CODE
			AND	OBTM_BANK_ACCT_TYPE = :hv_bank_acct_type
			AND	OBTM_KEYWORDS = 1)
		LEFT JOIN
			(SELECT	OLFR_INT_BANK_CODE,
				OLFR_CODE,
				OLFR_CCY,
				OLFR_MIN_AMT,
				OLFR_MAX_AMT,
				OLFR_MIN_DP,
				OLFR_MAX_DP
			FROM	OL_STMT_FORMAT_RANGE TR1
			WHERE	TR1.OLFR_CCY = :hv_ccy
			AND	((TR1.OLFR_INT_BANK_CODE = '000' AND NOT EXISTS
					(SELECT * FROM OL_STMT_FORMAT_RANGE TR2
					WHERE	TR2.OLFR_INT_BANK_CODE = :hv_int_bank_code
					AND	TR2.OLFR_CODE = TR1.OLFR_CODE
					AND	TR2.OLFR_CCY = TR1.OLFR_CCY))
				OR	TR1.OLFR_INT_BANK_CODE = :hv_int_bank_code))
		ON	OBTC_CODE = OLFR_CODE
		AND	OBTM_RANGE = 1
		LEFT JOIN 
			(SELECT TK.OLFK_FORMAT_TXN_CODE,
				TK.OLFK_DISPLAY_ORDER,
				TP.OLFT_CONT_DESC,
				TK.OLFK_FORMAT_TEMPLATE
			FROM	OL_STMT_FORMAT_KEYWORDS TK,
				OL_STMT_FORMAT_TEMPLATE TP
			WHERE	TK.OLFK_INT_BANK_CODE = :hv_int_bank_code
			AND	TK.OLFK_FORMAT_TYPE = 'TXN_CODE_'||:hv_bank_acct_type
			AND	TK.OLFK_DISABLED = 0
			AND	TK.OLFK_FORMAT_COL_NAME = TP.OLFT_CONT_COL_NAME
			AND	TP.OLFT_FORMAT_ID LIKE :hv_format_id|| '%'
			AND	TP.OLFT_FORMAT_TYPE = 'CONTENT')
		ON	OBTC_CODE = OLFK_FORMAT_TXN_CODE
		AND	OBTM_DEFAULT = 0
		WHERE	(OBTM_DEFAULT = 1 OR OLFK_FORMAT_TEMPLATE IS NOT NULL)
		ORDER BY OBTC_AMT_TYPE ASC, OBTM_DEFAULT ASC, OBTM_PRIORITY DESC, OLFK_DISPLAY_ORDER ASC;

	EXEC SQL OPEN gettxncodecursor;
	for (;;) {
		EXEC SQL FETCH gettxncodecursor
		INTO	:v_txn_code:ind_txn_code,
			:v_amt_type:ind_amt_type,
			:v_full_match:ind_full_match,
			:v_default:ind_default,
			:v_min_amt:ind_min_amt,
			:v_max_amt:ind_max_amt,
			:v_min_dp:ind_min_dp,
			:v_max_dp:ind_max_dp,
			:v_display_order:ind_display_order,
			:v_cont_desc:ind_cont_desc,
			:v_format_template:ind_format_template;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		iCnt++;

		hRec = (hash_t*) malloc (sizeof(hash_t));
		hash_init(hRec, 0);

/* txn_code */
		if (ind_txn_code >= 0) {
			v_txn_code.arr[v_txn_code.len] = '\0';
			PutField_CString(hRec, "txn_code", (char*)v_txn_code.arr);
DEBUGLOG(("GetTxnCodeKeywords txn_code = [%s]\n",v_txn_code.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords txn_code NOT FOUND!!!\n"));
			break;
		}
/* amt_type */
		if (ind_amt_type >= 0) {
			v_amt_type.arr[v_amt_type.len] = '\0';
			PutField_CString(hRec, "amt_type", (char*)v_amt_type.arr);
// DEBUGLOG(("GetTxnCodeKeywords amt_type = [%s]\n",v_amt_type.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords amt_type NOT FOUND!!!\n"));
			break;
		}
/* full_match */
		if (ind_full_match >= 0) {
			PutField_Int(hRec, "full_match", v_full_match);
// DEBUGLOG(("GetTxnCodeKeywords full_match = [%d]\n",v_full_match));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords full_match NOT FOUND!!!\n"));
			break;
		}
/* default */
		if (ind_default >= 0) {
			PutField_Int(hRec, "default", v_default);
// DEBUGLOG(("GetTxnCodeKeywords default = [%d]\n",v_default));

			if (v_default == 0) {
				/* cont_desc*/
				if (ind_cont_desc >= 0) {
					v_cont_desc.arr[v_cont_desc.len] = '\0';
					PutField_CString(hRec, "cont_desc", (char*)v_cont_desc.arr);
DEBUGLOG(("GetTxnCodeKeywords cont_desc = [%s]\n",v_cont_desc.arr));
				} else {
					iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords cont_desc NOT FOUND!!!\n"));
					break;
				}
				/* format_template */
				if (ind_format_template >= 0) {
					v_format_template.arr[v_format_template.len] = '\0';
					PutField_CString(hRec, "format_template", (char*)v_format_template.arr);
DEBUGLOG(("GetTxnCodeKeywords format_template = [%s]\n",v_format_template.arr));
				} else {
					iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords format_template NOT FOUND!!!\n"));
					break;
				}
			}
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords default NOT FOUND!!!\n"));
			break;
		}
/* min_amt */
		if (ind_min_amt >= 0) {
			PutField_Double(hRec, "min_amt", v_min_amt);
DEBUGLOG(("GetTxnCodeKeywords min_amt = [%.2lf]\n",v_min_amt));
		} else {
			PutField_Double(hRec, "min_amt", -1.0);
		}
/* max_amt */
		if (ind_max_amt >= 0) {
			PutField_Double(hRec, "max_amt", v_max_amt);
DEBUGLOG(("GetTxnCodeKeywords max_amt = [%.2lf]\n",v_max_amt));
		} else {
			PutField_Double(hRec, "max_amt", -1.0);
		}
/* min_dp */
		if (ind_min_dp >= 0) {
			PutField_Int(hRec, "min_dp", v_min_dp);
DEBUGLOG(("GetTxnCodeKeywords min_dp = [%d]\n",v_min_dp));
		} else {
			PutField_Int(hRec, "min_dp", -1);
		}
/* max_dp */
		if (ind_max_dp >= 0) {
			PutField_Int(hRec, "max_dp", v_max_dp);
DEBUGLOG(("GetTxnCodeKeywords max_dp = [%d]\n",v_max_dp));
		} else {
			PutField_Int(hRec, "max_dp", -1);
		}
/* display_order */
		if (ind_display_order >= 0) {
			PutField_Int(hRec, "display_order", v_display_order);
// DEBUGLOG(("GetTxnCodeKeywords display_order = [%d]\n",v_display_order));
		} else if (ind_default >= 0) {
			if (v_default == 0) {
				iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywords default NOT FOUND!!!\n"));
				break;
			}
		}

		RecordSet_Add(myRec,hRec);
	}
	EXEC SQL CLOSE gettxncodecursor;

	if (iCnt > 0) {
DEBUGLOG(("GetTxnCodeKeywords FOUND\n"));
	} else {
		iRet = PD_NOT_FOUND;
DEBUGLOG(("GetTxnCodeKeywords NOT FOUND!!!\n"));
	}

DEBUGLOG(("GetTxnCodeKeywords Normal Exit! iRet = [%d]\n", iRet));
	return iRet;

gettxncode_error:
DEBUGLOG(("gettxncode_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
ERRLOG("OLStmtFormat gettxncode_error code %d\n", sqlca.sqlcode);
ERRLOG("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
	EXEC SQL CLOSE gettxncodecursor;
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	return PD_ERR;
}


int GetTxnCodeKeywordsSingle(const hash_t* hContext, recordset_t* myRec)
{
	int iRet = PD_FOUND;
	int iCnt = 0;
	char *csTmp;

	hash_t *hRec;

	EXEC SQL WHENEVER SQLERROR GOTO getkeywords_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar	hv_format_id[PD_FORMAT_ID_LEN];
		varchar	hv_int_bank_code[PD_BANK_CODE_LEN];
		varchar	hv_bank_acct_type[PD_ACCT_TYPE_LEN];
		varchar	hv_ccy[PD_CCY_ID_LEN];
		varchar hv_baid_txn_code[PD_BAID_LEN];
		varchar	v_txn_code[PD_TXN_CODE_LEN + 1];
		varchar	v_amt_type[PD_AMT_TYPE_LEN + 1];
		int	v_full_match;
		int	v_default;
		double	v_min_amt;
		double	v_max_amt;
		int	v_min_dp;
		int	v_max_dp;
		int	v_display_order;
		varchar	v_cont_desc[PD_CONT_DESC_LEN + 1];
		varchar	v_format_template[PD_FORMAT_TEMPLATE_LEN + 1];

		short	ind_txn_code = -1;
		short	ind_amt_type = -1;
		short	ind_full_match = -1;
		short	ind_default = -1;
		short	ind_min_amt = -1;
		short	ind_max_amt = -1;
		short	ind_min_dp = -1;
		short	ind_max_dp = -1;
		short	ind_display_order = -1;
		short	ind_cont_desc = -1;
		short	ind_format_template = -1;
	EXEC SQL END DECLARE SECTION;

	if (GetField_CString(hContext,"format_id",&csTmp)) {
		hv_format_id.len = strlen(csTmp);
		strncpy((char*)hv_format_id.arr, csTmp, hv_format_id.len);
DEBUGLOG(("GetTxnCodeKeywordsSingle format_id = [%.*s]\n", hv_format_id.len, hv_format_id.arr));
	}

	if (GetField_CString(hContext,"int_bank_code",&csTmp)) {
		hv_int_bank_code.len = strlen(csTmp);
		strncpy((char*)hv_int_bank_code.arr, csTmp, hv_int_bank_code.len);
DEBUGLOG(("GetTxnCodeKeywordsSingle int_bank_code = [%.*s]\n", hv_int_bank_code.len, hv_int_bank_code.arr));
	}

	if (GetField_CString(hContext,"bank_acct_type",&csTmp)) {
		hv_bank_acct_type.len = strlen(csTmp);
		strncpy((char*)hv_bank_acct_type.arr, csTmp, hv_bank_acct_type.len);
DEBUGLOG(("GetTxnCodeKeywordsSingle bank_acct_type = [%.*s]\n", hv_bank_acct_type.len, hv_bank_acct_type.arr));
	}

	if (GetField_CString(hContext,"acct_ccy",&csTmp)) {
		hv_ccy.len = strlen(csTmp);
		strncpy((char*)hv_ccy.arr, csTmp, hv_ccy.len);
DEBUGLOG(("GetTxnCodeKeywordsSingle ccy = [%.*s]\n", hv_ccy.len, hv_ccy.arr));
	}

	if (GetField_CString(hContext,"baid_txn_code",&csTmp)) {
		hv_baid_txn_code.len = strlen(csTmp);
		strncpy((char*)hv_baid_txn_code.arr, csTmp, hv_baid_txn_code.len);
DEBUGLOG(("GetTxnCodeKeywordsSingle baid_txn_code = [%.*s]\n", hv_baid_txn_code.len, hv_baid_txn_code.arr));
	}

	EXEC SQL DECLARE getkeywordscursor CURSOR FOR
		SELECT	OBTC_CODE,
			OBTC_AMT_TYPE,
			OBTM_FULL_MATCH,
			OBTM_DEFAULT,
			OLFR_MIN_AMT,
			OLFR_MAX_AMT,
			OLFR_MIN_DP,
			OLFR_MAX_DP,
			OLFK_DISPLAY_ORDER,
			OLFT_CONT_DESC,
			OLFK_FORMAT_TEMPLATE
		FROM	(SELECT OBTC_CODE,
				OBTC_AMT_TYPE,
				OBTM_RANGE,
				NVL(OFKO_IS_DEFAULT, OBTM_DEFAULT) OBTM_DEFAULT,
				OBTM_PRIORITY,
				OBTM_FULL_MATCH,
				OBTM_REAL_TIME_POST, //@@
				OBTM_UPDATE_BAL //@@
			FROM	OL_BAID_TXN_CODE,
				OL_BAID_TXN_CODE_MAPPING
				LEFT JOIN OL_STMT_FORMAT_KEYWORDS_OVER
				ON OFKO_INT_BANK_CODE = :hv_int_bank_code
				AND OBTM_BANK_ACCT_TYPE = OFKO_BANK_ACCT_TYPE
				AND OBTM_CODE = OFKO_BAID_TXN_CODE
			WHERE	OBTM_CODE = OBTC_CODE
			AND	OBTC_CODE = :hv_baid_txn_code
			AND	OBTM_BANK_ACCT_TYPE = :hv_bank_acct_type
			AND	OBTM_KEYWORDS = 1)
		LEFT JOIN
			(SELECT	OLFR_INT_BANK_CODE,
				OLFR_CODE,
				OLFR_CCY,
				OLFR_MIN_AMT,
				OLFR_MAX_AMT,
				OLFR_MIN_DP,
				OLFR_MAX_DP
			FROM	OL_STMT_FORMAT_RANGE TR1
			WHERE	TR1.OLFR_CCY = :hv_ccy
			AND	((TR1.OLFR_INT_BANK_CODE = '000' AND NOT EXISTS
					(SELECT * FROM OL_STMT_FORMAT_RANGE TR2
					WHERE	TR2.OLFR_INT_BANK_CODE = :hv_int_bank_code
					AND	TR2.OLFR_CODE = TR1.OLFR_CODE
					AND	TR2.OLFR_CCY = TR1.OLFR_CCY))
				OR	TR1.OLFR_INT_BANK_CODE = :hv_int_bank_code))
		ON	OBTC_CODE = OLFR_CODE
		AND	OBTM_RANGE = 1
		LEFT JOIN 
			(SELECT TK.OLFK_FORMAT_TXN_CODE,
				TK.OLFK_DISPLAY_ORDER,
				TP.OLFT_CONT_DESC,
				TK.OLFK_FORMAT_TEMPLATE
			FROM	OL_STMT_FORMAT_KEYWORDS TK,
				OL_STMT_FORMAT_TEMPLATE TP
			WHERE	TK.OLFK_INT_BANK_CODE = :hv_int_bank_code
			AND	TK.OLFK_FORMAT_TYPE = 'TXN_CODE_'||:hv_bank_acct_type
			AND	TK.OLFK_DISABLED = 0
			AND	TK.OLFK_FORMAT_COL_NAME = TP.OLFT_CONT_COL_NAME
			AND	TP.OLFT_FORMAT_ID LIKE :hv_format_id|| '%'
			AND	TP.OLFT_FORMAT_TYPE = 'CONTENT')
		ON	OBTC_CODE = OLFK_FORMAT_TXN_CODE
		AND	OBTM_DEFAULT = 0
		WHERE	(OBTM_DEFAULT = 1 OR OLFK_FORMAT_TEMPLATE IS NOT NULL)
		ORDER BY OBTC_AMT_TYPE ASC, OBTM_DEFAULT ASC, OBTM_PRIORITY DESC, OLFK_DISPLAY_ORDER ASC;

	EXEC SQL OPEN getkeywordscursor;
	for (;;) {
		EXEC SQL FETCH getkeywordscursor
		INTO	:v_txn_code:ind_txn_code,
			:v_amt_type:ind_amt_type,
			:v_full_match:ind_full_match,
			:v_default:ind_default,
			:v_min_amt:ind_min_amt,
			:v_max_amt:ind_max_amt,
			:v_min_dp:ind_min_dp,
			:v_max_dp:ind_max_dp,
			:v_display_order:ind_display_order,
			:v_cont_desc:ind_cont_desc,
			:v_format_template:ind_format_template;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		iCnt++;

		hRec = (hash_t*) malloc (sizeof(hash_t));
		hash_init(hRec, 0);

/* txn_code */
		if (ind_txn_code >= 0) {
			v_txn_code.arr[v_txn_code.len] = '\0';
			PutField_CString(hRec, "txn_code", (char*)v_txn_code.arr);
DEBUGLOG(("GetTxnCodeKeywordsSingle txn_code = [%s]\n",v_txn_code.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle txn_code NOT FOUND!!!\n"));
			break;
		}
/* amt_type */
		if (ind_amt_type >= 0) {
			v_amt_type.arr[v_amt_type.len] = '\0';
			PutField_CString(hRec, "amt_type", (char*)v_amt_type.arr);
DEBUGLOG(("GetTxnCodeKeywordsSingle amt_type = [%s]\n",v_amt_type.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle amt_type NOT FOUND!!!\n"));
			break;
		}
/* full_match */
		if (ind_full_match >= 0) {
			PutField_Int(hRec, "full_match", v_full_match);
DEBUGLOG(("GetTxnCodeKeywordsSingle full_match = [%d]\n",v_full_match));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle full_match NOT FOUND!!!\n"));
			break;
		}
/* default */
		if (ind_default >= 0) {
			PutField_Int(hRec, "default", v_default);
DEBUGLOG(("GetTxnCodeKeywordsSingle default = [%d]\n",v_default));

			if (v_default == 0) {
				/* cont_desc*/
				if (ind_cont_desc >= 0) {
					v_cont_desc.arr[v_cont_desc.len] = '\0';
					PutField_CString(hRec, "cont_desc", (char*)v_cont_desc.arr);
DEBUGLOG(("GetTxnCodeKeywordsSingle cont_desc = [%s]\n",v_cont_desc.arr));
				} else {
					iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle cont_desc NOT FOUND!!!\n"));
					break;
				}
				/* format_template */
				if (ind_format_template >= 0) {
					v_format_template.arr[v_format_template.len] = '\0';
					PutField_CString(hRec, "format_template", (char*)v_format_template.arr);
DEBUGLOG(("GetTxnCodeKeywordsSingle format_template = [%s]\n",v_format_template.arr));
				} else {
					iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle format_template NOT FOUND!!!\n"));
					break;
				}
			}
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle default NOT FOUND!!!\n"));
			break;
		}
/* min_amt */
		if (ind_min_amt >= 0) {
			PutField_Double(hRec, "min_amt", v_min_amt);
DEBUGLOG(("GetTxnCodeKeywordsSingle min_amt = [%.2lf]\n",v_min_amt));
		} else {
			PutField_Double(hRec, "min_amt", -1.0);
		}
/* max_amt */
		if (ind_max_amt >= 0) {
			PutField_Double(hRec, "max_amt", v_max_amt);
DEBUGLOG(("GetTxnCodeKeywordsSingle max_amt = [%.2lf]\n",v_max_amt));
		} else {
			PutField_Double(hRec, "max_amt", -1.0);
		}
/* min_dp */
		if (ind_min_dp >= 0) {
			PutField_Int(hRec, "min_dp", v_min_dp);
DEBUGLOG(("GetTxnCodeKeywordsSingle min_dp = [%d]\n",v_min_dp));
		} else {
			PutField_Int(hRec, "min_dp", -1);
		}
/* max_dp */
		if (ind_max_dp >= 0) {
			PutField_Int(hRec, "max_dp", v_max_dp);
DEBUGLOG(("GetTxnCodeKeywordsSingle max_dp = [%d]\n",v_max_dp));
		} else {
			PutField_Int(hRec, "max_dp", -1);
		}
/* display_order */
		if (ind_display_order >= 0) {
			PutField_Int(hRec, "display_order", v_display_order);
DEBUGLOG(("GetTxnCodeKeywordsSingle display_order = [%d]\n",v_display_order));
		} else if (ind_default >= 0) {
			if (v_default == 0) {
				iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsSingle default NOT FOUND!!!\n"));
				break;
			}
		}

		RecordSet_Add(myRec,hRec);
	}
	EXEC SQL CLOSE getkeywordscursor;

	if (iCnt > 0) {
DEBUGLOG(("GetTxnCodeKeywordsSingle FOUND\n"));
	} else {
		iRet = PD_NOT_FOUND;
DEBUGLOG(("GetTxnCodeKeywordsSingle NOT FOUND!!!\n"));
	}

DEBUGLOG(("GetTxnCodeKeywordsSingle Normal Exit! iRet = [%d]\n", iRet));
	return iRet;

getkeywords_error:
DEBUGLOG(("getkeywords_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
ERRLOG("OLStmtFormat getkeywords_error code %d\n", sqlca.sqlcode);
ERRLOG("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
	EXEC SQL CLOSE getkeywordscursor;
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	return PD_ERR;
}


int GetTxnCodeKeywordsAll(const hash_t* hContext, recordset_t* myRec)
{
	int iRet = PD_FOUND;
	int iCnt = 0;
	char *csTmp;

	hash_t *hRec;

	EXEC SQL WHENEVER SQLERROR GOTO gettxncodeall_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar	hv_format_id[PD_FORMAT_ID_LEN];
		varchar	hv_int_bank_code[PD_BANK_CODE_LEN];
		varchar	hv_bank_acct_type[PD_ACCT_TYPE_LEN];
		varchar	hv_ccy[PD_CCY_ID_LEN];
		varchar	v_txn_code[PD_TXN_CODE_LEN + 1];
		varchar	v_amt_type[PD_AMT_TYPE_LEN + 1];
		int	v_full_match;
		int	v_default;
		double	v_min_amt;
		double	v_max_amt;
		int	v_min_dp;
		int	v_max_dp;
		int	v_display_order;
		varchar	v_cont_desc[PD_CONT_DESC_LEN + 1];
		varchar	v_format_template[PD_FORMAT_TEMPLATE_LEN + 1];

		short	ind_txn_code = -1;
		short	ind_amt_type = -1;
		short	ind_full_match = -1;
		short	ind_default = -1;
		short	ind_min_amt = -1;
		short	ind_max_amt = -1;
		short	ind_min_dp = -1;
		short	ind_max_dp = -1;
		short	ind_display_order = -1;
		short	ind_cont_desc = -1;
		short	ind_format_template = -1;
	EXEC SQL END DECLARE SECTION;

	if (GetField_CString(hContext,"format_id",&csTmp)) {
		hv_format_id.len = strlen(csTmp);
		strncpy((char*)hv_format_id.arr, csTmp, hv_format_id.len);
DEBUGLOG(("GetTxnCodeKeywordsAll format_id = [%.*s]\n", hv_format_id.len, hv_format_id.arr));
	}

	if (GetField_CString(hContext,"int_bank_code",&csTmp)) {
		hv_int_bank_code.len = strlen(csTmp);
		strncpy((char*)hv_int_bank_code.arr, csTmp, hv_int_bank_code.len);
DEBUGLOG(("GetTxnCodeKeywordsAll int_bank_code = [%.*s]\n", hv_int_bank_code.len, hv_int_bank_code.arr));
	}

	if (GetField_CString(hContext,"bank_acct_type",&csTmp)) {
		hv_bank_acct_type.len = strlen(csTmp);
		strncpy((char*)hv_bank_acct_type.arr, csTmp, hv_bank_acct_type.len);
DEBUGLOG(("GetTxnCodeKeywordsAll bank_acct_type = [%.*s]\n", hv_bank_acct_type.len, hv_bank_acct_type.arr));
	}

	if (GetField_CString(hContext,"acct_ccy",&csTmp)) {
		hv_ccy.len = strlen(csTmp);
		strncpy((char*)hv_ccy.arr, csTmp, hv_ccy.len);
DEBUGLOG(("GetTxnCodeKeywordsAll ccy = [%.*s]\n", hv_ccy.len, hv_ccy.arr));
	}

	EXEC SQL DECLARE gettxncodeallcursor CURSOR FOR
		SELECT	OBTC_CODE,
			OBTC_AMT_TYPE,
			OBTM_FULL_MATCH,
			OBTM_DEFAULT,
			OLFR_MIN_AMT,
			OLFR_MAX_AMT,
			OLFR_MIN_DP,
			OLFR_MAX_DP,
			OLFK_DISPLAY_ORDER,
			OLFT_CONT_DESC,
			OLFK_FORMAT_TEMPLATE
		FROM	(SELECT OBTC_CODE,
				OBTC_AMT_TYPE,
				OBTM_RANGE,
				NVL(OFKO_IS_DEFAULT, OBTM_DEFAULT) OBTM_DEFAULT,
				OBTM_PRIORITY,
				OBTM_FULL_MATCH,
				OBTM_REAL_TIME_POST, //@@
				OBTM_UPDATE_BAL //@@
			FROM	OL_BAID_TXN_CODE,
				OL_BAID_TXN_CODE_MAPPING
				LEFT JOIN OL_STMT_FORMAT_KEYWORDS_OVER
				ON OFKO_INT_BANK_CODE = :hv_int_bank_code
				AND OBTM_BANK_ACCT_TYPE = OFKO_BANK_ACCT_TYPE
				AND OBTM_CODE = OFKO_BAID_TXN_CODE
			WHERE	OBTM_CODE = OBTC_CODE
			AND	OBTM_BANK_ACCT_TYPE = :hv_bank_acct_type
			AND	OBTM_KEYWORDS = 1)
		LEFT JOIN
			(SELECT	OLFR_INT_BANK_CODE,
				OLFR_CODE,
				OLFR_CCY,
				OLFR_MIN_AMT,
				OLFR_MAX_AMT,
				OLFR_MIN_DP,
				OLFR_MAX_DP
			FROM	OL_STMT_FORMAT_RANGE TR1
			WHERE	TR1.OLFR_CCY = :hv_ccy
			AND	((TR1.OLFR_INT_BANK_CODE = '000' AND NOT EXISTS
					(SELECT * FROM OL_STMT_FORMAT_RANGE TR2
					WHERE	TR2.OLFR_INT_BANK_CODE = :hv_int_bank_code
					AND	TR2.OLFR_CODE = TR1.OLFR_CODE
					AND	TR2.OLFR_CCY = TR1.OLFR_CCY))
				OR	TR1.OLFR_INT_BANK_CODE = :hv_int_bank_code))
		ON	OBTC_CODE = OLFR_CODE
		AND	OBTM_RANGE = 1
		LEFT JOIN 
			(SELECT TK.OLFK_FORMAT_TXN_CODE,
				TK.OLFK_DISPLAY_ORDER,
				TP.OLFT_CONT_DESC,
				TK.OLFK_FORMAT_TEMPLATE
			FROM	OL_STMT_FORMAT_KEYWORDS TK,
				OL_STMT_FORMAT_TEMPLATE TP
			WHERE	TK.OLFK_INT_BANK_CODE = :hv_int_bank_code
			AND	TK.OLFK_FORMAT_TYPE = 'TXN_CODE_'||:hv_bank_acct_type
			AND	TK.OLFK_DISABLED = 0
			AND	TK.OLFK_FORMAT_COL_NAME = TP.OLFT_CONT_COL_NAME
			AND	TP.OLFT_FORMAT_ID LIKE :hv_format_id|| '%'
			AND	TP.OLFT_FORMAT_TYPE = 'CONTENT')
		ON	OBTC_CODE = OLFK_FORMAT_TXN_CODE
		//AND	OBTM_DEFAULT = 0
		//WHERE	(OBTM_DEFAULT = 1 OR OLFK_FORMAT_TEMPLATE IS NOT NULL)
		WHERE	OLFK_FORMAT_TEMPLATE IS NOT NULL
		ORDER BY OBTC_AMT_TYPE ASC, OBTM_DEFAULT ASC, OBTM_PRIORITY DESC, OLFK_DISPLAY_ORDER ASC;

	EXEC SQL OPEN gettxncodeallcursor;
	for (;;) {
		EXEC SQL FETCH gettxncodeallcursor
		INTO	:v_txn_code:ind_txn_code,
			:v_amt_type:ind_amt_type,
			:v_full_match:ind_full_match,
			:v_default:ind_default,
			:v_min_amt:ind_min_amt,
			:v_max_amt:ind_max_amt,
			:v_min_dp:ind_min_dp,
			:v_max_dp:ind_max_dp,
			:v_display_order:ind_display_order,
			:v_cont_desc:ind_cont_desc,
			:v_format_template:ind_format_template;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		iCnt++;

		hRec = (hash_t*) malloc (sizeof(hash_t));
		hash_init(hRec, 0);

/* txn_code */
		if (ind_txn_code >= 0) {
			v_txn_code.arr[v_txn_code.len] = '\0';
			PutField_CString(hRec, "txn_code", (char*)v_txn_code.arr);
DEBUGLOG(("GetTxnCodeKeywordsAll txn_code = [%s]\n",v_txn_code.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll txn_code NOT FOUND!!!\n"));
			break;
		}
/* amt_type */
		if (ind_amt_type >= 0) {
			v_amt_type.arr[v_amt_type.len] = '\0';
			PutField_CString(hRec, "amt_type", (char*)v_amt_type.arr);
// DEBUGLOG(("GetTxnCodeKeywordsAll amt_type = [%s]\n",v_amt_type.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll amt_type NOT FOUND!!!\n"));
			break;
		}
/* full_match */
		if (ind_full_match >= 0) {
			PutField_Int(hRec, "full_match", v_full_match);
// DEBUGLOG(("GetTxnCodeKeywordsAll full_match = [%d]\n",v_full_match));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll full_match NOT FOUND!!!\n"));
			break;
		}
/* default */
		if (ind_default >= 0) {
			PutField_Int(hRec, "default", v_default);
DEBUGLOG(("GetTxnCodeKeywordsAll default = [%d]\n",v_default));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll default NOT FOUND!!!\n"));
			break;
		}

/* cont_desc */
		if (ind_cont_desc >= 0) {
			v_cont_desc.arr[v_cont_desc.len] = '\0';
			PutField_CString(hRec, "cont_desc", (char*)v_cont_desc.arr);
DEBUGLOG(("GetTxnCodeKeywordsAll cont_desc = [%s]\n",v_cont_desc.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll cont_desc NOT FOUND!!!\n"));
			break;
		}

/* format_template */
		if (ind_format_template >= 0) {
			v_format_template.arr[v_format_template.len] = '\0';
			PutField_CString(hRec, "format_template", (char*)v_format_template.arr);
DEBUGLOG(("GetTxnCodeKeywordsAll format_template = [%s]\n",v_format_template.arr));
		} else {
			iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll format_template NOT FOUND!!!\n"));
			break;
		}

/* min_amt */
		if (ind_min_amt >= 0) {
			PutField_Double(hRec, "min_amt", v_min_amt);
DEBUGLOG(("GetTxnCodeKeywordsAll min_amt = [%.2lf]\n",v_min_amt));
		} else {
			PutField_Double(hRec, "min_amt", -1.0);
		}
/* max_amt */
		if (ind_max_amt >= 0) {
			PutField_Double(hRec, "max_amt", v_max_amt);
DEBUGLOG(("GetTxnCodeKeywordsAll max_amt = [%.2lf]\n",v_max_amt));
		} else {
			PutField_Double(hRec, "max_amt", -1.0);
		}
/* min_dp */
		if (ind_min_dp >= 0) {
			PutField_Int(hRec, "min_dp", v_min_dp);
DEBUGLOG(("GetTxnCodeKeywordsAll min_dp = [%d]\n",v_min_dp));
		} else {
			PutField_Int(hRec, "min_dp", -1);
		}
/* max_dp */
		if (ind_max_dp >= 0) {
			PutField_Int(hRec, "max_dp", v_max_dp);
DEBUGLOG(("GetTxnCodeKeywordsAll max_dp = [%d]\n",v_max_dp));
		} else {
			PutField_Int(hRec, "max_dp", -1);
		}
/* display_order */
		if (ind_display_order >= 0) {
			PutField_Int(hRec, "display_order", v_display_order);
// DEBUGLOG(("GetTxnCodeKeywordsAll display_order = [%d]\n",v_display_order));
		} else if (ind_default >= 0) {
			if (v_default == 0) {
				iRet = INT_FORMAT_KEYWORDS_ERROR;
DEBUGLOG(("GetTxnCodeKeywordsAll default NOT FOUND!!!\n"));
				break;
			}
		}

		RecordSet_Add(myRec,hRec);
	}
	EXEC SQL CLOSE gettxncodeallcursor;

	if (iCnt > 0) {
DEBUGLOG(("GetTxnCodeKeywordsAll FOUND\n"));
	} else {
		iRet = PD_NOT_FOUND;
DEBUGLOG(("GetTxnCodeKeywordsAll NOT FOUND!!!\n"));
	}

DEBUGLOG(("GetTxnCodeKeywordsAll Normal Exit! iRet = [%d]\n", iRet));
	return iRet;

gettxncodeall_error:
DEBUGLOG(("gettxncodeall_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
ERRLOG("OLStmtFormat gettxncodeall_error code %d\n", sqlca.sqlcode);
ERRLOG("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc);
	EXEC SQL CLOSE gettxncodeallcursor;
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	return PD_ERR;
}


int AddKeywords(hash_t *hRls)
{
	char	*csTmp;
	int	iTmp;

	EXEC SQL WHENEVER SQLERROR GOTO addkeywords_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar		hv_int_bank_code[PD_FORMAT_ID_LEN];
		varchar		hv_format_type[PD_FORMAT_TYPE_LEN];
		int		hv_format_value;
		varchar		hv_format_txn_code[PD_TXN_CODE_LEN];
		varchar		hv_format_template[PD_FORMAT_TEMPLATE_LEN];
		varchar		hv_format_col_name[PD_COL_NAME_LEN];
		int		hv_display_order;
		int		hv_disabled;
		varchar		hv_user[PD_USER_LEN];

		short		ind_int_bank_code = -1;
		short		ind_format_type = -1;
		short		ind_format_value = -1;
		short		ind_format_txn_code = -1;
		short		ind_format_template = -1;
		short		ind_format_col_name = -1;
		short		ind_display_order = -1;
		short		ind_disabled = -1;
		short		ind_user = -1;

		short		hv_return_value;

	EXEC SQL END DECLARE SECTION;

// int_bank_code
	if (GetField_CString(hRls,"int_bank_code",&csTmp)) {
		hv_int_bank_code.len = strlen(csTmp);
		strncpy((char*)hv_int_bank_code.arr, csTmp, hv_int_bank_code.len);
		ind_int_bank_code = 0;
DEBUGLOG(("AddKeywords:int_bank_code = [%.*s]\n",hv_int_bank_code.len,hv_int_bank_code.arr));
	} else {
DEBUGLOG(("AddKeywords:int_bank_code NOT FOUND!!!\n"));
	}

// format_type
	if (GetField_CString(hRls,"format_type",&csTmp)) {
		hv_format_type.len = strlen(csTmp);
		strncpy((char*)hv_format_type.arr, csTmp, hv_format_type.len);
		ind_format_type = 0;
DEBUGLOG(("AddKeywords:format_type = [%.*s]\n",hv_format_type.len,hv_format_type.arr));
	} else {
DEBUGLOG(("AddKeywords:format_type NOT FOUND!!!\n"));
	}

// format_value
	if (GetField_Int(hRls,"format_value",&iTmp)) {
		hv_format_value = iTmp;
		ind_format_value = 0;
DEBUGLOG(("AddKeywords:format_value = [%d]\n",hv_format_value));
	}

// format_txn_code
	if (GetField_CString(hRls,"format_txn_code",&csTmp)) {
		hv_format_txn_code.len = strlen(csTmp);
		strncpy((char*)hv_format_txn_code.arr, csTmp, hv_format_txn_code.len);
		ind_format_txn_code = 0;
DEBUGLOG(("AddKeywords:format_txn_code = [%.*s]\n",hv_format_txn_code.len,hv_format_txn_code.arr));
	} else {
DEBUGLOG(("AddKeywords:format_txn_code NOT FOUND!!!\n"));
	}

// format_template
	if (GetField_CString(hRls,"format_template",&csTmp)) {
		hv_format_template.len = strlen(csTmp);
		strncpy((char*)hv_format_template.arr, csTmp, hv_format_template.len);
		ind_format_template = 0;
DEBUGLOG(("AddKeywords:format_template = [%.*s]\n",hv_format_template.len,hv_format_template.arr));
	} else {
DEBUGLOG(("AddKeywords:format_template NOT FOUND!!!\n"));
	}

// format_col_name
	if (GetField_CString(hRls,"format_col_name",&csTmp)) {
		hv_format_col_name.len = strlen(csTmp);
		strncpy((char*)hv_format_col_name.arr, csTmp, hv_format_col_name.len);
		ind_format_col_name = 0;
DEBUGLOG(("AddKeywords:format_col_name = [%.*s]\n",hv_format_col_name.len,hv_format_col_name.arr));
	} else {
DEBUGLOG(("AddKeywords:format_col_name NOT FOUND!!!\n"));
	}

// display_order
	if (GetField_Int(hRls,"display_order",&iTmp)) {
		hv_display_order = iTmp;
		ind_display_order = 0;
DEBUGLOG(("AddKeywords:display_order = [%d]\n",hv_display_order));
	}

// disabled
	hv_disabled = 0;
	if (GetField_Int(hRls,"disabled",&iTmp)) {
		hv_disabled = iTmp;
DEBUGLOG(("AddKeywords:disabled = [%d]\n",hv_disabled));
	}
	ind_disabled = 0;

// user
	if (GetField_CString(hRls,"create_user",&csTmp)) {
		hv_user.len = strlen(csTmp);
		strncpy((char*)hv_user.arr, csTmp, hv_user.len);
		ind_user = 0;
DEBUGLOG(("AddKeywords:user = [%.*s]\n",hv_user.len,hv_user.arr));
	} else if (GetField_CString(hRls,"update_user",&csTmp)) {
		hv_user.len = strlen(csTmp);
		strncpy((char*)hv_user.arr, csTmp, hv_user.len);
		ind_user = 0;
DEBUGLOG(("AddKeywords:user = [%.*s]\n",hv_user.len,hv_user.arr));
	} else {
DEBUGLOG(("AddKeywords:user NOT FOUND!!!\n"));
	}

	EXEC SQL EXECUTE
		BEGIN
			:hv_return_value := sp_ol_stmt_keywords_insert(
						:hv_int_bank_code:ind_int_bank_code,
						:hv_format_type:ind_format_type,
						:hv_format_value:ind_format_value,
						:hv_format_txn_code:ind_format_txn_code,
						:hv_format_template:ind_format_template,
						:hv_format_col_name:ind_format_col_name,
						:hv_display_order:ind_display_order,
						:hv_disabled:ind_disabled,
						:hv_user:ind_user);
		END;
	END-EXEC;

DEBUGLOG(("AddKeywords:Ret = [%d]\n",hv_return_value));
	if (hv_return_value == SP_OK)
	{
		if (ind_display_order >= 0) {
			PutField_Int(hRls,"display_order",hv_display_order);
DEBUGLOG(("AddKeywords: display_order = [%d]\n",hv_display_order));
		}
DEBUGLOG(("AddKeywords: Normal Exit\n"));
		return PD_OK;
	}

	if (hv_return_value == SP_OTHER_ERR) {
ERRLOG("OLStatement_AddKeywords: SP_OTHER_ERR\n");
DEBUGLOG(("AddKeywords: SP_OTHER_ERR\n"));
		return PD_OTHER_ERR;
	}

	if (hv_return_value == SP_ERR) {
ERRLOG("OLStatement_AddKeywords: SP_ERR\n");
DEBUGLOG(("AddKeywords: SP_ERR\n"));
		return PD_ERR;
	}

addkeywords_error:
DEBUGLOG(("update_Header_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
ERRLOG("OLStatement_AddKeywords: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("AddKeywords: SP_INTERNAL_ERR TxnAbort\n"));
	TxnAbort();
	return PD_INTERNAL_ERR;
}


int UpdateKeywords(hash_t *hRls)
{
	char	*csTmp;
	int	iTmp;

	EXEC SQL WHENEVER SQLERROR GOTO updatekeywords_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;
		varchar		hv_int_bank_code[PD_FORMAT_ID_LEN];
		varchar		hv_format_type[PD_FORMAT_TYPE_LEN];
		int		hv_format_value;
		varchar		hv_format_txn_code[PD_TXN_CODE_LEN];
		varchar		hv_format_template[PD_FORMAT_TEMPLATE_LEN];
		varchar		hv_format_col_name[PD_COL_NAME_LEN];
		int		hv_display_order;
		int		hv_disabled;
		varchar		hv_user[PD_USER_LEN];

		short		ind_int_bank_code = -1;
		short		ind_format_type = -1;
		short		ind_format_value = -1;
		short		ind_format_txn_code = -1;
		short		ind_format_template = -1;
		short		ind_format_col_name = -1;
		short		ind_display_order = -1;
		short		ind_disabled = -1;
		short		ind_user = -1;

		short		hv_return_value;

	EXEC SQL END DECLARE SECTION;

// int_bank_code
	if (GetField_CString(hRls,"int_bank_code",&csTmp)) {
		hv_int_bank_code.len = strlen(csTmp);
		strncpy((char*)hv_int_bank_code.arr, csTmp, hv_int_bank_code.len);
		ind_int_bank_code = 0;
DEBUGLOG(("UpdateKeywords:int_bank_code = [%.*s]\n",hv_int_bank_code.len,hv_int_bank_code.arr));
	} else {
DEBUGLOG(("UpdateKeywords:int_bank_code NOT FOUND!!!\n"));
	}

// format_type
	if (GetField_CString(hRls,"format_type",&csTmp)) {
		hv_format_type.len = strlen(csTmp);
		strncpy((char*)hv_format_type.arr, csTmp, hv_format_type.len);
		ind_format_type = 0;
DEBUGLOG(("UpdateKeywords:format_type = [%.*s]\n",hv_format_type.len,hv_format_type.arr));
	} else {
DEBUGLOG(("UpdateKeywords:format_type NOT FOUND!!!\n"));
	}

// format_value
	if (GetField_Int(hRls,"format_value",&iTmp)) {
		hv_format_value = iTmp;
		ind_format_value = 0;
DEBUGLOG(("UpdateKeywords:format_value = [%d]\n",hv_format_value));
	} else {
DEBUGLOG(("UpdateKeywords:format_value NOT FOUND!!!\n"));
	}

// format_txn_code
	if (GetField_CString(hRls,"format_txn_code",&csTmp)) {
		hv_format_txn_code.len = strlen(csTmp);
		strncpy((char*)hv_format_txn_code.arr, csTmp, hv_format_txn_code.len);
		ind_format_txn_code = 0;
DEBUGLOG(("UpdateKeywords:format_txn_code = [%.*s]\n",hv_format_txn_code.len,hv_format_txn_code.arr));
	} else {
DEBUGLOG(("UpdateKeywords:format_txn_code NOT FOUND!!!\n"));
	}

// format_template
	if (GetField_CString(hRls,"format_template",&csTmp)) {
		hv_format_template.len = strlen(csTmp);
		strncpy((char*)hv_format_template.arr, csTmp, hv_format_template.len);
		ind_format_template = 0;
DEBUGLOG(("UpdateKeywords:format_template = [%.*s]\n",hv_format_template.len,hv_format_template.arr));
	} else {
DEBUGLOG(("UpdateKeywords:format_template NOT FOUND!!!\n"));
	}

// format_col_name
	if (GetField_CString(hRls,"format_col_name",&csTmp)) {
		hv_format_col_name.len = strlen(csTmp);
		strncpy((char*)hv_format_col_name.arr, csTmp, hv_format_col_name.len);
		ind_format_col_name = 0;
DEBUGLOG(("UpdateKeywords:format_col_name = [%.*s]\n",hv_format_col_name.len,hv_format_col_name.arr));
	} else {
DEBUGLOG(("UpdateKeywords:format_col_name NOT FOUND!!!\n"));
	}

// display_order
	if (GetField_Int(hRls,"display_order",&iTmp)) {
		hv_display_order = iTmp;
		ind_display_order = 0;
DEBUGLOG(("UpdateKeywords:display_order = [%d]\n",hv_display_order));
	} else {
DEBUGLOG(("UpdateKeywords:display_order NOT FOUND!!!\n"));
	}

// disabled
	hv_disabled = 0;
	if (GetField_Int(hRls,"disabled",&iTmp)) {
		hv_disabled = iTmp;
DEBUGLOG(("AddKeywords:disabled = [%d]\n",hv_disabled));
	}
	ind_disabled = 0;

// user
	if (GetField_CString(hRls,"create_user",&csTmp)) {
		hv_user.len = strlen(csTmp);
		strncpy((char*)hv_user.arr, csTmp, hv_user.len);
		ind_user = 0;
DEBUGLOG(("UpdateKeywords:user = [%.*s]\n",hv_user.len,hv_user.arr));
	} else if (GetField_CString(hRls,"update_user",&csTmp)) {
		hv_user.len = strlen(csTmp);
		strncpy((char*)hv_user.arr, csTmp, hv_user.len);
		ind_user = 0;
DEBUGLOG(("UpdateKeywords:user = [%.*s]\n",hv_user.len,hv_user.arr));
	} else {
DEBUGLOG(("UpdateKeywords:user NOT FOUND!!!\n"));
	}

	EXEC SQL EXECUTE
		BEGIN
			:hv_return_value := sp_ol_stmt_keywords_update(
						:hv_int_bank_code:ind_int_bank_code,
						:hv_format_type:ind_format_type,
						:hv_format_value:ind_format_value,
						:hv_format_txn_code:ind_format_txn_code,
						:hv_format_template:ind_format_template,
						:hv_format_col_name:ind_format_col_name,
						:hv_display_order:ind_display_order,
						:hv_disabled:ind_disabled,
						:hv_user:ind_user);
		END;
	END-EXEC;

DEBUGLOG(("UpdateKeywords:Ret = [%d]\n",hv_return_value));
	if (hv_return_value == SP_OK)
	{
DEBUGLOG(("UpdateKeywords: Normal Exit\n"));
		return PD_OK;
	}

	if (hv_return_value == SP_OTHER_ERR) {
ERRLOG("OLStatement_UpdateKeywords: SP_OTHER_ERR\n");
DEBUGLOG(("UpdateKeywords: SP_OTHER_ERR\n"));
		return PD_OTHER_ERR;
	}

	if (hv_return_value == SP_ERR) {
ERRLOG("OLStatement_UpdateKeywords: SP_ERR\n");
DEBUGLOG(("UpdateKeywords: SP_ERR\n"));
		return PD_ERR;
	}

updatekeywords_error:
DEBUGLOG(("update_Header_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
ERRLOG("OLStatement_UpdateKeywords: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("UpdateKeywords: SP_INTERNAL_ERR TxnAbort\n"));
	TxnAbort();
	return PD_INTERNAL_ERR;
}


