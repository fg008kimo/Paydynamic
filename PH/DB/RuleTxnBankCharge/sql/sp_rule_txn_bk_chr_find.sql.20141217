CREATE OR REPLACE FUNCTION sp_rule_txn_bk_chr_find (
  in_bank_code            	rule_txn_bank_charge.rtbc_bank_code%Type,
  in_pid            		rule_txn_bank_charge.rtbc_pid%Type,
  in_baid            		rule_txn_bank_charge.rtbc_baid%Type,
  in_country            	rule_txn_bank_charge.rtbc_country%Type,
  in_ccy            		rule_txn_bank_charge.rtbc_ccy%Type,
  in_channel_code            	rule_txn_bank_charge.rtbc_channel_code%Type,
  in_txn_code            	rule_txn_bank_charge.rtbc_txn_code%Type,
  out_min_value		out	rule_txn_bank_charge.rtbc_min_value%type,
  out_max_value		out	rule_txn_bank_charge.rtbc_max_value%type,
  out_type		out	rule_amount.ra_type%type,
  out_value		out	rule_amount.ra_value%type,
  out_add_value		out	rule_amount.ra_add_value%type)

RETURN NUMBER Is
	iCnt	integer := 0;
Begin
	out_type := '';
	out_value := 0;
	out_add_value := 0;
	out_min_value := 0;
	out_max_value := 0;

	select count(*)
	  into iCnt
    	from rule_txn_bank_charge,
             rule_amount
       where rtbc_amount_id = ra_id
         and rtbc_bank_code = in_bank_code
	 and rtbc_pid = in_pid
	 and rtbc_baid = in_baid
	 and rtbc_country = in_country
	 and rtbc_ccy = in_ccy
	 and rtbc_channel_code = in_channel_code
	 and rtbc_txn_code = in_txn_code
         and rtbc_disabled = 0
	 and rtbc_effect_date = (
                select max(rtbc_effect_date)
                  from rule_txn_bank_charge,
                       rule_amount
                 where rtbc_amount_id = ra_id
                   and rtbc_bank_code = in_bank_code
                   and rtbc_pid = in_pid
                   and rtbc_baid = in_baid
                   and rtbc_country = in_country
                   and rtbc_ccy = in_ccy
                   and rtbc_channel_code = in_channel_code
                   and rtbc_txn_code = in_txn_code
                   and rtbc_disabled = 0
                   and rtbc_effect_date < sysdate);	

	if iCnt > 0 THEN
		select ra_type, ra_value, ra_add_value, rtbc_min_value, rtbc_max_value
	  	  into out_type, out_value, out_add_value, out_min_value, out_max_value
    	          from rule_txn_bank_charge,
                       rule_amount
                 where rtbc_amount_id = ra_id
		   and rtbc_bank_code = in_bank_code
                   and rtbc_pid = in_pid
                   and rtbc_baid = in_baid
                   and rtbc_country = in_country
                   and rtbc_ccy = in_ccy
                   and rtbc_channel_code = in_channel_code
                   and rtbc_txn_code = in_txn_code	
    	 	   and rtbc_disabled = 0;
		RETURN 1;
	else
		RETURN 0;
	end if;


	RETURN 0;


 exception
   WHEN OTHERS THEN
     RETURN 0;
END sp_rule_txn_bk_chr_find;
/

