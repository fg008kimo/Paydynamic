CREATE OR REPLACE FUNCTION sp_ol_sim_cards_insert_update (
   in_mobile             ol_sim_cards.osc_mobile%TYPE,
   in_carries            ol_sim_cards.osc_carries%TYPE,
   in_sim_credit         ol_sim_cards.osc_sim_credit%TYPE,
   in_sim_package        ol_sim_cards.osc_sim_package%TYPE,
   in_billed_date        ol_sim_cards.osc_billed_date%TYPE,
   in_last_topup_date    ol_sim_cards.osc_last_topup_date%TYPE,
   in_next_topup_date    ol_sim_cards.osc_next_topup_date%TYPE,
   in_password           ol_sim_cards.osc_password%TYPE,
   in_active             ol_sim_cards.osc_active%TYPE,
   in_user               ol_sim_cards.osc_create_user%TYPE)
   RETURN NUMBER
IS
BEGIN
   UPDATE ol_sim_cards
      SET osc_carries = NVL (in_carries, osc_carries),
          osc_sim_credit = NVL (in_sim_credit, osc_sim_credit),
          osc_sim_package = NVL (in_sim_package, osc_sim_package),
          osc_billed_date = NVL (in_billed_date, osc_billed_date),
          osc_last_topup_date = NVL (in_last_topup_date, osc_last_topup_date),
          osc_next_topup_date = NVL (in_next_topup_date, osc_next_topup_date),
          osc_password = NVL (in_password, osc_password),
          osc_active = NVL (in_active, osc_active),
          osc_update_user = in_user,
          osc_update_timestamp = SYSDATE
    WHERE osc_mobile = in_mobile;

   IF SQL%ROWCOUNT = 0
   THEN
      INSERT INTO ol_sim_cards (osc_mobile,
                                osc_carries,
                                osc_sim_credit,
                                osc_sim_package,
                                osc_billed_date,
                                osc_last_topup_date,
                                osc_next_topup_date,
                                osc_password,
                                osc_active,
                                osc_create_timestamp,
                                osc_create_user,
                                osc_update_timestamp,
                                osc_update_user)
           VALUES (in_mobile,
                   in_carries,
                   in_sim_credit,
                   in_sim_package,
                   in_billed_date,
                   in_last_topup_date,
                   in_next_topup_date,
                   in_password,
                   in_active,
                   SYSDATE,
                   in_user,
                   SYSDATE,
                   in_user);

      IF SQL%ROWCOUNT = 0
      THEN
         RETURN 1;
      ELSE
         RETURN 0;
      END IF;
   ELSE
      RETURN 0;
   END IF;
EXCEPTION
   WHEN OTHERS
   THEN
      RETURN 9;
END sp_ol_sim_cards_insert_update;
/

