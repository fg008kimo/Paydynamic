CREATE OR REPLACE FUNCTION sp_ol_statement_datetime_check(
	in_statement_date	ol_stmt_format_template.olft_format_template%type,
	in_statement_date_t	ol_stmt_format_template.olft_format_template%type,
	in_statement_time	ol_stmt_format_template.olft_format_template%type,
	in_statement_time_t	ol_stmt_format_template.olft_format_template%type,
	in_start_year		integer,
	out_stmt_datetime	OUT	ol_stmt_format_template.olft_format_template%type)
  RETURN NUMBER IS
	out_of_date	EXCEPTION;
	out_of_time	EXCEPTION;
	out_of_datetime	EXCEPTION;
	stmt_date	ol_statement_detail.olsd_statement_date%type;
	stmt_time	ol_statement_detail.olsd_statement_time%type;
BEGIN

	BEGIN
		SELECT	CASE WHEN in_statement_date_t is not null THEN
				to_char(add_months(to_date(in_statement_date,in_statement_date_t),in_start_year*12),'YYYYMMDD')
				ELSE in_statement_date
			END
		INTO	stmt_date
		FROM	DUAL;
	EXCEPTION
		WHEN OTHERS THEN
			RAISE out_of_date;
	END;

	BEGIN
		SELECT	CASE WHEN in_statement_time_t is not null THEN
				to_char(to_date(in_statement_time,in_statement_time_t),'HH24MISS')
				ELSE in_statement_time
			END
		INTO	stmt_time
		FROM	DUAL;
	EXCEPTION
		WHEN OTHERS THEN
			RAISE out_of_time;
	END;

	BEGIN
		SELECT	stmt_date||stmt_time
		INTO	out_stmt_datetime
		FROM	DUAL;
	EXCEPTION
		WHEN OTHERS THEN
			RAISE out_of_datetime;
	END;

	RETURN 0;

EXCEPTION
	WHEN out_of_date THEN
		RETURN 7;
	WHEN out_of_time THEN
		RETURN 8;
	WHEN OTHERS THEN
		RETURN 9;

END sp_ol_statement_datetime_check;
/
