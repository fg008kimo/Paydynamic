DROP VIEW OL_DEPOSIT_BANK_ACCT_VIEW

CREATE OR REPLACE FORCE VIEW OL_DEPOSIT_BANK_ACCT_VIEW
(
	MERCHANT_ID,
	ACCT_CCY,
	INT_BANK_CODE,
	BANK_ACCT_NUM,
	SERVICE_CODE,
	COUNTRY,
	SHARED_ACCT,
	STATUS_TYPE,
	UPDATE_TIMESTAMP,
	OWNER_NAME,
	BRANCH_NAME
)
AS
	SELECT	OMB_MERCHANT_ID,
		OB_ACCT_CCY,
		OMB_INT_BANK_CODE,
		OMB_BANK_ACCT_NUM,
		OMB_SERVICE_CODE,
		COUNTRY,
		OB_SHARED_ACCT,
		OB_STATUS_TYPE,
		OB_UPDATE_TIMESTAMP,
		OB_OWNER_NAME,
		OB_BRANCH_NAME
	FROM	OL_MERCHANT_BANK_ACCT,
		OL_BANK_ACCTS,
		OL_MERCH_DETAIL,
		CLIENTS,
		PSP_MASTER,
		BANK_DESC
	WHERE	OMB_INT_BANK_CODE = OB_INT_BANK_CODE
	AND	OMB_BANK_ACCT_NUM = OB_BANK_ACCT_NUM
	AND	OMB_DISABLED = 0
	AND	OMB_STATUS = 'O'
	AND	OB_ACCT_TYPE = 'DSI'
	AND	(
		(OB_STATUS_TYPE = 'A')
		OR
		(OB_STATUS_TYPE = 'F' AND OB_UPDATE_TIMESTAMP < sysdate - 14)
		)
	AND	OMB_MERCHANT_ID = MD_MERCHANT_ID
	AND	MD_DISABLED = 0
	AND	MD_STATUS = 'O'
	AND	MD_CLIENT_ID = CLIENT_ID
	AND	STATUS = 'O'
	AND	OB_PROVIDER_ID = PM_CLIENT_ID
	AND	PM_STATUS = 'O'
	AND	OMB_INT_BANK_CODE = INTERNAL_BANK_CODE
	AND	OFFLINE_SUPPORT = 1;

