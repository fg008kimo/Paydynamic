ALTER TABLE TXN_HEADER
 DROP PRIMARY KEY CASCADE;

DROP TABLE TXN_HEADER CASCADE CONSTRAINTS;

CREATE TABLE TXN_HEADER
(
  TH_TXN_ID                 VARCHAR2(16 BYTE)   NOT NULL,
  TH_ORG_TXN_ID             VARCHAR2(16 BYTE),
  TH_INPUT_CHANNEL          VARCHAR2(3 BYTE),
  TH_STATUS                 CHAR(1 BYTE),
  TH_AR_IND                 CHAR(1 BYTE),
  TH_TXN_CODE               VARCHAR2(3 BYTE),
  TH_PROCESS_TYPE           VARCHAR2(4 BYTE),
  TH_PROCESS_CODE           VARCHAR2(6 BYTE),
  TH_CLIENT_ID              VARCHAR2(10 BYTE),
  TH_MERCHANT_ID            VARCHAR2(15 BYTE),
  TH_MERCHANT_REF           VARCHAR2(50 BYTE),
  TH_HOST_POSTING_DATE      VARCHAR2(8 BYTE),
  TH_TRANSMISSION_DATETIME  VARCHAR2(14 BYTE),
  TH_INTERNAL_CODE          NUMBER(8),
  TH_RESPONSE_CODE          VARCHAR2(10 BYTE),
  TH_TRANSACTION_AMOUNT     NUMBER(12,2)        DEFAULT 0,
  TH_NET_AMOUNT             NUMBER(12,2)        DEFAULT 0,
  TH_TM_DATE                VARCHAR2(8 BYTE),
  TH_TM_TIME                VARCHAR2(6 BYTE),
  TH_LOCAL_TM_DATE          VARCHAR2(8 BYTE),
  TH_LOCAL_TM_TIME          VARCHAR2(6 BYTE),
  TH_CREATE_USER            VARCHAR2(20 BYTE),
  TH_CREATE_TIMESTAMP       DATE                DEFAULT sysdate,
  TH_UPDATE_USER            VARCHAR2(20 BYTE),
  TH_UPDATE_TIMESTAMP       DATE                DEFAULT sysdate,
  TH_CLIENT_IP              VARCHAR2(25 BYTE),
  TH_SERVICE_CODE           VARCHAR2(3 BYTE),
  TH_APPROVAL_DATE          VARCHAR2(8 BYTE),
  TH_RESERVE_AMOUNT         NUMBER(12,2)        DEFAULT 0,
  TH_EX_SUPPLIER            CHAR(1 BYTE),
  TH_EX_RATE                NUMBER(14,5),
  TH_NET_CCY                CHAR(3 BYTE),
  TH_APPROVAL_TIMESTAMP     TIMESTAMP(6),
  TH_SETTLEMENT_TXN_AMOUNT  NUMBER(12,2),
  TH_VNC_REF_NUM            VARCHAR2(16 BYTE),
  TH_SUB_STATUS             CHAR(3 BYTE),
  TH_RESERVED_RELEASE_DATE  VARCHAR2(8 BYTE),
  TH_INTER_CCY              CHAR(3 BYTE),
  TH_INTER_RATE             NUMBER(14,5),
  TH_ACK_STATUS             CHAR(3 BYTE)
)
TABLESPACE USER_DATA
RESULT_CACHE (MODE DEFAULT)
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          8M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING
ENABLE ROW MOVEMENT;

COMMENT ON COLUMN TXN_HEADER.TH_STATUS IS 'C for complete P for Process';

COMMENT ON COLUMN TXN_HEADER.TH_TXN_CODE IS 'A for Accept R for Reject';



CREATE INDEX TXN_HEADER_IDX01 ON TXN_HEADER
(TH_MERCHANT_ID, TH_MERCHANT_REF)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          113M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX02 ON TXN_HEADER
(TH_APPROVAL_DATE)
LOGGING
TABLESPACE USER_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          38M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX03 ON TXN_HEADER
(TH_SERVICE_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          47M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX04 ON TXN_HEADER
(TH_TXN_ID, TH_STATUS, TH_AR_IND)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          88M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX05 ON TXN_HEADER
(TH_TXN_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          47M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX06 ON TXN_HEADER
(TH_TXN_CODE, TH_STATUS, TH_AR_IND, TH_APPROVAL_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          81M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX07 ON TXN_HEADER
(TH_TXN_ID, TH_STATUS, TH_AR_IND, TH_TXN_CODE, TH_MERCHANT_ID, 
TH_APPROVAL_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          157M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX08 ON TXN_HEADER
(TH_TXN_ID, TH_TXN_CODE, TH_MERCHANT_ID, TH_HOST_POSTING_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          149M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX09 ON TXN_HEADER
(TH_INPUT_CHANNEL, TH_TXN_ID)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          88M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX10 ON TXN_HEADER
(TH_HOST_POSTING_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          65M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX11 ON TXN_HEADER
(TH_UPDATE_TIMESTAMP)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          72M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX12 ON TXN_HEADER
(TH_ORG_TXN_ID)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          256K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX13 ON TXN_HEADER
(TH_CREATE_TIMESTAMP, TH_TXN_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          88M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX14 ON TXN_HEADER
(TH_MERCHANT_ID, TH_SERVICE_CODE, TH_TXN_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          88M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX15 ON TXN_HEADER
(TH_STATUS, TH_AR_IND, TH_MERCHANT_ID, TH_TXN_CODE, TH_RESERVE_AMOUNT, 
TH_APPROVAL_TIMESTAMP, TH_RESERVED_RELEASE_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          147M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX16 ON TXN_HEADER
(TH_TXN_CODE, TH_APPROVAL_DATE, TH_MERCHANT_ID, TH_SERVICE_CODE, TH_AR_IND, 
TH_STATUS)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          122M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX17 ON TXN_HEADER
("TH_UPDATE_TIMESTAMP" DESC, TH_TXN_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          96M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX18 ON TXN_HEADER
(TH_TXN_CODE, TH_HOST_POSTING_DATE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          81M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX19 ON TXN_HEADER
(TH_MERCHANT_ID, TH_AR_IND, TH_SERVICE_CODE, TH_APPROVAL_TIMESTAMP)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          112M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX20 ON TXN_HEADER
(TH_ORG_TXN_ID, TH_TXN_CODE, TH_AR_IND, TH_MERCHANT_ID)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          88M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX21 ON TXN_HEADER
(TH_APPROVAL_TIMESTAMP)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          57M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX22 ON TXN_HEADER
(TH_TRANSACTION_AMOUNT)
LOGGING
TABLESPACE USER_DATA
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          46M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX23 ON TXN_HEADER
(TH_VNC_REF_NUM)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          72M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX24 ON TXN_HEADER
(TH_TXN_ID, TH_AR_IND, TH_TXN_CODE)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          96M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX25 ON TXN_HEADER
(TH_MERCHANT_ID, TH_AR_IND, TH_SERVICE_CODE, TH_APPROVAL_TIMESTAMP, TH_NET_CCY)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          128M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


CREATE INDEX TXN_HEADER_IDX26 ON TXN_HEADER
(TH_TXN_CODE, TH_CLIENT_ID, TH_CREATE_TIMESTAMP)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

CREATE INDEX TXN_HEADER_IDX27 ON TXN_HEADER
(TH_STATUS, TH_AR_IND, TH_TXN_CODE, TH_CREATE_TIMESTAMP, TH_APPROVAL_TIMESTAMP, 
TH_SERVICE_CODE, TH_MERCHANT_REF, TH_TXN_ID, TH_TRANSACTION_AMOUNT, TH_MERCHANT_ID, 
TH_CLIENT_ID)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX TXN_HEADER_PK ON TXN_HEADER
(TH_TXN_ID)
LOGGING
TABLESPACE USER_IDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          72M
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;


ALTER TABLE TXN_HEADER ADD (
  CONSTRAINT TXN_HEADER_PK
  PRIMARY KEY
  (TH_TXN_ID)
  USING INDEX TXN_HEADER_IDX04
  ENABLE VALIDATE);

ALTER TABLE TXN_HEADER ADD (
  CONSTRAINT TXN_HEADER_FK01 
  FOREIGN KEY (TH_SUB_STATUS) 
  REFERENCES DEF_SUB_STATUS (DS_SUB_STATUS)
  ENABLE VALIDATE);


