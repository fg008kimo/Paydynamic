/*
Partnerdelight (c)2011. All rights reserved. No part of this software may be reproduced in any form without written permission 
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2011/05/19              Simon Fung
Restruture BOCrrJnl and DBJnlHeader                2013/01/29              Stan Poon
PSP SETTLEMENT                                     2013/03/13              Stan Poon
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <oraca.h>
#include <sqlca.h>
#include "CrrJnlHeader.h"
#include "common.h"
#include "utilitys.h"
#include "dbutility.h"

#include <unistd.h>
#include <ctype.h>
#include <sys/types.h>
#include <time.h>
#include "myhash.h"
#include "numutility.h"
#include "myrecordset.h"
#include "ObjPtr.h"

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

OBJPTR(BO);
OBJPTR(DB);

char    cDebug;
void CrrJnlHeader(char    cdebug)
{
        cDebug = cdebug;
}

int Add(const hash_t *hRls)
{
	char	*csTmp;
	char  cTmp;
	int		iTmp;

  EXEC SQL WHENEVER SQLERROR GOTO add_error;
  EXEC SQL WHENEVER NOTFOUND CONTINUE;

  EXEC SQL BEGIN DECLARE SECTION;

  short 		hv_return_value;
  varchar		hv_jnl_id[PD_JNL_ID_LEN];	
	int		hv_jnl_type_id;	
	varchar		hv_description[PD_DESCRIPTION_LEN];	
	varchar		hv_txn_date[PD_TXN_DATE_LEN];	
	varchar		hv_bank_update_date[PD_BANK_UPDATE_DATE_LEN];	
	varchar		hv_acc_year[PD_ACC_YEAR_LEN];
	varchar		hv_acc_month[PD_ACC_MONTH_LEN];
	varchar		hv_country_code[PD_COUNTRY_CODE_LEN];
	varchar		hv_product_code[PD_PRODUCT_CODE_LEN];
	varchar		hv_ref_no[PD_REF_NO_LEN];	
	varchar		hv_remarks[PD_REMARKS_LEN];	
	char		hv_status;	
	int		hv_disabled;	
	varchar		hv_create_user[PD_CREATE_USER_LEN];	

	short		ind_jnl_id = -1;
	short		ind_jnl_type_id = -1;
	short		ind_description = -1;
	short		ind_txn_date = -1;
	short		ind_bank_update_date = -1;
	short		ind_acc_year = -1;
	short		ind_acc_month = -1;
	short		ind_country_code = -1;
	short		ind_product_code = -1;
	short		ind_ref_no = -1;
	short		ind_remarks = -1;
	short		ind_status = -1;
	short		ind_disabled = -1;
	short		ind_create_user = -1;


  EXEC SQL END DECLARE SECTION;

DEBUGLOG(("Add: Begin\n"));

	/* jnl_id */
	if (GetField_CString(hRls,"jnl_id",&csTmp)) {
		hv_jnl_id.len = strlen(csTmp);
		memcpy(hv_jnl_id.arr,csTmp,hv_jnl_id.len);
		ind_jnl_id = 0;
DEBUGLOG(("Add:jnl_id = [%.*s]\n",hv_jnl_id.len,hv_jnl_id.arr));
	} else {
DEBUGLOG(("Add:jnl_id not found\n"));
		return PD_ERR;
	}

	
	/* jnl_type_id */
	if (GetField_Int(hRls,"jnl_type_id",&iTmp)) {
		hv_jnl_type_id = iTmp;
		ind_jnl_type_id = 0;
DEBUGLOG(("Add:jnl_type_id = [%d]\n",hv_jnl_type_id));
	} else {
DEBUGLOG(("Add:jnl_type_id not found\n"));
		return PD_ERR;
	}

	
	/* description */
	if (GetField_CString(hRls,"description",&csTmp)) {
		hv_description.len = strlen(csTmp);
		memcpy(hv_description.arr,csTmp,hv_description.len);
		ind_description = 0;
DEBUGLOG(("Add:description = [%.*s]\n",hv_description.len,hv_description.arr));
	}

	
	/* txn_date */
	if (GetField_CString(hRls,"txn_date",&csTmp)) {
		hv_txn_date.len = strlen(csTmp);
		memcpy(hv_txn_date.arr,csTmp,hv_txn_date.len);
		ind_txn_date = 0;
DEBUGLOG(("Add:txn_date = [%.*s]\n",hv_txn_date.len,hv_txn_date.arr));
	} else {
DEBUGLOG(("Add:txn_date not found\n"));
		return PD_ERR;
	}


	
	/* bank_update_date */
	if (GetField_CString(hRls,"bank_update_date",&csTmp)) {
		hv_bank_update_date.len = strlen(csTmp);
		memcpy(hv_bank_update_date.arr,csTmp,hv_bank_update_date.len);
		ind_bank_update_date = 0;
DEBUGLOG(("Add:bank_update_date = [%.*s]\n",hv_bank_update_date.len,hv_bank_update_date.arr));
	}

	
	/* acc_year */
	if (GetField_CString(hRls,"acc_year",&csTmp)) {
		hv_acc_year.len = strlen(csTmp);
		memcpy(hv_acc_year.arr,csTmp,hv_acc_year.len);
		ind_acc_year = 0;
DEBUGLOG(("Add:acc_year = [%.*s]\n",hv_acc_year.len,hv_acc_year.arr));
	} else {
DEBUGLOG(("Add:acc_year not found\n"));
		return PD_ERR;
	}

	
	/* acc_month */
	if (GetField_CString(hRls,"acc_month",&csTmp)) {
		hv_acc_month.len = strlen(csTmp);
		memcpy(hv_acc_month.arr,csTmp,hv_acc_month.len);
		ind_acc_month = 0;
DEBUGLOG(("Add:acc_month = [%.*s]\n",hv_acc_month.len,hv_acc_month.arr));
	} else {
DEBUGLOG(("Add:acc_month not found\n"));
		return PD_ERR;
	}
	
	/* country_code */
	if (GetField_CString(hRls,"country_code",&csTmp)) {
		hv_country_code.len = strlen(csTmp);
		memcpy(hv_country_code.arr,csTmp,hv_country_code.len);
		ind_country_code = 0;
DEBUGLOG(("Add:country_code = [%.*s]\n",hv_country_code.len,hv_country_code.arr));
	} else {
DEBUGLOG(("Add:country_code not found\n"));
		return PD_ERR;
	}

	/* product_code */
	if (GetField_CString(hRls,"product_code",&csTmp)) {
		hv_product_code.len = strlen(csTmp);
		memcpy(hv_product_code.arr,csTmp,hv_product_code.len);
		ind_product_code = 0;
DEBUGLOG(("Add:product_code = [%.*s]\n",hv_product_code.len,hv_product_code.arr));
	} else {
DEBUGLOG(("Add:product_code not found\n"));
		return PD_ERR;
	}
	
	/* ref_no */
	if (GetField_CString(hRls,"ref_no",&csTmp)) {
		hv_ref_no.len = strlen(csTmp);
		memcpy(hv_ref_no.arr,csTmp,hv_ref_no.len);
		ind_ref_no = 0;
DEBUGLOG(("Add:ref_no = [%.*s]\n",hv_ref_no.len,hv_ref_no.arr));
	}

	
	/* remarks */
	if (GetField_CString(hRls,"remarks",&csTmp)) {
		hv_remarks.len = strlen(csTmp);
		memcpy(hv_remarks.arr,csTmp,hv_remarks.len);
		ind_remarks = 0;
DEBUGLOG(("Add:remarks = [%.*s]\n",hv_remarks.len,hv_remarks.arr));
	}

	/* status */ 
	if (GetField_Char(hRls,"status",&cTmp)) {
		hv_status = cTmp;
		ind_status = 0;
DEBUGLOG(("Add:status = [%c]\n",hv_status));
	} else {
DEBUGLOG(("Add:status not found\n"));
		return PD_ERR;
	}

	
	/* disabled */
	if (GetField_Int(hRls,"disabled",&iTmp)) {
		hv_disabled = iTmp;
		ind_disabled = 0;
DEBUGLOG(("Add:disabled = [%d]\n",hv_disabled));
	} else {
		hv_disabled = 0;
		ind_disabled = 0;
DEBUGLOG(("Add:disabled (default) = [%d]\n",hv_disabled));
	}
	
	/* create_user */
	if (GetField_CString(hRls,"create_user",&csTmp)) {
		hv_create_user.len = strlen(csTmp);
		memcpy(hv_create_user.arr,csTmp,hv_create_user.len);
		ind_create_user = 0;
DEBUGLOG(("Add:create_user = [%.*s]\n",hv_create_user.len,hv_create_user.arr));
	} else {
DEBUGLOG(("Add:create_user not found\n"));
		return PD_ERR;
	}
		
	EXEC SQL EXECUTE BEGIN
			:hv_return_value := sp_crr_jnl_header_insert(
			:hv_jnl_id:ind_jnl_id,
			:hv_jnl_type_id:ind_jnl_type_id,
			:hv_description:ind_description,
			:hv_txn_date:ind_txn_date,
			:hv_bank_update_date:ind_bank_update_date,
			:hv_acc_year:ind_acc_year,
			:hv_acc_month:ind_acc_month,
			:hv_country_code:ind_country_code,
			:hv_product_code:ind_product_code,			
			:hv_ref_no:ind_ref_no,
			:hv_remarks:ind_remarks,
			:hv_status:ind_status,
			:hv_disabled:ind_disabled,
			:hv_create_user:ind_create_user
					);
	        END;
        END-EXEC;

DEBUGLOG(("Add:Ret = [%d]\n",hv_return_value));
    
  if (hv_return_value == SP_OK) {
DEBUGLOG(("Add:Normal Exit\n"));
    return PD_OK;
  }

  if (hv_return_value == SP_OTHER_ERR)  {
		ERRLOG("CrrJnlHeader_Add: SP_OTHER_ERR TxnAbort\n");
DEBUGLOG(("Add: SP_OTHER_ERR TxnAbort\n"));
    return PD_OTHER_ERR;
  }

  if (hv_return_value == SP_ERR)  {
		ERRLOG("CrrJnlHeader_Add: SP_ERR TxnAbort\n");
DEBUGLOG(("Add: SP_ERR TxnAbort\n"));
    return PD_ERR;
  }

add_error:
DEBUGLOG(("add_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_Add: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Add: SP_INTERNAL_ERR TxnAbort\n"));

  return PD_INTERNAL_ERR;
}

int Update(const hash_t *hRls)
{

	char*	csTmp;
	char	cTmp;
	int	iTmp;
	char*	csBuf;
	char*	csJnlId;
  EXEC SQL WHENEVER SQLERROR GOTO update_error;
  EXEC SQL WHENEVER NOTFOUND CONTINUE;

  EXEC SQL BEGIN DECLARE SECTION;

	varchar 	hv_dynstmt[1024];

  EXEC SQL END DECLARE SECTION;

DEBUGLOG(("Update: Begin\n"));
	csBuf = (char*) malloc (128);
	strcpy((char*)hv_dynstmt.arr,"update crr_jnl_header set update_timestamp  = sysdate");

  if (GetField_CString(hRls,"jnl_id",&csJnlId)) {
DEBUGLOG(("Update:jnl_id = [%s]\n",csJnlId));
	} else {
DEBUGLOG(("Update:jnl_id not found\n"));
		return PD_ERR;
	}
				
	/* jnl_type_id  */
	if (GetField_Int(hRls,"jnl_type_id",&iTmp)) {
DEBUGLOG(("Update:jnl_type_id = [%d]\n",iTmp));
		sprintf(csBuf,"%d",iTmp);
		strcat((char*)hv_dynstmt.arr, ",jnl_type_id = ");
		strcat((char*)hv_dynstmt.arr, csBuf);
		//strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* description */
	if (GetField_CString(hRls,"description",&csTmp)) {
DEBUGLOG(("Update:description = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",description = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* txn_date */
	if (GetField_CString(hRls,"txn_date",&csTmp)) {
DEBUGLOG(("Update:txn_date = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",txn_date = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* bank_update_date */
	if (GetField_CString(hRls,"bank_update_date",&csTmp)) {
DEBUGLOG(("Update:bank_update_date = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",bank_update_date = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* acc_year  */
	if (GetField_CString(hRls,"acc_year",&csTmp)) {
DEBUGLOG(("Update:acc_year = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",acc_year = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* acc_month  */
	if (GetField_CString(hRls,"acc_month",&csTmp)) {
DEBUGLOG(("Update:acc_month = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",acc_month = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	/* country_code  */
	if (GetField_CString(hRls,"country_code",&csTmp)) {
DEBUGLOG(("Update:country_code = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",country_code = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	/* product_code  */
	if (GetField_CString(hRls,"product_code",&csTmp)) {
DEBUGLOG(("Update:product_code = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",product_code = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}	
	
	/* ref_no */
	if (GetField_CString(hRls,"ref_no",&csTmp)) {
DEBUGLOG(("Update:ref_no = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",ref_no = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* remarks */
	if (GetField_CString(hRls,"remarks",&csTmp)) {
DEBUGLOG(("Update:remarks = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",remarks = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* status */ 
	if (GetField_Char(hRls,"status",&cTmp)) {
DEBUGLOG(("Update:status = [%c]\n",cTmp));
		sprintf(csBuf,"%c",cTmp);
		strcat((char*)hv_dynstmt.arr, ",status = '");
		strcat((char*)hv_dynstmt.arr, csBuf);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}

	
	/* disabled  */
	if (GetField_Int(hRls,"disabled",&iTmp)) {
DEBUGLOG(("Update:disabled = [%d]\n",iTmp));
		sprintf(csBuf,"%d",iTmp);
		strcat((char*)hv_dynstmt.arr, ",disabled = ");
		strcat((char*)hv_dynstmt.arr, csBuf);
		//strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}
	
	/* update_user */
	if (GetField_CString(hRls,"update_user",&csTmp)) {
DEBUGLOG(("Update:update_user = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",update_user = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
		//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	}
	
	// Reset the approval/booked whenever updated
	strcat((char*)hv_dynstmt.arr, ",approve_user = NULL");
	strcat((char*)hv_dynstmt.arr, ",approve_timestamp = NULL");
	strcat((char*)hv_dynstmt.arr, ",book_user = NULL");
	strcat((char*)hv_dynstmt.arr, ",book_timestamp = NULL");
		
	strcat((char *)hv_dynstmt.arr, " WHERE jnl_id = '");
  strcat((char *)hv_dynstmt.arr, csJnlId);
  strcat((char *)hv_dynstmt.arr, "'");
 	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;

	FREE_ME(csBuf);
	
DEBUGLOG(("Update Normal Exit\n"));
	return PD_OK;

update_error:
DEBUGLOG(("update_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_Update: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Update: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int Delete(const hash_t *hRls)
{

	char*	csTmp;
	char*	csBuf;
	char*	csJnlId;
  EXEC SQL WHENEVER SQLERROR GOTO disable_error;
  EXEC SQL WHENEVER NOTFOUND CONTINUE;

  EXEC SQL BEGIN DECLARE SECTION;

	varchar 	hv_dynstmt[1024];

  EXEC SQL END DECLARE SECTION;

DEBUGLOG(("Delete: Begin\n"));
	csBuf = (char*) malloc (128);
	strcpy((char*)hv_dynstmt.arr,"update crr_jnl_header set update_timestamp  = sysdate, disabled = 1 ");

  if (GetField_CString(hRls,"jnl_id",&csJnlId)) {
DEBUGLOG(("Delete:jnl_id = [%s]\n",csJnlId));
	} else {
DEBUGLOG(("Delete:jnl_id not found\n"));
		return PD_ERR;
	}
			
	/* update_user */
	if (GetField_CString(hRls,"update_user",&csTmp)) {
DEBUGLOG(("Delete:update_user = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",update_user = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");
	} else {
DEBUGLOG(("Delete:update_user not found\n"));
		return PD_ERR;
	}
	
	strcat((char *)hv_dynstmt.arr, " WHERE jnl_id = '");
  strcat((char *)hv_dynstmt.arr, csJnlId);
  strcat((char *)hv_dynstmt.arr, "'");
 	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;

	FREE_ME(csBuf);

DEBUGLOG(("Delete Normal Exit\n"));
	return PD_OK;

disable_error:
DEBUGLOG(("delete_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_Delete: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Delete: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int Approve(const hash_t *hRls)
{

	char*	csTmp;
	char*	csBuf;
	char*	csJnlId;
  EXEC SQL WHENEVER SQLERROR GOTO approve_error;
  EXEC SQL WHENEVER NOTFOUND CONTINUE;

  EXEC SQL BEGIN DECLARE SECTION;

	varchar 	hv_dynstmt[1024];

  EXEC SQL END DECLARE SECTION;

DEBUGLOG(("Approve: Begin\n"));
	csBuf = (char*) malloc (128);
	strcpy((char*)hv_dynstmt.arr,"update crr_jnl_header set approve_timestamp  = sysdate");

  if (GetField_CString(hRls,"jnl_id",&csJnlId)) {
DEBUGLOG(("Approve:jnl_id = [%s]\n",csJnlId));
	} else {
DEBUGLOG(("Approve:jnl_id not found\n"));
		return PD_ERR;
	}
			
	/* status to A */ 
DEBUGLOG(("Approve:status = [%c]\n",PD_JNL_APPROVED));
	sprintf(csBuf,"%c",PD_JNL_APPROVED);
	strcat((char*)hv_dynstmt.arr, ",status = '");
	strcat((char*)hv_dynstmt.arr, csBuf);
	strcat((char*)hv_dynstmt.arr, "'");

	/* approve_user */
	if (GetField_CString(hRls,"approve_user",&csTmp)) {
DEBUGLOG(("Approve:approve_user = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",approve_user = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");	
	} else {
DEBUGLOG(("Approve:approve_user not found\n"));
		return PD_ERR;
	}
	
	strcat((char *)hv_dynstmt.arr, " WHERE jnl_id = '");
	strcat((char *)hv_dynstmt.arr, csJnlId);
	strcat((char *)hv_dynstmt.arr, "'");
	// Approve only pending journal
	/*
	sprintf(csBuf,"%c",PD_JNL_PENDING);
	strcat((char*)hv_dynstmt.arr, " AND STATUS = '");
	strcat((char*)hv_dynstmt.arr, csBuf);
	strcat((char*)hv_dynstmt.arr, "'");	
	*/

	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;

	FREE_ME(csBuf);

DEBUGLOG(("Approve Normal Exit\n"));
	return PD_OK;

approve_error:
DEBUGLOG(("approve_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_Approve: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Approve: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int Release(const hash_t *hRls)
{

	char*	csTmp;
	char*	csBuf;
	char*	csJnlId;
  EXEC SQL WHENEVER SQLERROR GOTO release_error;
  EXEC SQL WHENEVER NOTFOUND CONTINUE;

  EXEC SQL BEGIN DECLARE SECTION;

	varchar 	hv_dynstmt[1024];

  EXEC SQL END DECLARE SECTION;

DEBUGLOG(("Release: Begin\n"));
	csBuf = (char*) malloc (128);
	strcpy((char*)hv_dynstmt.arr,"update crr_jnl_header set update_timestamp  = sysdate");

   if (GetField_CString(hRls,"jnl_id",&csJnlId)) {
DEBUGLOG(("Release:jnl_id = [%s]\n",csJnlId));
	} else {
DEBUGLOG(("Release:jnl_id not found\n"));
		return PD_ERR;
	}
			
	/* status to P */ 
DEBUGLOG(("Release:status = [%c]\n",PD_JNL_PENDING));
	sprintf(csBuf,"%c",PD_JNL_PENDING);
	strcat((char*)hv_dynstmt.arr, ",status = '");
	strcat((char*)hv_dynstmt.arr, csBuf);
	strcat((char*)hv_dynstmt.arr, "'");

	/* update_user */
	if (GetField_CString(hRls,"update_user",&csTmp)) {
DEBUGLOG(("Release:update_user = [%s]\n",csTmp));
		strcat((char*)hv_dynstmt.arr, ",update_user = '");
		strcat((char*)hv_dynstmt.arr, csTmp);
		strcat((char*)hv_dynstmt.arr, "'");	
	} else {
DEBUGLOG(("Release:update_user not found\n"));
		return PD_ERR;
	}

	// Reset the approval/booked when release
	strcat((char*)hv_dynstmt.arr, ",approve_user = NULL");
	strcat((char*)hv_dynstmt.arr, ",approve_timestamp = NULL");
	strcat((char*)hv_dynstmt.arr, ",book_user = NULL");
	strcat((char*)hv_dynstmt.arr, ",book_timestamp = NULL");
	
	strcat((char *)hv_dynstmt.arr, " WHERE jnl_id = '");
  strcat((char *)hv_dynstmt.arr, csJnlId);
  strcat((char *)hv_dynstmt.arr, "'");
 	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;

	FREE_ME(csBuf);

DEBUGLOG(("Release Normal Exit\n"));
	return PD_OK;

release_error:
DEBUGLOG(("release_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_Release: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Approve: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int GetJnlStatus(const char* csJnlId, char* cJnlStatus)
{
	EXEC SQL WHENEVER SQLERROR GOTO GetJnlStatus_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;

	varchar		hv_jnl_id[PD_JNL_ID_LEN];	
	char		hv_status;	
	short		ind_status = -1;

	EXEC SQL END DECLARE SECTION;

DEBUGLOG(("GetJnlStatus: Begin\n"));
		
	/* jnl_id */
	hv_jnl_id.len = strlen(csJnlId);
	memcpy(hv_jnl_id.arr,csJnlId,hv_jnl_id.len);
DEBUGLOG(("GetJnlStatus:jnl_id = [%.*s]\n",hv_jnl_id.len,hv_jnl_id.arr));

	EXEC SQL EXECUTE
		BEGIN
		SELECT STATUS INTO :hv_status:ind_status
			FROM CRR_JNL_HEADER 
			WHERE JNL_ID = :hv_jnl_id;
    END;
	END-EXEC;
        	
	if (ind_status == -1) {
		hv_status = ' ';
	}
	
	*cJnlStatus = (char) hv_status;

DEBUGLOG(("GetJnlStatus:status = [%c]\n",hv_status));
	
	return PD_OK;

GetJnlStatus_error:
DEBUGLOG(("GetJnlStatus_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_GetJnlStatus: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("Add: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int GetJnlAccYearMonth(const char* csJnlId, char* csAccYear, char* csAccMonth)
{
	EXEC SQL WHENEVER SQLERROR GOTO GetJnlAccYearMonth_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;

		varchar		hv_jnl_id[PD_JNL_ID_LEN];
		short		ind_jnl_id = -1;
		
		varchar		v_acc_year[PD_ACC_YEAR_LEN+1];
		short		ind_acc_year = -1;	
		
		varchar		v_acc_month[PD_ACC_MONTH_LEN+1];	
		short		ind_acc_month = -1;	

	EXEC SQL END DECLARE SECTION;

DEBUGLOG(("GetJnlAccYearMonth: Begin\n"));
		
	hv_jnl_id.len = strlen(csJnlId);
	memcpy(hv_jnl_id.arr,csJnlId,hv_jnl_id.len);
DEBUGLOG(("GetJnlAccYearMonth:jnl_id = [%.*s]\n",hv_jnl_id.len,hv_jnl_id.arr));
	ind_jnl_id = 0;

	EXEC SQL DECLARE c_cursor_get CURSOR FOR
		SELECT	
			ACC_YEAR,
			ACC_MONTH
		FROM	
			CRR_JNL_HEADER
		WHERE	
			JNL_ID = :hv_jnl_id:ind_jnl_id;

	EXEC SQL OPEN c_cursor_get;
	
	do {
		EXEC SQL FETCH c_cursor_get
			INTO
		:v_acc_year:ind_acc_year,
		:v_acc_month:ind_acc_month;

		if (SQLCODE == SQL_NOT_FOUND) {
			break;
		}

		if(ind_acc_year>=0) {
			v_acc_year.arr[v_acc_year.len] = '\0';
			strcpy(csAccYear,(const char *)v_acc_year.arr);
DEBUGLOG(("GetJnlAccYearMonth:csAccYear = [%s]\n",csAccYear));
		} else {
DEBUGLOG(("GetJnlAccYearMonth:v_acc_year not found\n"));			
		}

		if(ind_acc_month>=0) {
			v_acc_month.arr[v_acc_month.len] = '\0';
			strcpy(csAccMonth,(const char *)v_acc_month.arr);
DEBUGLOG(("GetJnlAccYearMonth:csAccMonth = [%s]\n",csAccMonth));			
			
		} else {
DEBUGLOG(("GetJnlAccYearMonth:v_acc_month not found\n"));			
		}
		

	} while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_get;
DEBUGLOG(("GetJnlAccYearMonth Normal Exit\n")); 
	return PD_OK;

GetJnlAccYearMonth_error:
DEBUGLOG(("GetJnlAccYearMonth_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	//ERRLOG("CrrJnlHeader_GetJnlAccYearMonth: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("GetJnlAccYearMonth: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}

int GetPostJnl(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct, const char* csJnlType, const char cPostType)
{
	hash_t *myHash;
	
	char csPostType[PD_JNL_TYPE_POST_TYPE_LEN + 1];
	sprintf(csPostType,"%c",cPostType);
	
	EXEC SQL WHENEVER SQLERROR GOTO GetPostJnl_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
	varchar	v_jnl_id[PD_TXN_SEQ_LEN + 1];
	short	ind_jnl_id = -1;

	varchar	v_cr_txn_date[PD_DATE_LEN + 1];
	short	ind_cr_txn_date = -1;
	
	varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
	short	ind_country = -1;
	
	varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
	short	ind_product = -1;

	varchar	v_jnl_type[PD_JNL_TYPE_PREFIX_LEN + 1];
	short	ind_jnl_type = -1;

	varchar	v_post_type[PD_JNL_TYPE_POST_TYPE_LEN + 1];
	short	ind_post_type = -1;

	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	
	
	v_jnl_type.len = strlen(csJnlType);
	memcpy(v_jnl_type.arr,csJnlType,v_jnl_type.len);
	ind_jnl_type = 0;	

	v_post_type.len = PD_JNL_TYPE_POST_TYPE_LEN;
	memcpy(v_post_type.arr,csPostType,v_post_type.len);
	ind_post_type = 0;	

DEBUGLOG(("GetPostJnl csTxnDate = [%s], csCountry = [%s], csProduct = [%s], csJnlType = [%s], csPostType = [%]\n ",csTxnDate,csCountry,csProduct,csJnlType, csPostType));
	
	EXEC SQL DECLARE c_cursor_GetPostJnl CURSOR FOR
		select cjh.jnl_id
		from crr_jnl_header cjh, crr_jnl_type cjt
		where cjh.disabled = 0
		and cjt.disabled = 0
		and cjt.post_type = :v_post_type:ind_post_type
		and cjh.txn_date = :v_cr_txn_date:ind_cr_txn_date 
		and cjh.country_code = :v_country:ind_country 
		and cjh.product_code = :v_product:ind_product
		and cjt.prefix = :v_jnl_type:ind_jnl_type
		and cjh.jnl_type_id = cjt.jnl_type_id;	
	
	
	EXEC SQL OPEN c_cursor_GetPostJnl;
        do {    
        	EXEC SQL FETCH c_cursor_GetPostJnl
              	INTO			
			:v_jnl_id:ind_jnl_id;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_jnl_id >= 0) {
				v_jnl_id.arr[v_jnl_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_id",(const char*)v_jnl_id.arr);
DEBUGLOG(("GetPostJnl v_jnl_id = [%s]\n",v_jnl_id.arr)); 
			}
		
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetPostJnl;

DEBUGLOG(("GetPostJnl Normal Exit\n")); 
	return  PD_OK;

GetPostJnl_error:
DEBUGLOG(("GetPostJnl_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetPostJnl;
	return PD_ERR;
}

int GetAllPostJnl(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct, const char cPostType)
{
	hash_t *myHash;
	char csPostType[PD_JNL_TYPE_POST_TYPE_LEN + 1];
	sprintf(csPostType,"%c",cPostType);

	EXEC SQL WHENEVER SQLERROR GOTO GetAllPostJnl_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_jnl_id[PD_TXN_SEQ_LEN + 1];
		short	ind_jnl_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;

		varchar	v_post_type[PD_JNL_TYPE_POST_TYPE_LEN + 1];
		short	ind_post_type = -1;

	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

	v_post_type.len = PD_JNL_TYPE_POST_TYPE_LEN;
	memcpy(v_post_type.arr,csPostType,v_post_type.len);
	ind_post_type = 0;	

DEBUGLOG(("GetAllPostJnl csTxnDate = [%s], csCountry = [%s], csProduct = [%s], csPostType = [%s]\n ",csTxnDate,csCountry,csProduct,csPostType));
	
	EXEC SQL DECLARE c_cursor_GetAllPostJnl CURSOR FOR
		select cjh.jnl_id
		from crr_jnl_header cjh, crr_jnl_type cjt
		where cjh.disabled = 0
		and cjt.disabled = 0
		and cjt.post_type = :v_post_type:ind_post_type
		and cjh.txn_date = :v_cr_txn_date:ind_cr_txn_date 
		and cjh.country_code = :v_country:ind_country 
		and cjh.product_code = :v_product:ind_product
		and cjh.jnl_type_id = cjt.jnl_type_id;	
	
	
	EXEC SQL OPEN c_cursor_GetAllPostJnl;
        do {    
        	EXEC SQL FETCH c_cursor_GetAllPostJnl
              	INTO			
			:v_jnl_id:ind_jnl_id;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_jnl_id >= 0) {
				v_jnl_id.arr[v_jnl_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_id",(const char*)v_jnl_id.arr);
DEBUGLOG(("GetAllPostJnl v_jnl_id = [%s]\n",v_jnl_id.arr)); 
			}
		
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetAllPostJnl;

DEBUGLOG(("GetAllPostJnl Normal Exit\n")); 
	return  PD_OK;

GetAllPostJnl_error:
DEBUGLOG(("GetAllPostJnl_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetAllPostJnl;
	return PD_ERR;
}

int UpdateMonthEnd(const char* csTbYear, const char* csTbMonth, const char* csBookUser)
{
	char*	csBuf;

	EXEC SQL WHENEVER SQLERROR GOTO monthend_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;

	EXEC SQL BEGIN DECLARE SECTION;

	varchar 	hv_dynstmt[1024];

	EXEC SQL END DECLARE SECTION;

DEBUGLOG(("UpdateMonthEnd: Begin\n"));
	csBuf = (char*) malloc (128);
	
	strcpy((char*)hv_dynstmt.arr,"update crr_jnl_header set book_timestamp  = sysdate");
	//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);

DEBUGLOG(("UpdateMonthEnd:csTbYear = [%s]\n",csTbYear));
DEBUGLOG(("UpdateMonthEnd:csTbMonth = [%s]\n",csTbMonth));
DEBUGLOG(("UpdateMonthEnd:csBookUser = [%s]\n",csBookUser));	
			
	/* status to PD_JNL_POSTED (B) */
DEBUGLOG(("UpdateMonthEnd:status = [%c]\n",PD_JNL_POSTED));
	sprintf(csBuf,"%c",PD_JNL_POSTED);
	strcat((char*)hv_dynstmt.arr, ",status = '");
	strcat((char*)hv_dynstmt.arr, csBuf);
	strcat((char*)hv_dynstmt.arr, "'");
	//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);

	/* book_user */
DEBUGLOG(("UpdateMonthEnd:book_user = [%s]\n",csBookUser));
	strcat((char*)hv_dynstmt.arr, ",book_user = '");
	strcat((char*)hv_dynstmt.arr, csBookUser);
	strcat((char*)hv_dynstmt.arr, "'");
	//hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);

	strcat((char *)hv_dynstmt.arr, " WHERE acc_year = '");
	strcat((char *)hv_dynstmt.arr, csTbYear);
	strcat((char *)hv_dynstmt.arr, "'");
	strcat((char *)hv_dynstmt.arr, " AND acc_month = '");
	strcat((char *)hv_dynstmt.arr, csTbMonth);
	strcat((char *)hv_dynstmt.arr, "'");
	strcat((char *)hv_dynstmt.arr, " AND status = '");
	sprintf(csBuf,"%c",PD_JNL_APPROVED);
	strcat((char *)hv_dynstmt.arr, csBuf);
	strcat((char *)hv_dynstmt.arr, "'");  
	strcat((char *)hv_dynstmt.arr, " AND disabled = 0");

 	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;

DEBUGLOG(("UpdateMonthEnd: Start to add change log\n"));
	strcpy((char *)hv_dynstmt.arr,"insert into crr_jnl_change_log");
	strcat((char *)hv_dynstmt.arr, " select (select max(jnl_change_log_id)  from crr_jnl_change_log)+rownum jnl_change_log_id,");
	strcat((char *)hv_dynstmt.arr, " jnl_id, null,null, 'Post', status, book_user, sysdate, book_user ");
	strcat((char *)hv_dynstmt.arr, " from crr_jnl_header ");
	strcat((char *)hv_dynstmt.arr, " WHERE acc_year = '");
	strcat((char *)hv_dynstmt.arr, csTbYear);
	strcat((char *)hv_dynstmt.arr, "'");
	strcat((char *)hv_dynstmt.arr, " AND acc_month = '");
	strcat((char *)hv_dynstmt.arr, csTbMonth);
	strcat((char *)hv_dynstmt.arr, "'");
	strcat((char *)hv_dynstmt.arr, " AND status = '");
	sprintf(csBuf,"%c",PD_JNL_POSTED);
	strcat((char *)hv_dynstmt.arr, csBuf);
	strcat((char *)hv_dynstmt.arr, "'");  
	strcat((char *)hv_dynstmt.arr, " AND disabled = 0");
	
	hv_dynstmt.len = strlen((const char*)hv_dynstmt.arr);
	
DEBUGLOG(("SQL = [%.*s]\n",hv_dynstmt.len,hv_dynstmt.arr));

	EXEC SQL PREPARE PS FROM :hv_dynstmt;
	EXEC SQL EXECUTE PS;
	
	FREE_ME(csBuf);
	
DEBUGLOG(("UpdateMonthEnd Normal Exit\n"));
	return PD_OK;

monthend_error:
DEBUGLOG(("UpdateMonthEnd_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	ERRLOG("CrrJnlHeader_UpdateMonthEnd: SP_INTERNAL_ERR TxnAbort\n");
DEBUGLOG(("UpdateMonthEnd: SP_INTERNAL_ERR TxnAbort\n"));
	return PD_INTERNAL_ERR;
}





int GetApprovedDeposit(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetApprovedDeposit_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetApprovedDeposit csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetApprovedDeposit csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetApprovedDeposit csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetApprovedDeposit CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from crr_apl_deposit_view
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

DEBUGLOG(("GetApprovedDeposit opening cursor...\n"));
	EXEC SQL OPEN c_cursor_GetApprovedDeposit;
DEBUGLOG(("GetApprovedDeposit cursor opened\n"));
        do {    
DEBUGLOG(("GetApprovedDeposit fetching cursor...\n"));
        	EXEC SQL FETCH c_cursor_GetApprovedDeposit
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;
DEBUGLOG(("GetApprovedDeposit cursor fetched\n"));

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

DEBUGLOG(("GetApprovedDeposit allocating hash...\n"));
			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);
DEBUGLOG(("GetApprovedDeposit hash allocated\n"));

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetApprovedDeposit v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetApprovedDeposit v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetApprovedDeposit v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetApprovedDeposit v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetApprovedDeposit v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetApprovedDeposit v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetApprovedDeposit v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetApprovedDeposit v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetApprovedDeposit v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetApprovedDeposit v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetApprovedDeposit v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetApprovedDeposit v_txn_amt = [%f]\n",v_txn_amt)); 
			}			

DEBUGLOG(("GetApprovedDeposit adding RecordSet...\n"));
			RecordSet_Add(myRec,myHash);
DEBUGLOG(("GetApprovedDeposit RecordSet added\n"));
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetApprovedDeposit;

DEBUGLOG(("GetApprovedDeposit Normal Exit\n")); 
	return  PD_OK;

GetApprovedDeposit_error:
DEBUGLOG(("GetApprovedDeposit_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetApprovedDeposit;
	return PD_ERR;
}

/*
int GetVoidDeposit(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetVoidDeposit_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetVoidDeposit csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetVoidDeposit csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetVoidDeposit csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetVoidDeposit CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_VOD_DEPOSIT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetVoidDeposit;
        do {    
        	EXEC SQL FETCH c_cursor_GetVoidDeposit
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetVoidDeposit v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetVoidDeposit v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetVoidDeposit v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetVoidDeposit v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetVoidDeposit v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetVoidDeposit v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetVoidDeposit v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetVoidDeposit v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetVoidDeposit v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetVoidDeposit v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetVoidDeposit v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetVoidDeposit v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetVoidDeposit;

DEBUGLOG(("GetVoidDeposit Normal Exit\n")); 
	return  PD_OK;

GetVoidDeposit_error:
DEBUGLOG(("GetVoidDeposit_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetVoidDeposit;
	return PD_ERR;
}
*/

int GetReconDeposit(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetReconDeposit_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetReconDeposit csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetReconDeposit csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetReconDeposit csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetReconDeposit CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_REC_DEPOSIT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetReconDeposit;
        do {    
        	EXEC SQL FETCH c_cursor_GetReconDeposit
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetReconDeposit v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetReconDeposit v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetReconDeposit v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetReconDeposit v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetReconDeposit v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetReconDeposit v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetReconDeposit v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetReconDeposit v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetReconDeposit v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetReconDeposit v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetReconDeposit v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetReconDeposit v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetReconDeposit;

DEBUGLOG(("GetReconDeposit Normal Exit\n")); 
	return  PD_OK;

GetReconDeposit_error:
DEBUGLOG(("GetReconDeposit_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetReconDeposit;
	return PD_ERR;
}

int GetVoidReconDeposit(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetVoidReconDeposit_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetVoidReconDeposit csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetVoidReconDeposit csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetVoidReconDeposit csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetVoidReconDeposit CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_VOD_REC_DEPOSIT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetVoidReconDeposit;
        do {    
        	EXEC SQL FETCH c_cursor_GetVoidReconDeposit
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetVoidReconDeposit v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetVoidReconDeposit v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetVoidReconDeposit v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetVoidReconDeposit v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetVoidReconDeposit v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetVoidReconDeposit v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetVoidReconDeposit v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetVoidReconDeposit v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetVoidReconDeposit v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetVoidReconDeposit v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetVoidReconDeposit v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetVoidReconDeposit v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetVoidReconDeposit;

DEBUGLOG(("GetVoidReconDeposit Normal Exit\n")); 
	return  PD_OK;

GetVoidReconDeposit_error:
DEBUGLOG(("GetVoidReconDeposit_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetVoidReconDeposit;
	return PD_ERR;
}

int GetDepositCostAdj(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetDepositCostAdj_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetDepositCostAdj csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetDepositCostAdj csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetDepositCostAdj csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetDepositCostAdj CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from crr_deposit_cost_adj_view
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetDepositCostAdj;
        do {    
        	EXEC SQL FETCH c_cursor_GetDepositCostAdj
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetDepositCostAdj v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetDepositCostAdj v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetDepositCostAdj v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetDepositCostAdj v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetDepositCostAdj v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetDepositCostAdj v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetDepositCostAdj v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetDepositCostAdj v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetDepositCostAdj v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetDepositCostAdj v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetDepositCostAdj v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetDepositCostAdj v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetDepositCostAdj;

DEBUGLOG(("GetDepositCostAdj Normal Exit\n")); 
	return  PD_OK;

GetDepositCostAdj_error:
DEBUGLOG(("GetDepositCostAdj_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetDepositCostAdj;
	return PD_ERR;
}

int GetApprovedPayout(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetApprovedPayout_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetApprovedPayout csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetApprovedPayout csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetApprovedPayout csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetApprovedPayout CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_PAYOUT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetApprovedPayout;
        do {    
        	EXEC SQL FETCH c_cursor_GetApprovedPayout
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetApprovedPayout v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetApprovedPayout v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetApprovedPayout v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetApprovedPayout v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetApprovedPayout v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetApprovedPayout v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetApprovedPayout v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetApprovedPayout v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetApprovedPayout v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetApprovedPayout v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetApprovedPayout v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetApprovedPayout v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetApprovedPayout;

DEBUGLOG(("GetApprovedPayout Normal Exit\n")); 
	return  PD_OK;

GetApprovedPayout_error:
DEBUGLOG(("GetApprovedPayout_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetApprovedPayout;
	return PD_ERR;
}

int GetGeneratedPayout(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetGeneratedPayout_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetGeneratedPayout csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetGeneratedPayout csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetGeneratedPayout csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetGeneratedPayout CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_GEN_PAYOUT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetGeneratedPayout;
        do {    
        	EXEC SQL FETCH c_cursor_GetGeneratedPayout
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetGeneratedPayout v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetGeneratedPayout v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetGeneratedPayout v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetGeneratedPayout v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetGeneratedPayout v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetGeneratedPayout v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetGeneratedPayout v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetGeneratedPayout v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetGeneratedPayout v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetGeneratedPayout v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetGeneratedPayout v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetGeneratedPayout v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetGeneratedPayout;

DEBUGLOG(("GetGeneratedPayout Normal Exit\n")); 
	return  PD_OK;

GetGeneratedPayout_error:
DEBUGLOG(("GetGeneratedPayout_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetGeneratedPayout;
	return PD_ERR;
}

int GetVoidApprovedPayout(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetVoidApprovedPayout_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetVoidApprovedPayout csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetVoidApprovedPayout csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetVoidApprovedPayout csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetVoidApprovedPayout CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_VOD_APL_PAYOUT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetVoidApprovedPayout;
        do {    
        	EXEC SQL FETCH c_cursor_GetVoidApprovedPayout
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetVoidApprovedPayout v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetVoidApprovedPayout v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetVoidApprovedPayout v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetVoidApprovedPayout v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetVoidApprovedPayout v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetVoidApprovedPayout v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetVoidApprovedPayout v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetVoidApprovedPayout v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetVoidApprovedPayout v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetVoidApprovedPayout v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetVoidApprovedPayout v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetVoidApprovedPayout v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetVoidApprovedPayout;

DEBUGLOG(("GetVoidApprovedPayout Normal Exit\n")); 
	return  PD_OK;

GetVoidApprovedPayout_error:
DEBUGLOG(("GetVoidApprovedPayout_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetVoidApprovedPayout;
	return PD_ERR;
}

int GetVoidGenPayout(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetVoidGenPayout_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;		
		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetVoidGenPayout csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetVoidGenPayout csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetVoidGenPayout csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetVoidGenPayout CURSOR FOR
		select cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_VOD_GEN_PAYOUT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product;

	EXEC SQL OPEN c_cursor_GetVoidGenPayout;
        do {    
        	EXEC SQL FETCH c_cursor_GetVoidGenPayout
              	INTO
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetVoidGenPayout v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetVoidGenPayout v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetVoidGenPayout v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetVoidGenPayout v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetVoidGenPayout v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetVoidGenPayout v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetVoidGenPayout v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetVoidGenPayout v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetVoidGenPayout v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetVoidGenPayout v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetVoidGenPayout v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetVoidGenPayout v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetVoidGenPayout;

DEBUGLOG(("GetVoidGenPayout Normal Exit\n")); 
	return  PD_OK;

GetVoidGenPayout_error:
DEBUGLOG(("GetVoidGenPayout_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetVoidGenPayout;
	return PD_ERR;
}

int GetApprovedMst(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetApprovedMst_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetApprovedMst csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetApprovedMst csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetApprovedMst csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetApprovedMst CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_SETTLE_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;

	EXEC SQL OPEN c_cursor_GetApprovedMst;
        do {    
        	EXEC SQL FETCH c_cursor_GetApprovedMst
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetApprovedMst v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetApprovedMst v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetApprovedMst v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetApprovedMst v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetApprovedMst v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetApprovedMst v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetApprovedMst v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetApprovedMst v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetApprovedMst v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetApprovedMst v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetApprovedMst v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetApprovedMst v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetApprovedMst v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetApprovedMst;

DEBUGLOG(("GetApprovedMst Normal Exit\n")); 
	return  PD_OK;

GetApprovedMst_error:
DEBUGLOG(("GetApprovedMst_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetApprovedMst;
	return PD_ERR;
}

int GetDeliveredMst(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetDeliveredMst_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetDeliveredMst csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetDeliveredMst csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetDeliveredMst csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetDeliveredMst CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_DEL_SETTLE_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;

	EXEC SQL OPEN c_cursor_GetDeliveredMst;
        do {    
        	EXEC SQL FETCH c_cursor_GetDeliveredMst
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetDeliveredMst v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetDeliveredMst v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetDeliveredMst v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetDeliveredMst v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetDeliveredMst v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetDeliveredMst v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetDeliveredMst v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetDeliveredMst v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetDeliveredMst v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetDeliveredMst v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetDeliveredMst v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetDeliveredMst v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetDeliveredMst v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetDeliveredMst;

DEBUGLOG(("GetDeliveredMst Normal Exit\n")); 
	return  PD_OK;

GetDeliveredMst_error:
DEBUGLOG(("GetDeliveredMst_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetDeliveredMst;
	return PD_ERR;
}

/*
int GetVoidMst(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetVoidMst_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetVoidMst csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetVoidMst csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetVoidMst csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetVoidMst CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_VOD_SETTLE_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;

	EXEC SQL OPEN c_cursor_GetVoidMst;
        do {    
        	EXEC SQL FETCH c_cursor_GetVoidMst
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetVoidMst v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetVoidMst v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetVoidMst v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetVoidMst v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetVoidMst v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetVoidMst v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetVoidMst v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetVoidMst v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetVoidMst v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetVoidMst v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetVoidMst v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetVoidMst v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetVoidMst v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetVoidMst;

DEBUGLOG(("GetVoidMst Normal Exit\n")); 
	return  PD_OK;

GetVoidMst_error:
DEBUGLOG(("GetVoidMst_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetVoidMst;
	return PD_ERR;
}
*/

int GetApprovedMbt(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetApprovedMbt_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetApprovedMbt csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetApprovedMbt csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetApprovedMbt csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetApprovedMbt CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_MBT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetApprovedMbt;
        do {    
        	EXEC SQL FETCH c_cursor_GetApprovedMbt
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetApprovedMbt v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetApprovedMbt v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetApprovedMbt v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetApprovedMbt v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetApprovedMbt v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetApprovedMbt v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetApprovedMbt v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetApprovedMbt v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetApprovedMbt v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetApprovedMbt v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetApprovedMbt v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetApprovedMbt v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetApprovedMbt v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetApprovedMbt;

DEBUGLOG(("GetApprovedMbt Normal Exit\n")); 
	return  PD_OK;

GetApprovedMbt_error:
DEBUGLOG(("GetApprovedMbt_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetApprovedMbt;
	return PD_ERR;
}

int GetMbt2Off(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetMbt2Off_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetMbt2Off csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetMbt2Off csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetMbt2Off csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetMbt2Off CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_MBT_2_OFF_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetMbt2Off;
        do {    
        	EXEC SQL FETCH c_cursor_GetMbt2Off
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetMbt2Off v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetMbt2Off v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetMbt2Off v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetMbt2Off v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetMbt2Off v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetMbt2Off v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetMbt2Off v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetMbt2Off v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetMbt2Off v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetMbt2Off v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetMbt2Off v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetMbt2Off v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetMbt2Off v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetMbt2Off;

DEBUGLOG(("GetMbt2Off Normal Exit\n")); 
	return  PD_OK;

GetMbt2Off_error:
DEBUGLOG(("GetMbt2Off_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetMbt2Off;
	return PD_ERR;
}

int GetApprovedPbt(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetApprovedPbt_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetApprovedPbt csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetApprovedPbt csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetApprovedPbt csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetApprovedPbt CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_PBT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetApprovedPbt;
        do {    
        	EXEC SQL FETCH c_cursor_GetApprovedPbt
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetApprovedPbt v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetApprovedPbt v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetApprovedPbt v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetApprovedPbt v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetApprovedPbt v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetApprovedPbt v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetApprovedPbt v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetApprovedPbt v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetApprovedPbt v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetApprovedPbt v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetApprovedPbt v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetApprovedPbt v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetApprovedPbt v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetApprovedPbt;

DEBUGLOG(("GetApprovedPbt Normal Exit\n")); 
	return  PD_OK;

GetApprovedPbt_error:
DEBUGLOG(("GetApprovedPbt_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetApprovedPbt;
	return PD_ERR;
}

int GetPbt2Off(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetPbt2Off_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetPbt2Off csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetPbt2Off csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetPbt2Off csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetPbt2Off CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_PBT_2_OFF_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetPbt2Off;
        do {    
        	EXEC SQL FETCH c_cursor_GetPbt2Off
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetPbt2Off v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetPbt2Off v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetPbt2Off v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetPbt2Off v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetPbt2Off v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetPbt2Off v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetPbt2Off v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetPbt2Off v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetPbt2Off v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetPbt2Off v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetPbt2Off v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetPbt2Off v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetPbt2Off v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetPbt2Off;

DEBUGLOG(("GetPbt2Off Normal Exit\n")); 
	return  PD_OK;

GetPbt2Off_error:
DEBUGLOG(("GetPbt2Off_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetPbt2Off;
	return PD_ERR;
}

int GetOff2Mbt(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetOff2Mbt_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetOff2Mbt csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetOff2Mbt csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetOff2Mbt csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetOff2Mbt CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_OFF_2_MBT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetOff2Mbt;
        do {    
        	EXEC SQL FETCH c_cursor_GetOff2Mbt
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetOff2Mbt v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetOff2Mbt v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetOff2Mbt v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetOff2Mbt v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetOff2Mbt v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetOff2Mbt v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetOff2Mbt v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetOff2Mbt v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetOff2Mbt v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetOff2Mbt v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetOff2Mbt v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetOff2Mbt v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetOff2Mbt v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetOff2Mbt;

DEBUGLOG(("GetOff2Mbt Normal Exit\n")); 
	return  PD_OK;

GetOff2Mbt_error:
DEBUGLOG(("GetOff2Mbt_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetOff2Mbt;
	return PD_ERR;
}

int GetOff2Pbt(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetOff2Pbt_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetOff2Pbt csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetOff2Pbt csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetOff2Pbt csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetOff2Pbt CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_APL_OFF_2_PBT_VIEW
		where cr_txn_date = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by th_txn_id;
		
	EXEC SQL OPEN c_cursor_GetOff2Pbt;
        do {    
        	EXEC SQL FETCH c_cursor_GetOff2Pbt
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetOff2Pbt v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetOff2Pbt v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetOff2Pbt v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetOff2Pbt v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetOff2Pbt v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetOff2Pbt v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetOff2Pbt v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetOff2Pbt v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetOff2Pbt v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetOff2Pbt v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetOff2Pbt v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetOff2Pbt v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetOff2Pbt v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetOff2Pbt;

DEBUGLOG(("GetOff2Pbt Normal Exit\n")); 
	return  PD_OK;

GetOff2Pbt_error:
DEBUGLOG(("GetOff2Pbt_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetOff2Pbt;
	return PD_ERR;
}

/*int GetPsp2Mb(recordset_t* myRec, const char* csTxnDate, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetPsp2Mb_error;
    EXEC SQL WHENEVER NOTFOUND CONTINUE;		
	
	EXEC SQL BEGIN DECLARE SECTION;	
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];
		short	ind_th_txn_id = -1;

		varchar	v_cr_txn_date[PD_DATE_LEN + 1];
		short	ind_cr_txn_date = -1;
		
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		short	ind_country = -1;
		
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		short	ind_product = -1;
		
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		short	ind_party_type = -1;
		
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		short	ind_party_id = -1;	
		
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		short	ind_currency = -1;	
		
		int		v_jnl_type_id;
		short	ind_jnl_type_id = -1;	
		
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		short	ind_jnl_entry_type_id = -1;	
		
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		short	ind_cr_ind = -1;	
		
		int		v_gl_id;
		short	ind_gl_id = -1;
		
		int		v_txn_cnt;
		short	ind_txn_cnt = -1;	
		
		double	v_txn_amt;
		short	ind_txn_amt = -1;			
	EXEC SQL END DECLARE SECTION;

	v_cr_txn_date.len = strlen(csTxnDate);
	memcpy(v_cr_txn_date.arr,csTxnDate,v_cr_txn_date.len);
	ind_cr_txn_date = 0;

	v_country.len = strlen(csCountry);
	memcpy(v_country.arr,csCountry,v_country.len);
	ind_country = 0;
	
	v_product.len = strlen(csProduct);
	memcpy(v_product.arr,csProduct,v_product.len);
	ind_product = 0;	

DEBUGLOG(("GetPsp2Mb csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetPsp2Mb csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetPsp2Mb csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetPsp2Mb CURSOR FOR
		select th_txn_id, cr_txn_date, cr_country, cr_product, te_party_type, party_id, cr_currency, cr_jnl_type_id,
		cr_jnl_entry_type_id, cr_ind, cr_gl_id, txn_count, cr_amount
		from CRR_PSP_2_MB_VIEW
		where TH_APPROVAL_DATE = :v_cr_txn_date:ind_cr_txn_date and cr_country = :v_country:ind_country and cr_product = :v_product:ind_product
		order by cr_txn_date;//
		
	EXEC SQL OPEN c_cursor_GetPsp2Mb;
        do {    
        	EXEC SQL FETCH c_cursor_GetPsp2Mb
              	INTO			
			:v_th_txn_id:ind_th_txn_id,
			:v_cr_txn_date:ind_cr_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_cr_ind:ind_cr_ind,
			:v_gl_id:ind_gl_id,
			:v_txn_cnt:ind_txn_cnt,
			:v_txn_amt:ind_txn_amt;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				//PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetPsp2Mb v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}
			if (ind_cr_txn_date >= 0) {
				v_cr_txn_date.arr[v_cr_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_cr_txn_date.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_cr_txn_date.arr);
DEBUGLOG(("GetPsp2Mb v_cr_txn_date = [%s]\n",v_cr_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetPsp2Mb v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetPsp2Mb v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetPsp2Mb v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetPsp2Mb v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetPsp2Mb v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetPsp2Mb v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetPsp2Mb v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetPsp2Mb v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetPsp2Mb v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetPsp2Mb v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetPsp2Mb v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetPsp2Mb;

DEBUGLOG(("GetPsp2Mb Normal Exit\n")); 
	return  PD_OK;

GetPsp2Mb_error:
DEBUGLOG(("GetPsp2Mb_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetPsp2Mb;
	return PD_ERR;
}*/

int GetJnlDataPkg(recordset_t* myRec, const char* csTxnDate, int iJnlTypeId, int iGroupId, const char* csCountry, const char* csProduct)
{
	hash_t *myHash;
	EXEC SQL WHENEVER SQLERROR GOTO GetJnlDataPkg_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;
	
	EXEC SQL BEGIN DECLARE SECTION;
		varchar	hv_txn_date[PD_DATE_LEN + 1];
		int	hv_jnl_type_id;
		int	hv_group_id;
		varchar	hv_country[PD_COUNTRY_CODE_LEN + 1];
		varchar	hv_product[PD_PRODUCT_CODE_LEN + 1];

		varchar	v_txn_date[PD_DATE_LEN + 1];
		varchar	v_country[PD_COUNTRY_CODE_LEN + 1];
		varchar	v_product[PD_PRODUCT_CODE_LEN + 1];
		varchar	v_party_type[PD_PARTY_TYPE_LEN + 1];
		varchar	v_party_id[PD_PARTY_ID_LEN + 1];
		varchar	v_currency[PD_CURRENCY_ID_LEN + 1];
		int	v_jnl_type_id;
		varchar	v_jnl_entry_type_id[PD_JNL_ENTRY_TYPE_LEN + 1];
		varchar	v_cr_ind[PD_CR_IND_LEN + 1];
		int	v_gl_id;
		int	v_txn_cnt;
		double	v_txn_amt;
		varchar	v_th_txn_id[PD_TXN_SEQ_LEN + 1];

		short	ind_txn_date = -1;
		short	ind_country = -1;
		short	ind_product = -1;
		short	ind_party_type = -1;
		short	ind_party_id = -1;
		short	ind_currency = -1;
		short	ind_jnl_type_id = -1;
		short	ind_jnl_entry_type_id = -1;
		short	ind_cr_ind = -1;
		short	ind_gl_id = -1;
		short	ind_txn_cnt = -1;
		short	ind_txn_amt = -1;
		short	ind_th_txn_id = -1;

	EXEC SQL END DECLARE SECTION;

	hv_txn_date.len = strlen(csTxnDate);
	memcpy(hv_txn_date.arr,csTxnDate,hv_txn_date.len);

	hv_jnl_type_id = iJnlTypeId;

	hv_group_id = iGroupId;

	hv_country.len = strlen(csCountry);
	memcpy(hv_country.arr,csCountry,hv_country.len);
	
	hv_product.len = strlen(csProduct);
	memcpy(hv_product.arr,csProduct,hv_product.len);

DEBUGLOG(("GetJnlDataPkg csTxnDate = [%s]\n",csTxnDate));
DEBUGLOG(("GetJnlDataPkg iJnlTypeId= [%d]\n",iJnlTypeId));
DEBUGLOG(("GetJnlDataPkg csCountry = [%s]\n",csCountry));
DEBUGLOG(("GetJnlDataPkg csProduct = [%s]\n",csProduct));
	
	EXEC SQL DECLARE c_cursor_GetJnlDataPkg CURSOR FOR
		SELECT	TXN_DATE,
			CR_COUNTRY_ID,
			CR_PRODUCT_CODE,
			CR_JNL_TYPE_ID,
			CR_JNL_ENTRY_TYPE_ID,
			CR_PARTY_TYPE,
			CR_PARTY_ID,
			CR_CURRENCY_ID,
			GL_ID,
			CR_IND,
			TXN_AMT,
			TXN_COUNT,
			TXN_ID
		FROM	TABLE(CRR_JNL_DATA_PKG.GET_JNL(:hv_jnl_type_id, :hv_group_id, :hv_txn_date, :hv_txn_date))
		WHERE CR_COUNTRY_ID = :hv_country AND CR_PRODUCT_CODE = :hv_product
		ORDER BY TXN_ID;

	EXEC SQL OPEN c_cursor_GetJnlDataPkg;
        do {    
        	EXEC SQL FETCH c_cursor_GetJnlDataPkg
              	INTO
			:v_txn_date:ind_txn_date,
			:v_country:ind_country,
			:v_product:ind_product,
			:v_jnl_type_id:ind_jnl_type_id,
			:v_jnl_entry_type_id:ind_jnl_entry_type_id,
			:v_party_type:ind_party_type,
			:v_party_id:ind_party_id,
			:v_currency:ind_currency,
			:v_gl_id:ind_gl_id,
			:v_cr_ind:ind_cr_ind,
			:v_txn_amt:ind_txn_amt,
			:v_txn_cnt:ind_txn_cnt,
			:v_th_txn_id:ind_th_txn_id;

			if (SQLCODE == SQL_NOT_FOUND) { 
				break;
			}

			myHash = (hash_t*) malloc (sizeof(hash_t));
			hash_init(myHash,0);

			if (ind_txn_date >= 0) {
				v_txn_date.arr[v_txn_date.len] ='\0';
				PutField_CString(myHash,"v_cr_txn_date",(const char*)v_txn_date.arr);
DEBUGLOG(("GetJnlDataPkg v_txn_date = [%s]\n",v_txn_date.arr)); 
			}
			if (ind_country >= 0) {
				v_country.arr[v_country.len] ='\0';
				PutField_CString(myHash,"v_country",(const char*)v_country.arr);
DEBUGLOG(("GetJnlDataPkg v_country = [%s]\n",v_country.arr)); 
			}
			if (ind_product >= 0) {
				v_product.arr[v_product.len] ='\0';
				PutField_CString(myHash,"v_product",(const char*)v_product.arr);
DEBUGLOG(("GetJnlDataPkg v_product = [%s]\n",v_product.arr)); 
			}
			if (ind_jnl_type_id >= 0) {
				PutField_Int(myHash,"v_jnl_type_id",(int)v_jnl_type_id);
DEBUGLOG(("GetJnlDataPkg v_jnl_type_id = [%d]\n",v_jnl_type_id)); 
			}
			if (ind_jnl_entry_type_id >= 0) {
				v_jnl_entry_type_id.arr[v_jnl_entry_type_id.len] ='\0';
				PutField_CString(myHash,"v_jnl_entry_type_id",(const char*)v_jnl_entry_type_id.arr);
DEBUGLOG(("GetJnlDataPkg v_jnl_entry_type_id = [%s]\n",v_jnl_entry_type_id.arr)); 
			}	
			if (ind_party_type >= 0) {
				v_party_type.arr[v_party_type.len] ='\0';
				PutField_CString(myHash,"v_party_type",(const char*)v_party_type.arr);
DEBUGLOG(("GetJnlDataPkg v_party_type = [%s]\n",v_party_type.arr)); 
			}
			if (ind_party_id >= 0) {
				v_party_id.arr[v_party_id.len] ='\0';
				PutField_CString(myHash,"v_party_id",(const char*)v_party_id.arr);
DEBUGLOG(("GetJnlDataPkg v_party_id = [%s]\n",v_party_id.arr)); 
			}		
			if (ind_currency >= 0) {
				v_currency.arr[v_currency.len] ='\0';
				PutField_CString(myHash,"v_currency",(const char*)v_currency.arr);
DEBUGLOG(("GetJnlDataPkg v_currency = [%s]\n",v_currency.arr)); 
			}
			if (ind_gl_id >= 0) {
				PutField_Int(myHash,"v_gl_id",(int)v_gl_id);
DEBUGLOG(("GetJnlDataPkg v_gl_id = [%d]\n",v_gl_id)); 
			}
			if (ind_cr_ind >= 0) {
				v_cr_ind.arr[v_cr_ind.len] ='\0';
				PutField_CString(myHash,"v_cr_ind",(const char*)v_cr_ind.arr);
DEBUGLOG(("GetJnlDataPkg v_cr_ind = [%s]\n",v_cr_ind.arr)); 
			}
			if (ind_txn_amt >= 0) {
				PutField_Double(myHash,"v_txn_amt",(double)v_txn_amt);
DEBUGLOG(("GetJnlDataPkg v_txn_amt = [%f]\n",v_txn_amt)); 
			}			
			if (ind_txn_cnt >= 0) {
				PutField_Int(myHash,"v_txn_cnt",(int)v_txn_cnt);
DEBUGLOG(("GetJnlDataPkg v_txn_cnt = [%d]\n",v_txn_cnt)); 
			}
			if (ind_th_txn_id >= 0) {
				v_th_txn_id.arr[v_th_txn_id.len] ='\0';
				PutField_CString(myHash,"v_th_txn_id",(const char*)v_th_txn_id.arr);
				PutField_CString(myHash,"v_str_cmp",(const char*)v_th_txn_id.arr);
DEBUGLOG(("GetApprovedMst v_th_txn_id = [%s]\n",v_th_txn_id.arr)); 
			}

			RecordSet_Add(myRec,myHash);
		}
		while(PD_TRUE);

	EXEC SQL CLOSE c_cursor_GetJnlDataPkg;

DEBUGLOG(("GetJnlDataPkg Normal Exit\n")); 
	return  PD_OK;

GetJnlDataPkg_error:
DEBUGLOG(("GetJnlDataPkg_error code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_GetJnlDataPkg;
	return PD_ERR;
}

