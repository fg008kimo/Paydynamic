CREATE OR REPLACE FUNCTION sp_email_notify_list_find (
        in_party_type                 EMAIL_SETTING.ES_PARTY_TYPE%TYPE,
        in_party_id                   EMAIL_SETTING.ES_PARTY_ID%TYPE,
        in_funct                      EMAIL_SETTING.ES_PARTY_FUNCT%TYPE,
        out_cursor            OUT     SYS_REFCURSOR)
RETURN NUMBER Is
        iCnt        INTEGER := 0;
BEGIN

        /* ***** in_party_type */

        SELECT COUNT(*)
          INTO iCnt
          FROM EMAIL_NOTIFY_LIST, RULE_EMAIL_NOTIFICATION
         WHERE RE_PARTY_TYPE = 'M' 
           AND RE_PARTY_ID = IN_MERCHANT_ID
           AND RE_FUNCT = IN_FUNCT
           AND RE_DISABLED = 0
           AND RE_EMAIL_ID = EL_ID;

        IF ICNT > 0 THEN
                OPEN OUT_CURSOR FOR
                    SELECT EL_EMAIL
                      FROM EMAIL_NOTIFY_LIST, RULE_EMAIL_NOTIFICATION
                     WHERE RE_PARTY_TYPE = 'M' 
                       AND RE_PARTY_ID = IN_MERCHANT_ID
                       AND RE_FUNCT = IN_FUNCT
                       AND RE_DISABLED = 0
                       AND RE_EMAIL_ID = EL_ID;
                RETURN 1;
        END IF;

        SELECT COUNT(*)
          INTO ICNT
          FROM EMAIL_NOTIFY_LIST, MERCH_DETAIL, RULE_EMAIL_NOTIFICATION
         WHERE RE_PARTY_TYPE = 'C' 
           AND MERCHANT_ID = IN_MERCHANT_ID
           AND RE_PARTY_ID = CLIENT_ID
           AND RE_FUNCT = IN_FUNCT
           AND RE_DISABLED = 0
           AND RE_EMAIL_ID = EL_ID;

        IF ICNT > 0 THEN
                OPEN OUT_CURSOR FOR
                    SELECT EL_EMAIL
                      FROM EMAIL_NOTIFY_LIST, MERCH_DETAIL, RULE_EMAIL_NOTIFICATION
                     WHERE RE_PARTY_TYPE = 'C' 
                       AND MERCHANT_ID = IN_MERCHANT_ID
                       AND RE_PARTY_ID = CLIENT_ID
                       AND RE_FUNCT = IN_FUNCT
                       AND RE_DISABLED = 0
                       AND RE_EMAIL_ID = EL_ID;
                RETURN 1;
        END IF;

        SELECT COUNT(*)
          INTO ICNT 
          FROM EMAIL_NOTIFY_LIST, RULE_EMAIL_NOTIFICATION
         WHERE RE_PARTY_TYPE = 'G' 
           AND RE_FUNCT = IN_FUNCT
           AND RE_DISABLED = 0
           AND RE_EMAIL_ID = EL_ID;
 
        IF ICNT > 0 THEN
                OPEN OUT_CURSOR FOR
                    SELECT EL_EMAIL
                      FROM EMAIL_NOTIFY_LIST, RULE_EMAIL_NOTIFICATION
                     WHERE RE_PARTY_TYPE = 'G' 
                       AND RE_FUNCT = IN_FUNCT
                       AND RE_DISABLED = 0
                       AND RE_EMAIL_ID = EL_ID;

                RETURN 1;
        END IF;

	RETURN 0;

EXCEPTION
    WHEN OTHERS THEN
        RETURN 9;
END sp_email_notify_list_find;
/

