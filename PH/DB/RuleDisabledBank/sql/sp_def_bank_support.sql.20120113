CREATE OR REPLACE FUNCTION sp_def_bank_support(
  in_country			psp_pay_method.pp_country%type,
  in_pay_method			psp_pay_method.pp_pay_method%type,
  out_cursor		out	sys_refcursor)

RETURN NUMBER Is
	iCnt    integer := 0;
Begin

	select count(unique bm_int_bank_code)
	into iCnt
	from (psp_detail left join psp_pay_method
        on psp_detail.psp_id =psp_pay_method.pp_psp_id)
        left join bank_mapping on PSP_DETAIL.PSP_CHANNEL_CODE = BANK_MAPPING.BM_PSP_CHANNEL_ID
        where BANK_MAPPING.bm_disabled = 0
        and BANK_MAPPING.bm_country = in_country
        and pp_pay_method = in_pay_method
        and psp_pay_method.pp_country = in_country
        and psp_pay_method.pp_disabled = 0
        and     psp_detail.status = 'O'
        and     psp_detail.txn_type in ('A','D')
        and     psp_detail.disabled = 0
        and     psp_detail.online_mode = 'Y';

	if iCnt > 0 THEN
	OPEN out_cursor for
		select unique bm_int_bank_code 
		from (psp_detail left join psp_pay_method
        	on psp_detail.psp_id =psp_pay_method.pp_psp_id)
        	left join bank_mapping on PSP_DETAIL.PSP_CHANNEL_CODE = BANK_MAPPING.BM_PSP_CHANNEL_ID
        	where BANK_MAPPING.bm_disabled = 0
        	and BANK_MAPPING.bm_country = in_country
        	and pp_pay_method = in_pay_method
        	and psp_pay_method.pp_country = in_country
       		and psp_pay_method.pp_disabled = 0
        	and     psp_detail.status = 'O'
        	and     psp_detail.txn_type in ('A','D')
        	and     psp_detail.disabled = 0
        	and     psp_detail.online_mode = 'Y'
        	order by bm_int_bank_code;
		RETURN 1;
        end if;
	return 0;

 exception
   WHEN OTHERS THEN
     RETURN 9;
END sp_def_bank_support;
/

