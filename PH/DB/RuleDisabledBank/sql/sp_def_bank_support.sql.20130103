CREATE OR REPLACE FUNCTION sp_def_bank_support(
  in_country			psp_pay_method.pp_country%type,
  in_service_code		service_pay_method.sp_service_code%type,
  out_cursor		out	sys_refcursor)

RETURN NUMBER Is
	iCnt    integer := 0;
Begin

	select count(distinct bm_int_bank_code)
	into iCnt
	from psp_detail,
	     psp_pay_method,
	     bank_mapping,
	     service_pay_method
        where psp_detail.psp_id =psp_pay_method.pp_psp_id
        and PSP_PAY_METHOD.PP_PAY_METHOD = SERVICE_PAY_METHOD.SP_PAY_METHOD
        and PSP_DETAIL.PSP_CHANNEL_CODE = BANK_MAPPING.BM_PSP_CHANNEL_ID
	and BANK_MAPPING.bm_disabled = 0
        and BANK_MAPPING.bm_country = in_country
        and psp_pay_method.pp_country = in_country
        and psp_pay_method.pp_disabled = 0
        and     psp_detail.status = 'O'
        and     psp_detail.txn_type in ('A','D')
        and     psp_detail.disabled = 0
        and     psp_detail.online_mode = 'Y'
	and	sp_service_code = in_service_code
	and	sp_disabled = 0;

	if iCnt > 0 THEN
	OPEN out_cursor for
		select distinct bm_int_bank_code
                from psp_detail,
		     psp_pay_method,
		     bank_mapping,
		     service_pay_method
                where psp_detail.psp_id =psp_pay_method.pp_psp_id
                and PSP_PAY_METHOD.PP_PAY_METHOD = SERVICE_PAY_METHOD.SP_PAY_METHOD
                and PSP_DETAIL.PSP_CHANNEL_CODE = BANK_MAPPING.BM_PSP_CHANNEL_ID
                and BANK_MAPPING.bm_disabled = 0
                and BANK_MAPPING.bm_country = in_country
                and psp_pay_method.pp_country = in_country
                and psp_pay_method.pp_disabled = 0
                and     psp_detail.status = 'O'
                and     psp_detail.txn_type in ('A','D')
                and     psp_detail.disabled = 0
                and     psp_detail.online_mode = 'Y'
                and     sp_service_code =in_service_code
                and     sp_disabled = 0
                order by bm_int_bank_code;
		RETURN 1;
        end if;
	return 0;

 exception
   WHEN OTHERS THEN
     RETURN 9;
END sp_def_bank_support;
/

