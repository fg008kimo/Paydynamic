CREATE OR REPLACE FUNCTION sp_txn_counters_insert(
	in_txn_code		txn_counters.tc_txn_code%type,
	in_country_id		txn_counters.tc_country_id%type,
        in_channel_code		txn_counters.tc_channel_code%type,
	in_service_code		txn_counters.tc_service_code%type,
	in_pay_method		txn_counters.tc_pay_method%type,
	in_party_type		txn_counters.tc_party_type%type,
	in_party_id	 	txn_counters.tc_party_id%type,
	in_ccy			txn_counters.tc_currency_id%type,
	in_counter		txn_counters.tc_counter%type,
	in_req_counter		txn_counters.tc_req_counter%type,
	in_create_user		txn_counters.tc_create_user%type
)
return number is
	l_cnt integer := 0;
	l_req_cnt integer := 0;
begin
	if (in_counter > 0) then
		l_cnt := 1;
	end if;
	if (in_req_counter > 0) then
		l_req_cnt := 1;
	end if;

/* daily amount */
	update txn_counters
           set tc_counter = tc_counter + in_counter,
               tc_total_counter = tc_total_counter + in_counter,
               tc_req_counter = tc_req_counter + in_req_counter,
               tc_total_req_counter = tc_total_req_counter + in_req_counter,
	       tc_update_user = in_create_user,
	       tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code 
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
	   and tc_type = 'D'
           and tc_category = 'AMT'
	   and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

	if SQL%ROWCOUNT = 0 THEN
		insert into txn_counters (
			tc_txn_code,
			tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
			tc_type,
			tc_category,
			tc_party_type,
			tc_party_id,
		        tc_currency_id,
			tc_counter,
			tc_total_counter,
			tc_req_counter,
			tc_total_req_counter,
			tc_create_user,
			tc_create_timestamp
		)
		values(
			in_txn_code,
			in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
			'D',
			'AMT',
			in_party_type,
			in_party_id,
			in_ccy,
			in_counter,
			in_counter,
			in_req_counter,
			in_req_counter,
			in_create_user,
			sysdate
		);

		if SQL%ROWCOUNT = 0 THEN
			update txn_counters
			set	tc_counter = tc_counter + in_counter,
				tc_total_counter = tc_total_counter + in_counter,
				tc_req_counter = tc_req_counter + in_req_counter,
				tc_total_req_counter = tc_total_req_counter + in_req_counter,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code 
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'D'
			and tc_category = 'AMT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;

			if SQL%ROWCOUNT = 0 THEN
				return 1;
			end if;
		end if;
	end if;

/* daily count */
        update txn_counters
           set tc_counter = tc_counter + l_cnt,
               tc_total_counter = tc_total_counter + l_cnt,
               tc_req_counter = tc_req_counter + l_req_cnt,
               tc_total_req_counter = tc_total_req_counter + l_req_cnt,
               tc_update_user = in_create_user,
               tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
           and tc_type = 'D'
           and tc_category = 'CNT'
           and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

        if SQL%ROWCOUNT = 0 THEN
                insert into txn_counters (
                        tc_txn_code,
                        tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
                        tc_type,
                        tc_category,
                        tc_party_type,
                        tc_party_id,
                        tc_currency_id,
                        tc_counter,
                        tc_total_counter,
                        tc_req_counter,
                        tc_total_req_counter,
                        tc_create_user,
                        tc_create_timestamp
                )
                values(
                        in_txn_code,
                        in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
                        'D',
                        'CNT',
                        in_party_type,
                        in_party_id,
                        in_ccy,
			l_cnt,
			l_cnt,
			l_req_cnt,
			l_req_cnt,
                        in_create_user,
                        sysdate
                );

                if SQL%ROWCOUNT = 0 THEN
        		update txn_counters
           		set	tc_counter = tc_counter + l_cnt,
				tc_total_counter = tc_total_counter + l_cnt,
				tc_req_counter = tc_req_counter + l_req_cnt,
				tc_total_req_counter = tc_total_req_counter + l_req_cnt,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'D'
			and tc_category = 'CNT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;
			
			if SQL%ROWCOUNT = 0 THEN
                        	return 1;
			end if;
                end if;
        end if;

/* weekly amount */
        update txn_counters
           set tc_counter = tc_counter + in_counter,
               tc_total_counter = tc_total_counter + in_counter,
               tc_req_counter = tc_req_counter + in_req_counter,
               tc_total_req_counter = tc_total_req_counter + in_req_counter,
               tc_update_user = in_create_user,
               tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
           and tc_type = 'W'
           and tc_category = 'AMT'
           and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

        if SQL%ROWCOUNT = 0 THEN
                insert into txn_counters (
                        tc_txn_code,
                        tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
                        tc_type,
                        tc_category,
                        tc_party_type,
                        tc_party_id,
                        tc_currency_id,
                        tc_counter,
                        tc_total_counter,
                        tc_req_counter,
                        tc_total_req_counter,
                        tc_create_user,
                        tc_create_timestamp
                )
                values(
                        in_txn_code,
                        in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
                        'W',
                        'AMT',
                        in_party_type,
                        in_party_id,
                        in_ccy,
                        in_counter,
                        in_counter,
                        in_req_counter,
                        in_req_counter,
                        in_create_user,
                        sysdate
                );

                if SQL%ROWCOUNT = 0 THEN
			update txn_counters
			set	tc_counter = tc_counter + in_counter,
				tc_total_counter = tc_total_counter + in_counter,
				tc_req_counter = tc_req_counter + in_req_counter,
				tc_total_req_counter = tc_total_req_counter + in_req_counter,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code 
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'W'
			and tc_category = 'AMT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;

			if SQL%ROWCOUNT = 0 THEN
                        	return 1;
			end if;
                end if;
        end if;

/* weekly count */
        update txn_counters
           set tc_counter = tc_counter + l_cnt,
               tc_total_counter = tc_total_counter + l_cnt,
               tc_req_counter = tc_req_counter + l_cnt,
               tc_total_req_counter = tc_total_req_counter + l_cnt,
               tc_update_user = in_create_user,
               tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
           and tc_type = 'W'
           and tc_category = 'CNT'
           and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

        if SQL%ROWCOUNT = 0 THEN
                insert into txn_counters (
                        tc_txn_code,
                        tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
                        tc_type,
                        tc_category,
                        tc_party_type,
                        tc_party_id,
                        tc_currency_id,
                        tc_counter,
                        tc_total_counter,
                        tc_req_counter,
                        tc_total_req_counter,
                        tc_create_user,
                        tc_create_timestamp
                )
                values(
                        in_txn_code,
                        in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
                        'W',
                        'CNT',
                        in_party_type,
                        in_party_id,
                        in_ccy,
			l_cnt,
			l_cnt,
			l_req_cnt,
			l_req_cnt,
                        in_create_user,
                        sysdate
                );

                if SQL%ROWCOUNT = 0 THEN
			update txn_counters
			set 	tc_counter = tc_counter + l_cnt,
				tc_total_counter = tc_total_counter + l_cnt,
				tc_req_counter = tc_req_counter + l_cnt,
				tc_total_req_counter = tc_total_req_counter + l_cnt,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'W'
			and tc_category = 'CNT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;

			if SQL%ROWCOUNT = 0 THEN
				return 1;
			end if;
                end if;
        end if;

/* Month amount */
        update txn_counters
           set tc_counter = tc_counter + in_counter,
               tc_total_counter = tc_total_counter + in_counter,
               tc_req_counter = tc_req_counter + in_req_counter,
               tc_total_req_counter = tc_total_req_counter + in_req_counter,
               tc_update_user = in_create_user,
               tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
           and tc_type = 'M'
           and tc_category = 'AMT'
           and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

        if SQL%ROWCOUNT = 0 THEN
                insert into txn_counters (
                        tc_txn_code,
                        tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
                        tc_type,
                        tc_category,
                        tc_party_type,
                        tc_party_id,
                        tc_currency_id,
                        tc_counter,
                        tc_total_counter,
                        tc_req_counter,
                        tc_total_req_counter,
                        tc_create_user,
                        tc_create_timestamp
                )
                values(
                        in_txn_code,
                        in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
                        'M',
                        'AMT',
                        in_party_type,
                        in_party_id,
                        in_ccy,
                        in_counter,
                        in_counter,
                        in_req_counter,
                        in_req_counter,
                        in_create_user,
                        sysdate
                );

                if SQL%ROWCOUNT = 0 THEN
        		update txn_counters
			set	tc_counter = tc_counter + in_counter,
				tc_total_counter = tc_total_counter + in_counter,
				tc_req_counter = tc_req_counter + in_req_counter,
				tc_total_req_counter = tc_total_req_counter + in_req_counter,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'M'
			and tc_category = 'AMT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;

                	if SQL%ROWCOUNT = 0 THEN
                        	return 1;
			end if;
                end if;
        end if;

/* Month count */
        update txn_counters
           set tc_counter = tc_counter + l_cnt,
               tc_total_counter = tc_total_counter + l_cnt,
               tc_req_counter = tc_req_counter + l_req_cnt,
               tc_total_req_counter = tc_total_req_counter + l_req_cnt,
               tc_update_user = in_create_user,
               tc_update_timestamp = sysdate
         where tc_txn_code = in_txn_code
           and tc_country_id = in_country_id
	   and tc_channel_code = in_channel_code
	   and tc_service_code = in_service_code
	   and tc_pay_method = in_pay_method
           and tc_type = 'M'
           and tc_category = 'CNT'
           and tc_party_type = in_party_type
           and tc_party_id = in_party_id
           and tc_currency_id = in_ccy;

        if SQL%ROWCOUNT = 0 THEN
                insert into txn_counters (
                        tc_txn_code,
                        tc_country_id,
			tc_channel_code,
			tc_service_code,
			tc_pay_method,
                        tc_type,
                        tc_category,
                        tc_party_type,
                        tc_party_id,
                        tc_currency_id,
                        tc_counter,
                        tc_total_counter,
                        tc_req_counter,
                        tc_total_req_counter,
                        tc_create_user,
                        tc_create_timestamp
                )
                values(
                        in_txn_code,
                        in_country_id,
			in_channel_code,
			in_service_code,
			in_pay_method,
                        'M',
                        'CNT',
                        in_party_type,
                        in_party_id,
                        in_ccy,
			l_cnt,
			l_cnt,
			l_req_cnt,
			l_req_cnt,
                        in_create_user,
                        sysdate
                );

                if SQL%ROWCOUNT = 0 THEN
			update txn_counters
			set	tc_counter = tc_counter + l_cnt,
				tc_total_counter = tc_total_counter + l_cnt,
				tc_req_counter = tc_req_counter + l_req_cnt,
				tc_total_req_counter = tc_total_req_counter + l_req_cnt,
				tc_update_user = in_create_user,
				tc_update_timestamp = sysdate
			where tc_txn_code = in_txn_code
			and tc_country_id = in_country_id
			and tc_channel_code = in_channel_code
			and tc_service_code = in_service_code
			and tc_pay_method = in_pay_method
			and tc_type = 'M'
			and tc_category = 'CNT'
			and tc_party_type = in_party_type
			and tc_party_id = in_party_id
			and tc_currency_id = in_ccy;

			if SQL%ROWCOUNT = 0 THEN
                        	return 1;
               		end if;
                else
			return 0;
		end if;
        else
                return 0;
        end if;
exception
  when others then
  return 9;
end sp_txn_counters_insert;
/

