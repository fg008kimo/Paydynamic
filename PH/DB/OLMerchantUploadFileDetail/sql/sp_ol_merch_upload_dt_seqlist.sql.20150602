CREATE OR REPLACE FUNCTION sp_ol_merch_upload_dt_seqlist(
  in_batch_id			ol_merchant_upload_file_detail.oud_batch_id%type,
  in_last_seq			ol_merchant_upload_file_detail.oud_seq_num%type,
  in_status			ol_merchant_upload_file_detail.oud_status%type,
  in_bank_name			ol_merchant_upload_file_detail.oud_bank_name%type,
  in_min_amt			ol_merchant_upload_file_detail.oud_request_amount%type,
  in_max_amt			ol_merchant_upload_file_detail.oud_request_amount%type,
  out_cursor		out	sys_refcursor)

RETURN NUMBER Is
	iCnt	integer := 0;

Begin
	select count(oud_txn_id)
	  into	iCnt
	  from	ol_merchant_upload_file_detail,
		ol_merchant_upload_file_header
	  where oud_batch_id = ouh_batch_id
	  and	oud_batch_id = in_batch_id 
	  and	(oud_bank_name like in_bank_name or in_bank_name is NULL)
	  and	ouh_disabled=0
	  and	oud_disabled=0
	  and	oud_status = in_status 
	  and   (oud_request_amount >= in_min_amt or in_min_amt is NULL)
	  and   (oud_request_amount <= in_max_amt or in_max_amt is NULL)
	  and	oud_seq_num <= in_last_seq;
	
	if iCnt > 0 THEN
		OPEN out_cursor for
		select	
                        oud_seq_num
		from	ol_merchant_upload_file_detail,ol_merchant_upload_file_header
		where (oud_bank_name like in_bank_name or in_bank_name is NULL)
		and   oud_disabled=0
		and   oud_batch_id = in_batch_id
		and   oud_batch_id = ouh_batch_id
		and   oud_status = in_status
		and   ouh_disabled=0
	  	and   (oud_request_amount >= in_min_amt or in_min_amt is NULL)
	  	and   (oud_request_amount <= in_max_amt or in_max_amt is NULL)
		and   oud_seq_num <= in_last_seq
		ORDER BY oud_seq_num;

		return 1;
		
	end if;

	return 0;

exception
   WHEN OTHERS THEN
     RETURN 0;
END sp_ol_merch_upload_dt_seqlist;
/
