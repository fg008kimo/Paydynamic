/*
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include <sqlca.h>
//#include "common.h"
//#include "utilitys.h"
#include "testing.h"

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode



//char    cDebug;
/*
void SystemControl(char    cdebug)
{
        cDebug = cdebug;
}
*/

int main()
{
	char *sRecord;
	char *sRecordId;
	EXEC SQL WHENEVER SQLERROR GOTO print_error;
        EXEC SQL WHENEVER NOTFOUND DO break;	
	
	EXEC SQL BEGIN DECLARE SECTION;
		varchar	v_id[11];
		varchar	v_name[21];

		short	ind_id = -1;
		short	ind_name = -1;

		//char *user_psw="cphuse/cphpwd@cphdev";
		char user[10] = "cphuse";
		char password[10] = "cphpwd";
		char sid[10] = "cphdev";
		char db_name[10] = "cphdev";
	EXEC SQL END DECLARE SECTION;


	EXEC SQL CONNECT :user IDENTIFIED BY :password AT :db_name;


	printf("before declare cursor\n");
	EXEC SQL DECLARE c_test_cursor CURSOR FOR
		SELECT 	sys_code, sys_val FROM SYSTEM_CONTROL;

	printf("after declare cursor\n");


	printf("before open cursor\n");
	EXEC SQL OPEN c_test_cursor;
        do {    

		printf("before fetch\n");
        	EXEC SQL FETCH c_test_cursor
              	INTO
			:v_id:ind_id,
			:v_name:ind_name;


		printf("after fetch\n");
		sRecord = (char*)malloc(sizeof(char));
		sRecordId = (char*)malloc(sizeof(char));

		if (ind_id >= 0) {
			v_id.arr[v_id.len] ='\0';
			strcpy(sRecordId,(char *)v_id.arr);
		}
		else
		{
			strcpy(sRecordId, "99999");
		}
		if (ind_name >= 0) {
			v_name.arr[v_name.len] ='\0';
			strcpy(sRecord,(char *)v_name.arr);
		}
		else
		{
			strcpy(sRecord,"NULL Entry");
		}

		printf("Record found: Code[%s], Val[%s]\n", sRecordId, sRecord);
		free(sRecord);
		free(sRecordId);
		
	}
	while(1);

	EXEC SQL CLOSE c_test_cursor;


	return  0;

print_error:
	printf("SQL ERROR!!\n");
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_test_cursor;
        return 1;
}


