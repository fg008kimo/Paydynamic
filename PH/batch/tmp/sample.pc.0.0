#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

int batch_init(int argc, char* argv[])
{
/*    if (argc < 2)
        return FAILURE;
      else
*/
        return SUCCESS;
}

int batch_proc(int argc, char* argv[])
{
	
	EXEC SQL WHENEVER SQLERROR GOTO sql_error;
    	EXEC SQL WHENEVER NOTFOUND CONTINUE;

    	EXEC SQL BEGIN DECLARE SECTION;
                varchar v_sysdate[PD_DATE_LEN + 1];
		short	ind_sysdate =-1;
    	EXEC SQL END DECLARE SECTION;

	EXEC SQL SELECT to_char(sysdate,'yyyymmdd')
                INTO :v_sysdate:ind_sysdate
                FROM dual;

	if (ind_sysdate >= 0)  {
		printf("Sysdate = [%.*s]\n",v_sysdate.len,v_sysdate.arr);
		return SUCCESS;
	}
	return FAILURE;
sql_error:
    DEBUGLOG(("get_error code %d\n", sqlca.sqlcode));
    DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
    EXEC SQL WHENEVER SQLERROR CONTINUE;
    EXEC SQL ROLLBACK RELEASE;  
    return FAILURE;    
}

int batch_terminate(int argc, char* argv[])
{
    return SUCCESS;
}

