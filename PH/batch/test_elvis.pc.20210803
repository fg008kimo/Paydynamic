#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "batchcommon.h"
#include "common.h"
#include "utilitys.h"
#include "myhash.h"
#include "numutility.h"
#include "myrecordset.h"
#include "ObjPtr.h"
#include "dates.h"
#include "dbutility.h"
#include <sys/stat.h>

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

static char cDebug = 'Y';

OBJPTR(Txn);

int parse_arg(int argc, char **argv);
int process_main();


int batch_init(int argc, char* argv[])
{
printf("argc = [%d]\n", argc);
	if (argc > 10) {
		printf("usage: -f input_file\n");
		return FAILURE;
	}
	else
		return SUCCESS;
}


int batch_proc(int argc, char* argv[])
{
	int 	iRet = SUCCESS;

	int	i = 0;
	//int	iCnt = 0;
	int	iPos = 0;
	int	iNumOfDigitsMaskAcctStart = 0;
	int	iNumOfDigitsMaskAcctEnd = 0;

	//char    *csTmp = NULL;

        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "abcd: 1234******56789 abcdefghijk";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "**abcd: 1234******56789 abcdef******ghijk*";

        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "******1234 abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "account: ******1234 abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "1234****** abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "account: 1234****** abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "1234*****56789 abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "account: 1234*****56789 abcdef******ghijk*";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "account: 1234***6688**56789 abcdef******ghijk*";

        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "账号：6230***********4105  开始日期：2021-06-10  结束日期：2021-06-21  币种：RMB";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "1234--abcd: 1234---56789 abcdef----ghijk-56789";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "1234567abcde";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "*****";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "1234******";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "****12345";
        //char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "09876543****12345";
        char    cs_tmp_input_buf[PD_TMP_MSG_BUF_LEN] = "abcde****09876543****12345";

	//char	*cs_tmp_input_buf_2 = strdup("1234******56789 abcdef******ghijk*lmnopq**");
	//char	*cs_tmp_input_buf_2 = strdup("***abcd: 1234******56789 abcdef******ghijk*lmnopq**");
	//char	*cs_tmp_input_buf_2 = strdup("1234*****************");
	//char	*cs_tmp_input_buf_2 = strdup("*****************123456");
	//char	*cs_tmp_input_buf_2 = strdup("*****");
	//char	*cs_tmp_input_buf_2 = strdup("12345678");
	//char	*cs_tmp_input_buf_2 = strdup("");

	char    cs_tmp_input_buf_start[PD_TMP_MSG_BUF_LEN] = "";
       	char    cs_tmp_input_buf_end[PD_TMP_MSG_BUF_LEN] = "";
       	//char    cs_tmp_input_buf_3[PD_TMP_MSG_BUF_LEN] = "";
       	//char    cs_tmp_input_buf_4[PD_TMP_MSG_BUF_LEN] = "";

	iRet = parse_arg(argc, argv);

	if (iRet != SUCCESS) {
		printf("usage: -f input_file\n");
		return (iRet);
	}

/*
	csTmp = strstr(cs_tmp_input_buf, "*");
        if (csTmp == NULL) {
DEBUGLOG(("No Delimiter\n"));	
	} else {
DEBUGLOG(("Delimiter Exists\n"));	
	}
	
	csTmp = strchr(cs_tmp_input_buf, '*');
        if (csTmp == NULL) {
DEBUGLOG(("No Delimiter\n"));                                         
        } else {
DEBUGLOG(("Delimiter Exists\n"));   
        }
*/

	iPos= strcspn(cs_tmp_input_buf, "*");
DEBUGLOG(("* position = [%d]\n", iPos));

	if ((strlen(cs_tmp_input_buf) > 0) 
            && ((iPos >= 0) && (iPos < strlen(cs_tmp_input_buf)))
       	) 
     	{
           	if (iPos > 0) {
                     	strncpy(cs_tmp_input_buf_start,cs_tmp_input_buf,iPos);
DEBUGLOG(("cs_tmp_input_buf_start = [%s]\n", cs_tmp_input_buf_start));
          	}

             	for (i=iPos;i<strlen(cs_tmp_input_buf);i++) {
                   	if (cs_tmp_input_buf[i] != '*') {
                            	strcpy(cs_tmp_input_buf_end,&cs_tmp_input_buf[i]);
DEBUGLOG(("cs_tmp_input_buf_end = [%s]\n", cs_tmp_input_buf_end));
                               	break;
                      	}       
             	}
    	}

/*
	csTmp = strchr(cs_tmp_input_buf, '*');
DEBUGLOG(("csTmp = [%s]\n", csTmp));
	if (csTmp != NULL) {
		for (i=0;i<strlen(csTmp);i++) {
			if (csTmp[i] == '*') {
				iCnt++;
			} else {
				break;
			} 
		}
		strcpy(cs_tmp_input_buf_end,&csTmp[iCnt]);
DEBUGLOG(("cs_tmp_input_buf_end = [%s]\n", cs_tmp_input_buf_end));
	}
*/

/*
	csTmp = mystrtok(cs_tmp_input_buf, "*");
       	if (csTmp != NULL) {
		if (strlen(csTmp) != 0) {
               		strcpy(cs_tmp_input_buf_start,csTmp);
DEBUGLOG(("cs_tmp_input_buf_start = [%s]\n", cs_tmp_input_buf_start));
		}

           	while ((csTmp = mystrtok(NULL,"*")) != NULL) {
			if (strlen(csTmp) != 0) {
                       		strcpy(cs_tmp_input_buf_end,csTmp);
DEBUGLOG(("cs_tmp_input_buf_end = [%s]\n", cs_tmp_input_buf_end));
				break;
			}
             	}
   	}	
*/

/*
        while ((csTmp = strsep(&cs_tmp_input_buf_2, "*")) != NULL) {
		if (i == 0) {
			if (strlen(csTmp) != 0) {
				strcpy(cs_tmp_input_buf_3,csTmp);
DEBUGLOG(("cs_tmp_input_buf_3 = [%s]\n", cs_tmp_input_buf_3));
			}
		} else {
			if (strlen(csTmp) != 0) {
				strcpy(cs_tmp_input_buf_4,csTmp);
DEBUGLOG(("cs_tmp_input_buf_4 = [%s]\n", cs_tmp_input_buf_4));
				break;
			}
		}
		i++;
        }
*/

/*
	csTmp = strtok(cs_tmp_input_buf, "*");
        if (csTmp != NULL) {
                strcpy(cs_tmp_input_buf_start,csTmp);
DEBUGLOG(("cs_tmp_input_buf_start = [%s]\n", cs_tmp_input_buf_start));

                while ((csTmp = strtok(NULL,"*")) != NULL) {
                        strcpy(cs_tmp_input_buf_end,csTmp);
DEBUGLOG(("cs_tmp_input_buf_end = [%s]\n", cs_tmp_input_buf_end));
			//break;
                }
        }
*/
	
DEBUGLOG(("strlen(cs_tmp_input_buf_start) = [%d]\n", strlen(cs_tmp_input_buf_start)));
DEBUGLOG(("strlen(cs_tmp_input_buf_end) = [%d]\n", strlen(cs_tmp_input_buf_end)));

	if (strlen(cs_tmp_input_buf_start) > 0) {
		for (i=(strlen(cs_tmp_input_buf_start)-1);i>=0;i--) {
    			if ((cs_tmp_input_buf_start[i] >= '0' && cs_tmp_input_buf_start[i] <= '9')) {
        		       	iNumOfDigitsMaskAcctStart++;
       			} else {
        		      	break;
      			}
   		}
	}
DEBUGLOG(("iNumOfDigitsMaskAcctStart = [%d]\n", iNumOfDigitsMaskAcctStart));

	if (strlen(cs_tmp_input_buf_end) > 0) {
		for (i=0;i<strlen(cs_tmp_input_buf_end);i++) {
        	     	if ((cs_tmp_input_buf_end[i] >= '0' && cs_tmp_input_buf_end[i] <= '9')) {
        	              	iNumOfDigitsMaskAcctEnd++;
        	      	} else {
        	              	break;
        	      	}
    		}
	}
DEBUGLOG(("iNumOfDigitsMaskAcctEnd = [%d]\n", iNumOfDigitsMaskAcctEnd));

DEBUGLOG(("iRet = [%d]\n", iRet));
	return iRet;
}


int batch_terminate(int argc, char* argv[])
{
	return SUCCESS;
}


int parse_arg(int argc, char **argv)
{
	return SUCCESS;
}

