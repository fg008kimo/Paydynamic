/*
Partnerdelight (c)2012. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2012/02/03              Cody Chan
*/

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sqlca.h>
#include <sqlcpr.h>
#include "common.h"
#include "utilitys.h"
#include "batchcommon.h"

char	cDebug;
#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode


int Extract_RPT001(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
DEBUGLOG(("Extract_RPT001\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt001_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_txn_id[PD_TXN_ID_LEN +1];
		varchar	v_merchant_ref[PD_MERCHANT_REF_LEN +1];
                varchar v_txn_code[PD_TXN_CODE_LEN +1];
                varchar v_txn_code_desc[PD_DESC_LEN +1];
                double  v_open_bal;
                double  v_current_bal;
                varchar v_txn_element_type[PD_TXN_ELEMENT_TYPE_LEN +1];
                varchar v_txn_element_type_desc[PD_DESC_LEN +1];
                int     v_exec_seq;
		double	v_amount;
                varchar v_ccy[PD_CCY_ID_LEN +1];
                varchar v_amt_type[PD_AMT_TYPE_LEN +1];
                double  v_bal;
		varchar	v_approval_date[PD_DATE_LEN +1];

                short   ind_txn_id = -1;
		short	ind_merchant_ref = -1;
                short   ind_txn_code = -1;
                short   ind_txn_code_desc = -1;
                short   ind_open_bal = -1;
                short   ind_current_bal = -1;
                short   ind_txn_element_type = -1;
                short   ind_txn_element_type_desc = -1;
                short   ind_exec_seq = -1;
		short	ind_amount = -1;
                short   ind_ccy = -1;
                short   ind_amt_type = -1;
                short   ind_bal = -1;
		short	ind_approval_date = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"Merchant Ref");
	fprintf(fp,XLS_FL,"Txn Desc");
	fprintf(fp,XLS_FL,"Opening Bal");
	fprintf(fp,XLS_FL,"Current Bal");
	fprintf(fp,XLS_FL,"Txn Element");
	fprintf(fp,XLS_FL,"Amount");
	fprintf(fp,XLS_FL,"Currency");
	fprintf(fp,XLS_FL,"Amount Type");
	fprintf(fp,XLS_FL,"Bal");
	fprintf(fp,XLS_FL,"Approval Date");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		fprintf(fp,XLS_NC);
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
                        :v_txn_id:ind_txn_id,
			:v_merchant_ref:ind_merchant_ref,
                        :v_txn_code:ind_txn_code,
                        :v_txn_code_desc:ind_txn_code_desc,
                        :v_open_bal:ind_open_bal,
                        :v_current_bal:ind_current_bal,
                        :v_txn_element_type:ind_txn_element_type,
                        :v_txn_element_type_desc:ind_txn_element_type_desc,
                        :v_exec_seq:ind_exec_seq,
			:v_amount:ind_amount,
                        :v_ccy:ind_ccy,
                        :v_amt_type:ind_amt_type,
                        :v_bal:ind_bal,
			:v_approval_date:ind_approval_date;
/* txn id */
		v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);

/* merchant ref */
		v_merchant_ref.arr[v_merchant_ref.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_ref.arr);

/* txn code */
		v_txn_code.arr[v_txn_code.len] = '\0';
/* txn code desc */
		v_txn_code_desc.arr[v_txn_code_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_code_desc.arr);
/*open bal */
		if (ind_open_bal < 0) 
			v_open_bal = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_open_bal);

/*current bal */
		if (ind_current_bal < 0) 
			v_current_bal = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_current_bal);
/*txn element */
		v_txn_element_type.arr[v_txn_element_type.len] = '\0';

/*txn element desc */
		v_txn_element_type_desc.arr[v_txn_element_type_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_element_type_desc.arr);

/*exec seq */
		if (ind_exec_seq < 0) 
			v_exec_seq = 0;
/* amount */
		if (ind_amount < 0)
			v_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_amount);

/*ccy */
		v_ccy.arr[v_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_ccy.arr);

/*amt_type */
		v_amt_type.arr[v_amt_type.len] = '\0';
		fprintf(fp,XLS_FL,v_amt_type.arr);

/*bal */
		if (ind_bal < 0) 
			v_bal = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_bal);
/* approval date */
		v_approval_date.arr[v_approval_date.len] = '\0';
		fprintf(fp,XLS_FL,v_approval_date.arr);
		
		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt001_error:
DEBUGLOG(("extract_rpt001 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT002(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
DEBUGLOG(("Extract_RPT002\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt002_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_txn_id[PD_TXN_ID_LEN +1];
		varchar	v_txn_desc[PD_DESC_LEN +1];
		varchar	v_client_id[PD_CLIENT_ID_LEN +1];
		varchar	v_client_name[PD_CLIENT_NAME_LEN +1];
		varchar	v_merchant_id[PD_MERCHANT_ID_LEN +1];
		varchar	v_merchant_name[PD_NAME_LEN +1];
		varchar	v_merchant_ref[PD_MERCHANT_REF_LEN +1];
		varchar	v_host_posting_date[PD_DATE_LEN +1];
		varchar v_transmission_datetime[PD_DATETIME_LEN +1];
		varchar	v_txn_country[PD_COUNTRY_LEN +1];
		varchar	v_txn_ccy[PD_CCY_ID_LEN +1];
		double	v_txn_amount;
		double  v_net_amount;
		double	v_reserve_amount;
		double	v_ex_rate;
		varchar	v_sub_status[PD_DESC_LEN +1];
		varchar	v_status[PD_NAME_LEN +1];
		varchar v_create_date[PD_DATETIME_LEN +1];
		varchar	v_update_date[PD_DATETIME_LEN +1];
		varchar	v_service_name[PD_NAME_LEN +1];
		varchar	v_approval_date[PD_DATE_LEN +1]; 


                short   ind_txn_id = -1;
		short	ind_txn_desc = -1;
		short	ind_client_id = -1;
		short	ind_client_name = -1;
		short	ind_merchant_id = -1;
		short	ind_merchant_name = -1;
		short	ind_merchant_ref = -1;
		short	ind_host_posting_date = -1;
		short   ind_transmission_datetime = -1;
		short	ind_txn_country = -1;
		short	ind_txn_ccy = -1;
		short	ind_txn_amount = -1;
		short   ind_net_amount = -1;
		short	ind_reserve_amount = -1;
		short	ind_ex_rate = -1;
		short	ind_sub_status = -1;
		short	ind_status = -1;
		short   ind_create_date = -1;
		short	ind_update_date = -1;
		short	ind_service_name =-1;
		short	ind_approval_date = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"Txn Desc");
	fprintf(fp,XLS_FL,"Client ID");
	fprintf(fp,XLS_FL,"Client Name");
	fprintf(fp,XLS_FL,"Merchant ID");
	fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Merchant Ref #");
	fprintf(fp,XLS_FL,"Host Posting Date");
	fprintf(fp,XLS_FL,"Transmission DateTime");
	fprintf(fp,XLS_FL,"Txn Country");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Transaction Amount");
	fprintf(fp,XLS_FL,"Net Amount");
	fprintf(fp,XLS_FL,"Reserve Amount");
	fprintf(fp,XLS_FL,"EX Rate");
	fprintf(fp,XLS_FL,"Sub Status");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Create DateTime");
	fprintf(fp,XLS_FL,"Update DateTime");
	fprintf(fp,XLS_FL,"Service Name");
	fprintf(fp,XLS_FL,"Approval Date");

	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
                        :v_txn_id:ind_txn_id,
			:v_txn_desc:ind_txn_desc,
			:v_client_id:ind_client_id,
			:v_client_name:ind_client_name,
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_merchant_ref:ind_merchant_ref,
			:v_host_posting_date:ind_host_posting_date,
			:v_transmission_datetime:ind_transmission_datetime,
			:v_txn_country:ind_txn_country,
			:v_txn_ccy:ind_txn_ccy,
			:v_txn_amount:ind_txn_amount,
			:v_net_amount:ind_net_amount,
			:v_reserve_amount:ind_reserve_amount,
			:v_ex_rate:ind_ex_rate,
			:v_sub_status:ind_sub_status,
			:v_status:ind_status,
			:v_create_date:ind_create_date,
			:v_update_date:ind_update_date,
			:v_service_name:ind_service_name,
                        :v_approval_date:ind_approval_date;
		fprintf(fp,XLS_NC);
/* txn ID */
		v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);

/* txn desc */
		v_txn_desc.arr[v_txn_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_desc.arr);
		
/* client id */
		v_client_id.arr[v_client_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_client_id.arr);

/* client name */
		v_client_name.arr[v_client_name.len] = '\0';
		fprintf(fp,XLS_FL,v_client_name.arr);

/* merchant id */
		v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_id.arr);

/* merchant name */
		v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* merchant ref */
		v_merchant_ref.arr[v_merchant_ref.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_ref.arr);

/* host posting date */
		v_host_posting_date.arr[v_host_posting_date.len] = '\0';
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_host_posting_date.arr,PD_MM_LEN,&v_host_posting_date.arr[PD_YYYY_LEN],PD_DD_LEN,&v_host_posting_date.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* transmission datetime */
		v_transmission_datetime.arr[v_transmission_datetime.len] = '\0';
		if (v_transmission_datetime.len > PD_DATE_LEN) {
			fprintf(fp,XLS_FL_DATETIME,4,v_transmission_datetime.arr,2,&v_transmission_datetime.arr[4],2,&v_transmission_datetime.arr[6],2,&v_transmission_datetime.arr[8],2,&v_transmission_datetime.arr[10],2,&v_transmission_datetime.arr[12]);
		}
		else {
			fprintf(fp,XLS_FL_DATE,4,v_transmission_datetime.arr,2,&v_transmission_datetime.arr[4],2,&v_transmission_datetime.arr[6]);
		}

/* txn country */
		v_txn_country.arr[v_txn_country.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_country.arr);

/* txn ccy */
		v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* transaction amount */
		if (ind_txn_amount < 0 )
			v_txn_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount);

/* net amount */
		if (ind_net_amount < 0 )
			v_net_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_net_amount);

/* reserve amount */
		if (ind_reserve_amount < 0 )
			v_reserve_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_reserve_amount);

/* ex rate */
		if (ind_ex_rate < 0 )
			v_ex_rate = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_ex_rate);

/* sub status */
		v_sub_status.arr[v_sub_status.len] = '\0';
		fprintf(fp,XLS_FL,v_sub_status.arr);

/* status */
		v_status.arr[v_status.len] = '\0';
		fprintf(fp,XLS_FL,v_status.arr);

/* create_date */
		v_create_date.arr[v_create_date.len] = '\0';
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_create_date.arr,PD_MM_LEN,&v_create_date.arr[PD_YYYY_LEN],PD_DD_LEN,&v_create_date.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* update_date */
		v_update_date.arr[v_update_date.len] = '\0';
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_update_date.arr,PD_MM_LEN,&v_update_date.arr[PD_YYYY_LEN],PD_DD_LEN,&v_update_date.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* service_name */
		v_service_name.arr[v_service_name.len] = '\0';
		fprintf(fp,XLS_FL,v_service_name.arr);

/* approval date */
		v_approval_date.arr[v_approval_date.len] = '\0';
		if (ind_approval_date >= 0 ) {
			fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_approval_date.arr,PD_MM_LEN,&v_approval_date.arr[PD_YYYY_LEN],PD_DD_LEN,&v_approval_date.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt002_error:
DEBUGLOG(("extract_rpt002 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}

int Extract_RPT003(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	char	*csTmp;
	
DEBUGLOG(("Extract_RPT003\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt003_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_host_posting_date[PD_DATE_LEN +1];
		varchar	v_txn_desc[PD_DESC_LEN +1];
		varchar v_service_name[PD_NAME_LEN +1];
		varchar	v_psp_name[PD_PSP_NAME_LEN + 1];
		varchar	v_txn_ccy[PD_CCY_ID_LEN +1];
		double	v_txn_amount;
		int	v_txn_count;
		double	v_avg_txn_amount;

		short	ind_host_posting_date = -1;
		short	ind_txn_desc = -1;
		short	ind_service_name = -1;
		short	ind_psp_name = -1;
		short	ind_txn_ccy = -1;
		short	ind_txn_amount = -1;
		short	ind_txn_count = -1;
		short	ind_avg_txn_amount = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Host Posting Date");
	fprintf(fp,XLS_FL,"Txn Desc");
	fprintf(fp,XLS_FL,"Service Name");
	fprintf(fp,XLS_FL,"PSP Name");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Transaction Amount");
	fprintf(fp,XLS_FL,"Transaction Count");
	fprintf(fp,XLS_FL,"Average Transaction Amount");

	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_host_posting_date:ind_host_posting_date,
			:v_txn_desc:ind_txn_desc,
			:v_service_name:ind_service_name,
			:v_psp_name:ind_psp_name,
			:v_txn_ccy:ind_txn_ccy,
			:v_txn_amount:ind_txn_amount,
			:v_txn_count:ind_txn_count,
			:v_avg_txn_amount:ind_avg_txn_amount;

		fprintf(fp,XLS_NC);

/* host posting date */
                v_host_posting_date.arr[v_host_posting_date.len] = '\0';
                fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_host_posting_date.arr,PD_MM_LEN,&v_host_posting_date.arr[PD_YYYY_LEN],PD_DD_LEN,&v_host_posting_date.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* txn desc */
		v_txn_desc.arr[v_txn_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_desc.arr);

/* service name */
		v_service_name.arr[v_service_name.len] = '\0';
		fprintf(fp,XLS_FL,v_service_name.arr);

/* psp name */
		v_psp_name.arr[v_psp_name.len] = '\0';
		fprintf(fp,XLS_FL,v_psp_name.arr);
		
/* txn ccy */
		v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* txn amount */
		if (ind_txn_amount < 0 )
			v_txn_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount); 

/* txn_count */
		if (ind_txn_count < 0) {
			v_txn_count = 0;
		}

		csTmp = (char*) malloc (20);
		sprintf(csTmp, "%d", v_txn_count);
		fprintf(fp, XLS_FL, csTmp);
		FREE_ME(csTmp);

/* average txn amount */
		if (ind_avg_txn_amount < 0 )
			v_avg_txn_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_avg_txn_amount); 


		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt003_error:
DEBUGLOG(("extract_rpt003 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}

int Extract_RPT004(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT004\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt004_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_merchant_id[PD_MERCHANT_ID_LEN +1];
		varchar v_merchant_name[PD_NAME_LEN +1];
		varchar v_service_name[PD_NAME_LEN +1];
		varchar	v_txn_ccy[PD_CCY_ID_LEN +1];
		varchar v_amt_type[PD_AMT_TYPE_LEN +1];	
		double 	v_total_fee;

		short	ind_merchant_id = -1;
		short	ind_merchant_name = -1;
		short	ind_service_name = -1;
		short	ind_txn_ccy = -1;
		short	ind_amt_type = -1;
		short	ind_total_fee = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
        fprintf(fp,XLS_FL,"Merchant ID");
        fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Service Name");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Amount Type");
	fprintf(fp,XLS_FL,"Total Fee");

	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_service_name:ind_service_name,
			:v_txn_ccy:ind_txn_ccy,
			:v_amt_type:ind_amt_type,
			:v_total_fee:ind_total_fee;

		fprintf(fp,XLS_NC);

/* merchant id */
		v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_id.arr);

/* merchant name */
		v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* service name */
		v_service_name.arr[v_service_name.len] = '\0';
		fprintf(fp,XLS_FL,v_service_name.arr);

/* txn ccy */
		v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* amount type */
		v_amt_type.arr[v_amt_type.len] = '\0';
		fprintf(fp,XLS_FL,v_amt_type.arr);

/* total fee*/
		if (ind_total_fee < 0 )
			v_total_fee = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_total_fee); 

		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt004_error:
DEBUGLOG(("extract_rpt004 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT005(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	char	*csTmp;
	
DEBUGLOG(("Extract_RPT005\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt005_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar	v_txn_desc[PD_DESC_LEN +1];
		varchar	v_status[PD_NAME_LEN +1];
		int	v_txn_count;
                varchar v_amt_type[PD_AMT_TYPE_LEN +1];
		varchar	v_txn_ccy[PD_CCY_ID_LEN +1];
		double	v_markup_amount;
	
		short	ind_txn_desc = -1;
		short	ind_status = -1;
		short	ind_txn_count = -1;
		short	ind_amt_type = -1;
		short	ind_txn_ccy = -1;
		short	ind_markup_amount = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn Desc");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Transaction Count");
	//fprintf(fp,XLS_FL,"Amount Type");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Markup Amount");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_txn_desc:ind_txn_desc,
			:v_status:ind_status,
			:v_txn_count:ind_txn_count,
                	:v_amt_type:ind_amt_type,
			:v_txn_ccy:ind_txn_ccy,
			:v_markup_amount:ind_markup_amount;

		fprintf(fp,XLS_NC);

/* txn desc */
		v_txn_desc.arr[v_txn_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_desc.arr);
		
/* status */
		v_status.arr[v_status.len] = '\0';
		fprintf(fp,XLS_FL,v_status.arr);

/* txn_count */
		if (ind_txn_count < 0) {
			v_txn_count = 0;
		}

		csTmp = (char*) malloc (20);
		sprintf(csTmp, "%d", v_txn_count);
		fprintf(fp, XLS_FL, csTmp);
		FREE_ME(csTmp);
		
/*amt_type */
		v_amt_type.arr[v_amt_type.len] = '\0';
		//fprintf(fp,XLS_FL,v_amt_type.arr);

/* txn ccy */
		v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* markup amount */
		if (ind_markup_amount < 0 )
			v_markup_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_markup_amount);

		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt005_error:
DEBUGLOG(("extract_rpt005 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT006(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	char	*csTmp;
	
DEBUGLOG(("Extract_RPT006\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt006_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;

		int     v_count;
		varchar v_member_ccy[PD_CCY_ID_LEN + 1];
		varchar v_member_amt_type[PD_AMT_TYPE_LEN +1];
		double  v_member_amount;
		varchar v_merchant_ccy[PD_CCY_ID_LEN + 1];
		varchar v_merchant_amt_type[PD_AMT_TYPE_LEN +1];
		double  v_merchant_amount;

		short   ind_count = -1;
		short   ind_member_ccy = -1;
		short   ind_member_amt_type = -1;
		short   ind_member_amount = -1;
		short   ind_merchant_ccy = -1;
		short   ind_merchant_amt_type = -1;
		short   ind_merchant_amount = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn Count");
	fprintf(fp,XLS_FL,"Member Amount Type");
	fprintf(fp,XLS_FL,"Member Currency");
	fprintf(fp,XLS_FL,"Member Fee");
	fprintf(fp,XLS_FL,"Merchant Amount Type");
	fprintf(fp,XLS_FL,"Merchant Currency");
	fprintf(fp,XLS_FL,"Merchant Fee");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_count:ind_count,
			:v_member_amt_type:ind_member_amt_type,
			:v_member_ccy:ind_member_ccy,
			:v_member_amount:ind_member_amount,
			:v_merchant_amt_type:ind_merchant_amt_type,
			:v_merchant_ccy:ind_merchant_ccy,
			:v_merchant_amount:ind_merchant_amount;

		fprintf(fp,XLS_NC);
/*count*/
		if (ind_count < 0) {
			v_count = 0;
		}

		csTmp = (char*) malloc (20);
		sprintf(csTmp, "%d", v_count);
		fprintf(fp, XLS_FL, csTmp);
		FREE_ME(csTmp);

/* member_amount_type */
		v_member_amt_type.arr[v_member_amt_type.len] = '\0';
		fprintf(fp,XLS_FL,v_member_amt_type.arr);

/* member_ccy */
		v_member_ccy.arr[v_member_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_member_ccy.arr);

/* member_amount */
		if (ind_member_amount < 0) {
			v_member_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_member_amount);

/* merchant_amount_type */
		v_merchant_amt_type.arr[v_merchant_amt_type.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_amt_type.arr);

/* merchant_ccy */
		v_merchant_ccy.arr[v_merchant_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_ccy.arr);

/* merchant_amount */
		if (ind_merchant_amount < 0) {
			v_merchant_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_merchant_amount);

		fprintf(fp,XLS_EC);
	}
/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt006_error:
DEBUGLOG(("extract_rpt006 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT007(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT007\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt007_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;

		varchar v_create_timestamp[PD_DATETIME_LEN + 1];
		varchar v_update_timestamp[PD_DATETIME_LEN + 1];
		varchar v_approval_timestamp[PD_DATETIME_LEN + 1];
		varchar v_txn_id[PD_TXN_SEQ_LEN + 1];
		varchar v_psp_name[PD_PSP_NAME_LEN + 1];
		varchar v_merchant_ref[PD_MERCHANT_REF_LEN + 1];
		varchar v_merchant_id[PD_MERCHANT_ID_LEN + 1];
		varchar v_merchant_name[PD_NAME_LEN + 1];
		varchar v_dm_status_desc[PD_DESC_LEN +1];
		varchar v_sub_status_desc[PD_DESC_LEN +1];
		varchar v_txn_ccy[PD_CCY_ID_LEN + 1];
		double  v_txn_amount;
		double  v_net_amount;
		double  v_ex_rate;
		varchar v_fee_ccy[PD_CCY_ID_LEN + 1];
		double  v_fee;
		varchar v_req_amt_ccy[PD_CCY_ID_LEN + 1];
		double  v_requested_amount;

		short   ind_create_timestamp = -1;
		short   ind_update_timestamp = -1;
		short   ind_approval_timestamp = -1;
		short   ind_txn_id = -1;
		short   ind_psp_name = -1;
		short   ind_merchant_ref = -1;
		short   ind_merchant_id = -1;
		short   ind_merchant_name = -1;
		short   ind_dm_status_desc = -1;
		short   ind_sub_status_desc = -1;
		short   ind_txn_ccy = -1;
		short   ind_txn_amount = -1;
		short   ind_net_amount = -1;
		short   ind_ex_rate = -1;
		short   ind_fee_ccy = -1;
		short   ind_fee = -1;
		short   ind_req_amt_ccy = -1;
		short   ind_requested_amount = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Create Date");
	fprintf(fp,XLS_FL,"Last Update Date");
	fprintf(fp,XLS_FL,"Approval Date");
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"PSP Name");
	fprintf(fp,XLS_FL,"Merchant ID");
	fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Merchant Ref #");
	fprintf(fp,XLS_FL,"Substatus Desc");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Txn Amount");
	fprintf(fp,XLS_FL,"Net Amount");
	fprintf(fp,XLS_FL,"Exchange Rate");
	fprintf(fp,XLS_FL,"Fee Currency");
	fprintf(fp,XLS_FL,"Fee");
	fprintf(fp,XLS_FL,"Amount Currency");
	fprintf(fp,XLS_FL,"Requested Amount");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_create_timestamp:ind_create_timestamp,
			:v_update_timestamp:ind_update_timestamp,
			:v_approval_timestamp:ind_approval_timestamp,
			:v_txn_id:ind_txn_id,
			:v_psp_name:ind_psp_name,
			:v_merchant_ref:ind_merchant_ref,
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_dm_status_desc:ind_dm_status_desc,
			:v_sub_status_desc:ind_sub_status_desc,
			:v_txn_amount:ind_txn_amount,
			:v_txn_ccy:ind_txn_ccy,
			:v_net_amount:ind_net_amount,
			:v_ex_rate:ind_ex_rate,
			:v_fee:ind_fee,
			:v_fee_ccy:ind_fee_ccy,
			:v_requested_amount:ind_requested_amount,
			:v_req_amt_ccy:ind_req_amt_ccy;

		fprintf(fp,XLS_NC);

/* create_updatetime */
                v_create_timestamp.arr[v_create_timestamp.len] = '\0';
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_create_timestamp.arr,PD_MM_LEN,&v_create_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_create_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* last_updatetime */
                v_update_timestamp.arr[v_update_timestamp.len] = '\0';
		if (ind_update_timestamp >= 0 ) {
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_update_timestamp.arr,PD_MM_LEN,&v_update_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_update_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

/* approval_updatetime */
                v_approval_timestamp.arr[v_approval_timestamp.len] = '\0';
		if (ind_approval_timestamp >= 0 ) {
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_approval_timestamp.arr,PD_MM_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

/* txn id */
		v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);

/* psp_name */
		v_psp_name.arr[v_psp_name.len] = '\0';
		fprintf(fp,XLS_FL,v_psp_name.arr);

/* merchant_id */
		v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_id.arr);

/* merchant_name */
		v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* merchant_ref */
		v_merchant_ref.arr[v_merchant_ref.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_ref.arr);

/* sub_Status_desc */
		v_sub_status_desc.arr[v_sub_status_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_sub_status_desc.arr);

/* Status_desc */
		v_dm_status_desc.arr[v_dm_status_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_dm_status_desc.arr);

/* txn_ccy */
                v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* txn_amount */
                if (ind_txn_amount < 0 ) {
                        v_txn_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount);

/* net_amount */
                if (ind_net_amount < 0 ) {
                        v_net_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_net_amount);

/* ex_rate */
                if (ind_ex_rate < 0 ) {
                        v_ex_rate = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_ex_rate);

/* fee_ccy */
                v_fee_ccy.arr[v_fee_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_fee_ccy.arr);

/* fee */
                if (ind_fee < 0 ) {
                        v_fee = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_fee);

/* req_amt_ccy */
                v_req_amt_ccy.arr[v_req_amt_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_req_amt_ccy.arr);

/* requested_amount */
                if (ind_requested_amount < 0 ) {
                        v_requested_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_requested_amount);

		fprintf(fp,XLS_EC);
	}
/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt007_error:
DEBUGLOG(("extract_rpt007 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT008(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT008\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt008_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;

		varchar v_create_timestamp[PD_DATETIME_LEN + 1];
		varchar v_update_timestamp[PD_DATETIME_LEN + 1];
		varchar v_approval_timestamp[PD_DATETIME_LEN + 1];
		varchar v_txn_id[PD_TXN_SEQ_LEN + 1];
		varchar v_txn_code_desc[PD_DESC_LEN +1];
		varchar v_merchant_ref[PD_MERCHANT_REF_LEN + 1];
		varchar v_merchant_id[PD_MERCHANT_ID_LEN + 1];
		varchar v_merchant_name[PD_NAME_LEN + 1];
		varchar v_dm_status_desc[PD_DESC_LEN +1];
		varchar v_sub_status_desc[PD_DESC_LEN +1];
		varchar v_txn_ccy[PD_CCY_ID_LEN + 1];
		double  v_txn_amount;
		double  v_net_amount;
		double  v_ex_rate;
		varchar v_fee_ccy[PD_CCY_ID_LEN + 1];
		double  v_fee;
		varchar v_req_amt_ccy[PD_CCY_ID_LEN + 1];
		double  v_requested_amount;

		short   ind_create_timestamp = -1;
		short   ind_update_timestamp = -1;
		short   ind_approval_timestamp = -1;
		short   ind_txn_id = -1;
		short   ind_txn_code_desc = -1;
		short   ind_merchant_ref = -1;
		short   ind_merchant_id = -1;
		short   ind_merchant_name = -1;
		short   ind_dm_status_desc = -1;
		short   ind_sub_status_desc = -1;
		short   ind_txn_ccy = -1;
		short   ind_txn_amount = -1;
		short   ind_net_amount = -1;
		short   ind_ex_rate = -1;
		short   ind_fee_ccy = -1;
		short   ind_fee = -1;
		short   ind_req_amt_ccy = -1;
		short   ind_requested_amount = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Create Date");
	fprintf(fp,XLS_FL,"Last Update Date");
	fprintf(fp,XLS_FL,"Approval Date");
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"Txn Code Desc");
	fprintf(fp,XLS_FL,"Merchant ID");
	fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Merchant Ref #");
	fprintf(fp,XLS_FL,"Substatus Desc");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Txn Amount");
	fprintf(fp,XLS_FL,"Net Amount");
	fprintf(fp,XLS_FL,"Exchange Rate");
	fprintf(fp,XLS_FL,"Fee Currency");
	fprintf(fp,XLS_FL,"Fee");
	fprintf(fp,XLS_FL,"Amount Currency");
	fprintf(fp,XLS_FL,"Requested Amount");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_create_timestamp:ind_create_timestamp,
			:v_update_timestamp:ind_update_timestamp,
			:v_approval_timestamp:ind_approval_timestamp,
			:v_txn_id:ind_txn_id,
			:v_merchant_ref:ind_merchant_ref,
			:v_txn_code_desc:ind_txn_code_desc,
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_dm_status_desc:ind_dm_status_desc,
			:v_sub_status_desc:ind_sub_status_desc,
			:v_txn_amount:ind_txn_amount,
			:v_txn_ccy:ind_txn_ccy,
			:v_net_amount:ind_net_amount,
			:v_ex_rate:ind_ex_rate,
			:v_fee:ind_fee,
			:v_fee_ccy:ind_fee_ccy,
			:v_requested_amount:ind_requested_amount,
			:v_req_amt_ccy:ind_req_amt_ccy;

		fprintf(fp,XLS_NC);

/* create_updatetime */
                v_create_timestamp.arr[v_create_timestamp.len] = '\0';
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_create_timestamp.arr,PD_MM_LEN,&v_create_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_create_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);

/* last_updatetime */
                v_update_timestamp.arr[v_update_timestamp.len] = '\0';
		if (ind_update_timestamp >= 0 ) {
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_update_timestamp.arr,PD_MM_LEN,&v_update_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_update_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

/* approval_updatetime */
                v_approval_timestamp.arr[v_approval_timestamp.len] = '\0';
		if (ind_approval_timestamp >= 0 ) {
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_approval_timestamp.arr,PD_MM_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

/* txn id */
		v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);

/* txn_desc */
                v_txn_code_desc.arr[v_txn_code_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_code_desc.arr);

/* merchant_id */
		v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_id.arr);

/* merchant_name */
		v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* merchant_ref */
		v_merchant_ref.arr[v_merchant_ref.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_ref.arr);

/* sub_Status_desc */
		v_sub_status_desc.arr[v_sub_status_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_sub_status_desc.arr);

/* Status_desc */
		v_dm_status_desc.arr[v_dm_status_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_dm_status_desc.arr);

/* txn_ccy */
                v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* txn_amount */
                if (ind_txn_amount < 0 ) {
                        v_txn_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount);

/* net_amount */
                if (ind_net_amount < 0 ) {
                        v_net_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_net_amount);

/* ex_rate */
                if (ind_ex_rate < 0 ) {
                        v_ex_rate = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_ex_rate);

/* fee_ccy */
                v_fee_ccy.arr[v_fee_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_fee_ccy.arr);

/* fee */
                if (ind_fee < 0 ) {
                        v_fee = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_fee);

/* req_amt_ccy */
                v_req_amt_ccy.arr[v_req_amt_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_req_amt_ccy.arr);

/* requested_amount */
                if (ind_requested_amount < 0 ) {
                        v_requested_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_requested_amount);

		fprintf(fp,XLS_EC);
	}
/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt008_error:
DEBUGLOG(("extract_rpt008 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}



int Extract_RPT009(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT009\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt009_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;

		varchar v_merchant_id[PD_MERCHANT_ID_LEN + 1];
		varchar v_merchant_name[PD_NAME_LEN + 1];
		varchar v_service_code_desc[PD_DESC_LEN +1];
		varchar v_approval_timestamp[PD_DATETIME_LEN + 1];
		double  v_current_bal;
		double  v_total_float;
		double  v_total_reserved_amt;
		double  v_total_hold;
		double  v_settlement_in_transit;
		varchar v_mb_ccy[PD_CCY_ID_LEN + 1];
		varchar v_ds_desc[PD_DESC_LEN +1];

		short   ind_merchant_id = -1;
		short   ind_merchant_name = -1;
		short   ind_service_code_desc = -1;
		short   ind_approval_timestamp = -1;
		short   ind_current_bal = -1;
		short   ind_total_float = -1;
		short   ind_total_reserved_amt = -1;
		short   ind_total_hold = -1;
		short   ind_settlement_in_transit = -1;
		short   ind_mb_ccy = -1;
		short   ind_ds_desc = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Merchant ID");
	fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Service Desc");
	fprintf(fp,XLS_FL,"Approval Date");
	fprintf(fp,XLS_FL,"Current Balance");
	fprintf(fp,XLS_FL,"Total Float");
	fprintf(fp,XLS_FL,"Total Reserved Amount");
	fprintf(fp,XLS_FL,"Total Hold");
	fprintf(fp,XLS_FL,"Settlement in Transit");
	fprintf(fp,XLS_FL,"Currency");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_service_code_desc:ind_service_code_desc,
			:v_approval_timestamp:ind_approval_timestamp,
			:v_current_bal:ind_current_bal,
			:v_total_float:ind_total_float,
			:v_total_reserved_amt:ind_total_reserved_amt,
			:v_total_hold:ind_total_hold,
			:v_settlement_in_transit:ind_settlement_in_transit,
			:v_mb_ccy:ind_mb_ccy,
			:v_ds_desc:ind_ds_desc;

		fprintf(fp,XLS_NC);

/* merchant_id */
                v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_id.arr);

/* merchant_name */
                v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* service_desc */
                v_service_code_desc.arr[v_service_code_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_service_code_desc.arr);

/* approval_updatetime */
                v_approval_timestamp.arr[v_approval_timestamp.len] = '\0';
		if (ind_approval_timestamp >= 0 ) {
		fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_approval_timestamp.arr,PD_MM_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN],PD_DD_LEN,&v_approval_timestamp.arr[PD_YYYY_LEN + PD_MM_LEN]);
		}
		else {
			fprintf(fp,XLS_FL," ");
		}

/*current bal */
                if (ind_current_bal < 0)
                        v_current_bal = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_current_bal);

/*total float */
                if (ind_total_float < 0)
                        v_total_float = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_total_float);

/*total reserved amount*/
                if (ind_total_reserved_amt < 0)
                        v_total_reserved_amt = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_total_reserved_amt);

/*total hold */
                if (ind_total_hold < 0)
                        v_total_hold = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_total_hold);

/*settlement in transit*/
                if (ind_settlement_in_transit < 0)
                        v_settlement_in_transit = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_settlement_in_transit);

/* mb_ccy */
                v_mb_ccy.arr[v_mb_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_mb_ccy.arr);

/* status */
                v_ds_desc.arr[v_ds_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_ds_desc.arr);

		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt009_error:
DEBUGLOG(("extract_rpt009 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}

int Extract_RPT010(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT010\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt010_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_approval_datetime[PD_DATE_LEN + PD_TIME_LEN + 1];
		varchar v_txn_id[PD_TXN_ID_LEN +1];
		varchar v_merchant_id[PD_MERCHANT_ID_LEN +1];
		varchar	v_merchant_name[PD_NAME_LEN +1];
		varchar v_txn_code_desc[PD_DESC_LEN +1];
		varchar v_status[PD_NAME_LEN +1];
		varchar v_sub_status[PD_DESC_LEN +1];
		double  v_txn_amount;
		varchar	v_txn_ccy[PD_CCY_ID_LEN + 1];
		double	v_fee_amount;
		varchar	v_fee_ccy[PD_CCY_ID_LEN + 1];	

		short	ind_approval_datetime = -1;
		short	ind_txn_id = -1;
		short   ind_merchant_id = -1;
		short   ind_merchant_name = -1;
		short   ind_txn_code_desc = -1;
		short	ind_status = -1;
		short	ind_sub_status = -1;
		short	ind_txn_amount = -1;
		short	ind_txn_ccy = -1;
		short	ind_fee_amount = -1;
		short	ind_fee_ccy = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Approval Date");
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"Merchant ID");
	fprintf(fp,XLS_FL,"Merchant Name");
	fprintf(fp,XLS_FL,"Txn Type");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Sub Status");
	fprintf(fp,XLS_FL,"Transaction Amount");
	fprintf(fp,XLS_FL,"Txn Currency");
	fprintf(fp,XLS_FL,"Fee Amount");
	fprintf(fp,XLS_FL,"Fee Currency");

	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_approval_datetime:ind_approval_datetime,
			:v_txn_id:ind_txn_id,
			:v_merchant_id:ind_merchant_id,
			:v_merchant_name:ind_merchant_name,
			:v_txn_code_desc:ind_txn_code_desc,
			:v_status:ind_status,
			:v_sub_status:ind_sub_status,
			:v_txn_amount:ind_txn_amount,
			:v_txn_ccy:ind_txn_ccy,
			:v_fee_amount:ind_fee_amount,
			:v_fee_ccy:ind_fee_ccy;

		fprintf(fp,XLS_NC);

/* approval datetime */
               v_approval_datetime.arr[v_approval_datetime.len] = '\0';
                if (ind_approval_datetime >= 0 ) {
                        fprintf(fp,XLS_FL_DATE,PD_YYYY_LEN,v_approval_datetime.arr,PD_MM_LEN,&v_approval_datetime.arr[PD_YYYY_LEN],PD_DD_LEN,&v_approval_datetime.arr[PD_YYYY_LEN + PD_MM_LEN]);
                }
                else {
                        fprintf(fp,XLS_FL," ");
                }

/* txn_id */
                v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);


/* merchant_id */
                v_merchant_id.arr[v_merchant_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_merchant_id.arr);

/* merchant_name */
                v_merchant_name.arr[v_merchant_name.len] = '\0';
		fprintf(fp,XLS_FL,v_merchant_name.arr);

/* txn_code_desc */
                v_txn_code_desc.arr[v_txn_code_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_code_desc.arr);

/* status */
                v_status.arr[v_status.len] = '\0';
		fprintf(fp,XLS_FL,v_status.arr);

/* sub_status */
                v_sub_status.arr[v_sub_status.len] = '\0';
		fprintf(fp,XLS_FL,v_sub_status.arr);


/* txn_amount */
                if (ind_txn_amount < 0)
                        v_txn_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount);

/* txn_ccy */
                v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* fee_amount */
                if (ind_fee_amount < 0)
                        v_fee_amount = 0.0;
		fprintf(fp,XLS_FL_DOUBLE,v_fee_amount);

/* fee_ccy */
                v_fee_ccy.arr[v_fee_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_fee_ccy.arr);


		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt010_error:
DEBUGLOG(("extract_rpt010 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}


int Extract_RPT011(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	
DEBUGLOG(("Extract_RPT011\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt011_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;

		varchar v_txn_id[PD_TXN_ID_LEN +1];
		varchar v_txn_code[PD_TXN_CODE_LEN +1];
		varchar v_txn_code_desc[PD_DESC_LEN +1];
		varchar v_txn_date[PD_DATE_LEN +1];
		varchar v_psp_id[PD_PSP_ID_LEN +1];
		varchar v_psp_name[PD_PSP_NAME_LEN + 1];
		varchar v_txn_ccy[PD_CCY_ID_LEN + 1];
		double  v_txn_amount;
		double  v_service_fee;

		short   ind_txn_id = -1;
		short   ind_txn_code = -1;
		short   ind_txn_code_desc = -1;
		short   ind_txn_date = -1;
		short   ind_psp_id = -1;
		short   ind_psp_name = -1;
		short   ind_txn_ccy = -1;
		short   ind_txn_amount = -1;
		short   ind_service_fee = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn ID");
	fprintf(fp,XLS_FL,"Txn Code");
	fprintf(fp,XLS_FL,"Txn Date");
	fprintf(fp,XLS_FL,"PSP ID");
	fprintf(fp,XLS_FL,"PSP Name");
	fprintf(fp,XLS_FL,"Currency");
	fprintf(fp,XLS_FL,"Txn Amount");
	fprintf(fp,XLS_FL,"Service Fee");
	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_txn_id:ind_txn_id,
			:v_txn_code:ind_txn_code,
			:v_txn_code_desc:ind_txn_code_desc,
			:v_txn_date:ind_txn_date,
			:v_psp_id:ind_psp_id,
			:v_psp_name:ind_psp_name,
			:v_txn_ccy:ind_txn_ccy,
			:v_txn_amount:ind_txn_amount,
			:v_service_fee:ind_service_fee;

/* txn id */
                v_txn_id.arr[v_txn_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_id.arr);

/* txn code */
                v_txn_code.arr[v_txn_code.len] = '\0';

/* txn_desc */
                v_txn_code_desc.arr[v_txn_code_desc.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_code_desc.arr);

/*txn date */
                v_txn_date.arr[v_txn_date.len] = '\0';

/* psp id */
                v_psp_id.arr[v_psp_id.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_psp_id.arr);

/* psp_name */
                v_psp_name.arr[v_psp_name.len] = '\0';
		fprintf(fp,XLS_FL,v_psp_name.arr);

/* txn_ccy */
                v_txn_ccy.arr[v_txn_ccy.len] = '\0';
		fprintf(fp,XLS_FL,v_txn_ccy.arr);

/* txn_amount */
                if (ind_txn_amount < 0) {
                        v_txn_amount = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_txn_amount);

/* Service_fee */
                if (ind_service_fee < 0) {
                        v_service_fee = 0.0;
		}
		fprintf(fp,XLS_FL_DOUBLE,v_service_fee);

		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);


DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt011_error:
DEBUGLOG(("extract_rpt011 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}


int Extract_RPT013(FILE* fp, SQL_CURSOR c_input_cursor)
{
	int	iRet = SUCCESS;
	char	*csTmp;
	
DEBUGLOG(("Extract_RPT013\n"));
	EXEC SQL WHENEVER SQLERROR GOTO extract_rpt013_error;
        EXEC SQL WHENEVER NOTFOUND CONTINUE;

        EXEC SQL BEGIN DECLARE SECTION;
		varchar v_txn_code_desc[PD_DESC_LEN +1];
		varchar v_service_code[PD_SERVICE_CODE_LEN + 1];
		varchar v_service_name[PD_NAME_LEN +1];
		varchar v_status[PD_NAME_LEN +1];
		int     v_txn_count;

		short	ind_txn_code_desc = -1;
		short	ind_service_code = -1;
		short	ind_service_name = -1;
		short	ind_status = -1;
		short	ind_txn_count = -1;

	EXEC SQL END DECLARE SECTION;

/* hd */	
	fprintf(fp,XLS_HD);
	fprintf(fp,XLS_NC);
	fprintf(fp,XLS_FL,"Txn Type");
	fprintf(fp,XLS_FL,"Service Name");
	fprintf(fp,XLS_FL,"Status");
	fprintf(fp,XLS_FL,"Transaction Count");

	fprintf(fp,XLS_EC);

/* style */	
	fprintf(fp,XLS_SY);
	for (;;) {
		EXEC SQL WHENEVER NOTFOUND DO break;
                EXEC SQL FETCH :c_input_cursor
                INTO
			:v_txn_code_desc:ind_txn_code_desc,
			:v_service_code:ind_service_code,
			:v_service_name:ind_service_name,
			:v_status:ind_status,
			:v_txn_count:ind_txn_count; 

		fprintf(fp,XLS_NC);

/* txn_code_desc */
                v_txn_code_desc.arr[v_txn_code_desc.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_txn_code_desc.arr);

/* service name*/
                v_service_name.arr[v_service_name.len] = '\0';
		fprintf(fp,XLS_FL_TEXT,v_service_name.arr);

/* status */
                v_status.arr[v_status.len] = '\0';
		fprintf(fp,XLS_FL,v_status.arr);

/* txn_count */
		if (ind_txn_count < 0) {
			v_txn_count = 0;
		}

		csTmp = (char*) malloc (20);
		sprintf(csTmp, "%d", v_txn_count);
		fprintf(fp, XLS_FL, csTmp);
		FREE_ME(csTmp);


		fprintf(fp,XLS_EC);
	}

/* tailer */
	fprintf(fp,XLS_TR);

DEBUGLOG(("iRet = [%d]\n",iRet));
	return iRet;
extract_rpt013_error:
DEBUGLOG(("extract_rpt013 code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
        EXEC SQL WHENEVER SQLERROR CONTINUE;
        return FAILURE;
}
