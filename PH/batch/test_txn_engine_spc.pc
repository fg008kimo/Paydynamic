#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"
#include "curl/curl.h"
#include "ObjPtr.h"
#include "myrecordset.h"

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

int	iSpcAction = -1;

OBJPTR(BO);

char cDebug = 'Y';

int	parse_arg(int argc,char **argv);

int batch_init(int argc, char* argv[])
{
	return SUCCESS;
}

int batch_proc(int argc, char* argv[])
{
	int iRet = parse_arg(argc,argv);

	hash_t *hContext;
	hContext = (hash_t*) malloc (sizeof(hash_t));
	hash_init(hContext,0);

	//PutField_CString(hContext,"return_type",PD_STRING_TYPE);

//SpcAction = 5
	if (iSpcAction==5) 
	{
		PutField_CString(hContext,"BAID_category","internal");
		PutField_Int(hContext,"use_pending_fund",1);
		PutField_CString(hContext,"post_psp_txn_id","000");
	}
	else if (iSpcAction==3) 
	{
		PutField_Double(hContext,"psp_txn_amt",12.3);
		PutField_Double(hContext,"baid_txn_amt",2.0);
	}
	else if (iSpcAction==1) 
	{
//		PutField_CString(hContext,"BAID_category","123");
		PutField_CString(hContext,"BAID_category","internal");
	}

	if (iSpcAction > 0)
	{
printf("Call BOOLTxnEngineSpc iSpcAction=[%i]\n",iSpcAction);
		BOObjPtr = CreateObj(BOPtr, "BOOLTxnEngineSpc", "RunSpecialAction");
		iRet = (unsigned long)(*BOObjPtr)(iSpcAction,hContext);
	}
	else iRet = FAILURE;

	printf("iRet = [%d]\n", iRet);

	return iRet;
}

int batch_terminate(int argc, char* argv[])
{
    return SUCCESS;
}

int parse_arg(int argc,char **argv)
{
	char    c;

	if (argc < 3) {
		return PD_ERR;
	}

	while ((c = getopt(argc,argv,"a:")) != EOF) {
		switch (c) {
			case 'a':
				iSpcAction = atoi(optarg);
				break;
			default:
				return PD_ERR;
		}
	}

	return SUCCESS;
}
