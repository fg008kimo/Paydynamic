#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"
#include "eod_glutility.h"
#include "debug.h"


#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode


char	cDebug = 'Y';

int batch_init(int argc, char* argv[])
{
        return SUCCESS;
}

int init_data(rDATA_T *rRec) 
{
	rRec->total_count=11;
	rRec->data = malloc ( rRec->total_count * sizeof(data_t));

/*psp txn amt */
	strcpy(rRec->data[0]->type,"PSP_AMT");
	strcpy(rRec->data[0]->ccyname,"tp_txn_ccy");
	strcpy(rRec->data[0]->amtname,"tp_txn_amount");
	rRec->data[0]->chargetype = NULL;

/*psp fee */
	strcpy(rRec->data[1]->type,"PSP_FEE");
	strcpy(rRec->data[1]->ccyname,"tp_txn_ccy");
	strcpy(rRec->data[1]->amtname,"tp_service_fee");
	rRec->data[1]->chargetype = NULL;

/* txn amt */
	strcpy(rRec->data[2]->type,"TXN_AMT");
	strcpy(rRec->data[2]->ccyname,"td_txn_ccy");
	strcpy(rRec->data[2]->amtname,"th_transaction_amount");
	rRec->data[2]->chargetype = NULL;

/*net amount */
	strcpy(rRec->data[3]->type,"TXN_AMT");
	strcpy(rRec->data[3]->ccyname,"td_txn_ccy");
	strcpy(rRec->data[3]->amtname,"th_net_amount");
	rRec->data[3]->chargetype = NULL;

/* reserve amount */
	strcpy(rRec->data[4]->type,"RES_AMT");
	strcpy(rRec->data[4]->ccyname,"td_txn_ccy");
	strcpy(rRec->data[4]->amtname,"th_reserve_amount");
	rRec->data[4]->chargetype = NULL;

/* merchant markup */
	strcpy(rRec->data[5]->type,"MMU");
	strcpy(rRec->data[5]->ccyname,"tf_ccy");
	strcpy(rRec->data[5]->amtname,"tf_fee");
	rRec->data[5]->chargetype = strdup("MU");
	rRec->data[5]->custtype = 'M';


/* customer markup */
	strcpy(rRec->data[6]->type,"CMU");
	strcpy(rRec->data[6]->ccyname,"tf_ccy");
	strcpy(rRec->data[6]->amtname,"tf_fee");
	rRec->data[6]->chargetype = strdup("MU");
	rRec->data[6]->custtype = 'C';

/* merchant fee */
	strcpy(rRec->data[7]->type,"MFE");
	strcpy(rRec->data[7]->ccyname,"tf_ccy");
	strcpy(rRec->data[7]->amtname,"tf_fee");
	rRec->data[7]->chargetype = strdup("FE");
	rRec->data[7]->custtype = 'M';

/* customer fee */
	strcpy(rRec->data[8]->type,"CFE");
	strcpy(rRec->data[8]->ccyname,"tf_ccy");
	strcpy(rRec->data[8]->amtname,"tf_fee");
	rRec->data[8]->chargetype = strdup("FE");
	rRec->data[8]->custtype = 'C';

/* merchant exchange markup */
	strcpy(rRec->data[9]->type,"MXU");
	strcpy(rRec->data[9]->ccyname,"tf_ccy");
	strcpy(rRec->data[9]->amtname,"tf_fee");
	rRec->data[9]->chargetype = strdup("XU");
	rRec->data[9]->custtype = 'M';

/* customer fee */
	strcpy(rRec->data[10]->type,"CXU");
	strcpy(rRec->data[10]->ccyname,"tf_ccy");
	strcpy(rRec->data[10]->amtname,"tf_fee");
	rRec->data[10]->chargetype = strdup("XU");
	rRec->data[10]->custtype = 'C';


	return PD_OK;
}

int batch_proc(int argc, char* argv[])
{
	int	iRet = PD_OK;
	int	i;

	char	csSQL[PD_MAX_BUFFER + 1];
	rDATA_T	rData;

/*
	EXEC SQL BEGIN DECLARE SECTION;
                varchar v_sql[PD_MAX_BUFFER + 1];
        EXEC SQL END DECLARE SECTION;
*/

	
	memset(csSQL,0,PD_MAX_BUFFER);
	iRet = init_data(&rData);

DEBUGLOG(("total = [%d]\n",rData.total_count));
	for (i = 0 ; i < rData.total_count;i++) {
		iRet = GenSQL("20110622",rData.data[i],csSQL);
	}

DEBUGLOG(("[%s]\n",csSQL));
	return SUCCESS;
}


int batch_terminate(int argc, char* argv[])
{
    return SUCCESS;
}

