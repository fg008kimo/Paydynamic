#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdint.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"
#include "curl/curl.h"
#include "ObjPtr.h"
#include "myrecordset.h"
#include <openssl/rand.h>

#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode
#define MAX_MSG_SIZE 4096

OBJPTR(BO);

char	cDebug='Y';

int batch_init(int argc, char* argv[])
{
        return SUCCESS;
}


int batch_proc(int argc, char* argv[])
{
        int iRet = PD_OK;
        int iLen = 0;
        char    *csData;
        char    *csDecryptedInfo;
        csData = (char*) malloc (MAX_MSG_SIZE + 1 );
        char *csEncData = (char*) malloc (MAX_MSG_SIZE + 1 );
        csDecryptedInfo = (char*) malloc (PD_MAX_BUFFER);

        memset(csData,0,sizeof(csData));
        memset(csDecryptedInfo,0,sizeof(csDecryptedInfo));
        BOObjPtr = CreateObj(BOPtr,"BOSecurity","AESEncryptData");
        iRet = (unsigned long)(*BOObjPtr)("FA14A14424610CF5",
					  "{\"merchantId\":\"120140259\",\"requestId\":\"0000000002799242\",\"serialNumber\":\"sn000000001\",\"totalRefundCount\":\"0\",\"totalRefundAmount\":\"0\",\"orderCurrency\":\"RMB\",\"orderAmount\":\"6666\",\"status\":\"SUCCESS\",\"completeDateTime\":\"2017-12-11 17:21:35\",\"hmac\":\"f23c8c3c5ef0418d0684e76f61cedee9\"}"
					  ,csData,&iLen);

        if (iRet == PD_OK) {

                memset(csEncData,0,sizeof(csEncData));
                base64_encode((unsigned char *)csData,iLen,csEncData,PD_MAX_BUFFER);

printf("BOSecurity:AESEncryptData() encrypted data = [%d][%s]\n",iLen,csEncData);

                BOObjPtr = CreateObj(BOPtr,"BOSecurity","AESDecryptData");
                iRet = (unsigned long)(*BOObjPtr)("FA14A14424610CF5",csData,iLen,csDecryptedInfo);
        }

        if (iRet == PD_OK) {
printf("BOSecurity:AESEncryptData() input data = [%s]\n",csDecryptedInfo);
        }

        FREE_ME(csData);
        FREE_ME(csDecryptedInfo);
        return SUCCESS;
}


int batch_terminate(int argc, char* argv[])
{
    return SUCCESS;
}

