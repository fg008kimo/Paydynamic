#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"
#include "expat.h"
#include <curl/curl.h>
#include "myhash.h"
#include "ObjPtr.h"
#include "numutility.h"
#include "myrecordset.h"
#include "dates.h"

#include "TxnSeq.h"
#include "BOSecurity.h"

#include "sha1.h"
#define TESTA   "abc"

OBJPTR(BO);
char    cDebug;

#define KEY	"5ebd05cecabb3a81a5a43bfb895605bd"
#define DATA_H	"888000130|3"
//#define DATA_C	"000037|5948522376|123448723164|TW|150"
//#define DATA_C	"000038|5721628731|873121182961|TW|150"
#define DATA_C	" 000039|5819717283|298377361938|TW|150"

int batch_init(int argc, char* argv[])
{
/*	if(argc<2)
	{
DEBUGLOG(("Please input enought arguments\n"));
		return FAILURE;
	}
	else  {
		return SUCCESS;
	}
 */
	return SUCCESS;
}




int batch_proc(int argc, char* argv[])
{
	int iRet = PD_TRUE;
	hash_t *hTemp;
	int	iCheck = PD_FALSE;
	
	char	*csTmp;
	double	dTmp = 0.0;
	long	lTmp;

        hTemp= (hash_t*)malloc(sizeof(hash_t));
        hash_init(hTemp, 0);


	PutField_CString(hTemp, "txn_amt", "1000");
	//PutField_CString(hTemp, "txn_amt", "2.00");

	if (GetField_CString(hTemp, "txn_amt", &csTmp)) {

		iCheck = is_numeric(csTmp);
		//iCheck = PD_TRUE;

		if (iCheck == PD_FALSE) {
			iRet = iCheck;
			printf("iCheck is PD_FALSE\n");
			
		}
		else {
			if(strlen(csTmp)>(PD_DIGIT_LEN+PD_DECIMAL_LEN)) {
				iRet = PD_ERR;
				printf("strlen error!!!\n");
			}
			else {		
				dTmp = myctod((const unsigned char *)csTmp,strlen(csTmp) - PD_DECIMAL_LEN,PD_DECIMAL_LEN);

				printf("dTmp [%lf]\n", dTmp);

				lTmp = (long)dTmp;
				printf("lTmp [%ld]\n", lTmp);

			}
		}
	}
        hash_destroy(hTemp);
        FREE_ME(hTemp);	


	/**** TEST strtok *****/
	char	*csDATA;
	char	*p;
	char	*csTID;

	csDATA= (char*)malloc (PD_MAX_BUFFER + 1);
	csTID = (char*)malloc(PD_PSP_TID_LEN + 1);

	memcpy(csDATA, DATA_C, strlen(DATA_C));
	csDATA[strlen(DATA_C)] = '\0';

printf("csDATA [%s]\n", csDATA);

	p = strtok(csDATA, "|");
	if (p) {
		printf("p = [%s]\n", p);

		strcpy(csTID, TrimLeft((const unsigned char*) p, strlen(p)));
printf("csTID [%s]\n", csTID);

	}

	FREE_ME(csTID);


	return iRet;
}


int batch_terminate(int argc, char* argv[])
{
	return SUCCESS;
}
