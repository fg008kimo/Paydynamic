#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "common.h"
#include "utilitys.h"
#include "expat.h"
#include <curl/curl.h>
#include "myhash.h"
#include "ObjPtr.h"
#include "numutility.h"
#include "myrecordset.h"
#include "dates.h"
#include "mymd5.h"

#include "TxnSeq.h"
#include "BOSecurity.h"

#include "sha1.h"
#define TESTA   "abc"

OBJPTR(BO);
char    cDebug;

#define KEY	"5ebd05cecabb3a81a5a43bfb895605bd"
#define DATA_H	"888000130|3"
//#define DATA_C	"000037|5948522376|123448723164|TW|150"
//#define DATA_C	"000038|5721628731|873121182961|TW|150"
#define DATA_C	"000039|5819717283|298377361938|TW|150"

int batch_init(int argc, char* argv[])
{
	return SUCCESS;
}




int batch_proc(int argc, char* argv[])
{

        int             iRet = PD_OK;
	char		*OUT;

        char            *csBuf;
	char		*DATA;

        DATA = (char*) malloc (PD_TMP_MSG_BUF_LEN +1);
        csBuf = (char*) malloc (PD_TMP_MSG_BUF_LEN +1);
        OUT = (char*) malloc (PD_TMP_MSG_BUF_LEN +1);

	DATA[0]='\0';
        OUT[0]='\0';
        csBuf[0]='\0';
	
	strcpy(DATA, "M80000091");

        strcat((char*)OUT,(char*)DATA);
        //strcat((char*)OUT,(char*)KEY);
	//printf("OUT [%s]\n", OUT);

        md5sum((const char*)OUT,strlen((const char*)OUT),csBuf);
        //printf("sign             = [%s]\n",csBuf);
        OUT[0] = '\0';

        U2L(csBuf,strlen(csBuf),(char*)OUT);
	//printf("lower sign       = [%s]\n",OUT);

        /***********************/        
	DATA[0]='\0';
        OUT[0]='\0';
        csBuf[0]='\0';
	
	//strcpy(DATA, "000001WSDIYWFWVJMUR00M29497");
	//strcpy(DATA, "000001WSDIYWFWVJMUR00Z294.97");

	//strcpy(DATA, "0000000000083413420131115200123CNY10000AA001MVHS0001");
	//strcat(DATA, "9zfYgBtKA8MZNT2715DtrsoFZeuWfYUgqt8qORyQiVfL918Ttm9cHO5qk0YcrxFCEFJ4ulJAgNkwm3f860DSzRy1NrgySw9Lp3gUHe8h3YVUDjdHu06QKMnMrrGdfvHK");

	
	strcpy(DATA, "100USD123123145U800003620131215161239");
	strcat(DATA, "mjp85xc5FNFfY2LtyMnhXEe8T3iOsDeVmKQf6sXA7cfSSqBG3olPqFKA6rMnuq7U1Nzt4NtznOH63HBtvk9apHYiykMiOG1DRqwL2gAcsGYlLXS79QUnVsKJQUpfaggs");

	/*
	strcpy(DATA, "1000CNY53ccf5a4982a0785ed54c82ac18554K00000000120131216095147");
	strcat(DATA, "9zfYgBtKA8MZNT2715DtrsoFZeuWfYUgqt8qORyQiVfL918Ttm9cHO5qk0YcrxFCEFJ4ulJAgNkwm3f860DSzRy1NrgySw9Lp3gUHe8h3YVUDjdHu06QKMnMrrGdfvHK");
	*/

        strcat((char*)OUT,(char*)DATA);
        //strcat((char*)OUT,(char*)KEY);
	printf("OUT [%s]\n", OUT);

        md5sum((const char*)OUT,strlen((const char*)OUT),csBuf);
        printf("sign             = [%s]\n",csBuf);
        OUT[0] = '\0';

        U2L(csBuf,strlen(csBuf),(char*)OUT);
	printf("lower sign       = [%s]\n",OUT);


        /***********************/
	//printf("Desposit SHA1\n");
        DATA[0]='\0';
        OUT[0]='\0';
        csBuf[0]='\0';

	//strcpy(DATA, "2000USD52725178-70A8-NU800002420131031124756");
	//strcat(DATA, "9A33DBFE2A40C91AC70DBEC15D2A5F3D");
	//strcpy(DATA, "0000000000083413420131115200123CNY10000AA001MVHS0001");
	//strcat(DATA, "9zfYgBtKA8MZNT2715DtrsoFZeuWfYUgqt8qORyQiVfL918Ttm9cHO5qk0YcrxFCEFJ4ulJAgNkwm3f860DSzRy1NrgySw9Lp3gUHe8h3YVUDjdHu06QKMnMrrGdfvHK");

	sha1sum(DATA, strlen(DATA), csBuf);
        //printf("sign = [%s]\n", csBuf);

	U2L(csBuf, strlen(csBuf), (char*) OUT);
	//printf("lower sign       = [%s]\n",OUT);


        FREE_ME(csBuf);
	FREE_ME(DATA);
	FREE_ME(OUT);

        return SUCCESS;


}


int batch_terminate(int argc, char* argv[])
{
	return SUCCESS;
}
