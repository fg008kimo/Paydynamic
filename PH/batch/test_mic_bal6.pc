/*
PDProTech (c)2010. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of PDProTech.

Change Description                            Change Date     Change By
------------------------------------------    ------------    --------------
Init Version                                  2020/02/26      Michael Chow
*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "batchcommon.h"
#include "common.h"
#include "utilitys.h"
#include "myhash.h"
#include "numutility.h"
#include "ObjPtr.h"
#include "dbutility.h"


#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

OBJPTR(DB);
OBJPTR(Txn);

static char cDebug = 'Y';

int parse_arg(int argc,char **argv);




int batch_init(int argc, char* argv[])
{
	return SUCCESS;
}

int batch_proc(int argc, char* argv[])
{
	int iRet;
	//char csMerchantId[20]={0};
	char csMerchantId[20]="b";
	
	EXEC SQL WHENEVER SQLERROR GOTO cbledger_sql_error;
	EXEC SQL WHENEVER NOTFOUND CONTINUE;
	
	EXEC SQL BEGIN DECLARE SECTION;
			varchar hv_merchant_id[20];
			varchar v_txn_id[20+1];
			
			short   ind_merchant_id  = -1;
			short   ind_txn_id = -1;
	EXEC SQL END DECLARE SECTION;

	if(strlen(csMerchantId) > 0)
	{
		hv_merchant_id.len = strlen(csMerchantId);
		strncpy((char *)hv_merchant_id.arr, csMerchantId, hv_merchant_id.len);
DEBUGLOG(("process_cbledger:merchant_id = [%.*s]\n",hv_merchant_id.len,hv_merchant_id.arr));
	} 
	else {
DEBUGLOG(("process_cbledger:merchant_id is null\n"));
		hv_merchant_id.len = 0;
	}
	ind_merchant_id = 0;
	
			
	EXEC SQL DECLARE c_cursor_getcbledger CURSOR FOR
			
		SELECT
			COL_1
		FROM TEMP_MIC WHERE BANK_GROUP = NVL(:hv_merchant_id,'2');
	EXEC SQL OPEN c_cursor_getcbledger;
        do {
			EXEC SQL FETCH c_cursor_getcbledger
			INTO
				:v_txn_id:ind_txn_id
			;
			if (SQLCODE == SQL_NOT_FOUND) {
				break;
			}
/* txn_id */
			if(ind_txn_id >=0){
				v_txn_id.arr[v_txn_id.len] = '\0';
DEBUGLOG(("process_cbledger v_txn_id = [%.*s]\n", v_txn_id.len, v_txn_id.arr));
			}
			else{
DEBUGLOG(("process_cbledger v_txn_id is null\n"));
			}
		}while (PD_TRUE);
			
        EXEC SQL CLOSE c_cursor_getcbledger;
		
	return FAILURE;
cbledger_sql_error:
DEBUGLOG(("extract_ol_account_ledger_daily_rpt:process_cbledger code %d\n", sqlca.sqlcode));
DEBUGLOG(("\n%.*s\n", sqlca.sqlerrm.sqlerrml, sqlca.sqlerrm.sqlerrmc));
	EXEC SQL WHENEVER SQLERROR CONTINUE;
	EXEC SQL CLOSE c_cursor_getcbledger;
	EXEC SQL ROLLBACK RELEASE;
	return FAILURE;
	
}

int batch_terminate(int argc, char* argv[])
{
	return SUCCESS;
}



int parse_arg(int argc,char **argv)
{

	return SUCCESS;
}

