#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <ctype.h>
#include <sqlca.h>
#include <sys/types.h>
#include <time.h>
#include "batchcommon.h"
#include "common.h"
#include "utilitys.h"
#include "myhash.h"
#include "numutility.h"
#include "myrecordset.h"


#define SQLCA_STORAGE_CLASS extern
#define SQLCODE sqlca.sqlcode

int CreateCurrReportPath(unsigned char* csDate, unsigned char* csPspId, unsigned char* csCurrentPath);

int batch_init(int argc, char* argv[])
{
	return SUCCESS;
}

int batch_proc(int argc, char* argv[])
{
        char    cs_outfile_name[PD_MAX_FILE_LEN + 1];

	if(argc==3){
		if (CreateCurrReportPath(argv[1],argv[2],cs_outfile_name) != SUCCESS)
			return FAILURE;
	}

	else{
		//if (CreateCurrReportPath(NULL,cs_outfile_name) != SUCCESS) 
                	return FAILURE;
	}
	
	printf("%s",cs_outfile_name);

	return SUCCESS;


}


int batch_terminate(int argc, char* argv[])
{
	return SUCCESS;
}


int CreateCurrReportPath(unsigned char* csDate, unsigned char* csPspId,unsigned char* csCurrentPath)
{
        char    csHostDate[PD_DATE_LEN + 1];
        char    cs_outfile_name[PD_MAX_FILE_LEN + 1];

	if(strcmp(csDate,"N")){
		strcpy(csHostDate,csDate);
		csHostDate[PD_DATE_LEN]='\0';
	}
	else{
        	if (GetCurrHostPostingDate(csHostDate) != SUCCESS)
                	return FAILURE;
	}

/* create report path */
        sprintf(csCurrentPath, "%s", getenv("REPORT_HOME"));
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", csCurrentPath);
        system(cs_outfile_name);

        sprintf(csCurrentPath, "%s/%.*s", getenv("REPORT_HOME"),PD_YYYY_LEN,csHostDate);
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", csCurrentPath);
        system(cs_outfile_name);

        sprintf(csCurrentPath, "%s/%.*s/%s", getenv("REPORT_HOME"),PD_YYYY_LEN,csHostDate,csPspId);
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", csCurrentPath);
        system(cs_outfile_name);

        sprintf(csCurrentPath, "%s/%.*s/%s/%.*s", getenv("REPORT_HOME"),PD_YYYY_LEN,csHostDate,csPspId,PD_YYYYMM_LEN,csHostDate);
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", csCurrentPath);
        system(cs_outfile_name);

        sprintf(csCurrentPath, "%s/%.*s/%s/%.*s/%s", getenv("REPORT_HOME"), PD_YYYY_LEN,csHostDate,csPspId,PD_YYYYMM_LEN,csHostDate,csHostDate);
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", csCurrentPath);

        system(cs_outfile_name);

/* create report data folder if not created */
        sprintf(cs_outfile_name, "mkdir %s >/dev/null 2>&1", getenv("REPORT_DATA"));
       system(cs_outfile_name);

        return SUCCESS;
}
