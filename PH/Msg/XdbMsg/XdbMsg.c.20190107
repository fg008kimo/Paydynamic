/*
PDProTech (c)2017. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of PDProTech.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version					   2018/08/22              David Wong
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include "XdbMsg.h"
#include "common.h"
#include "utilitys.h"
#include "queue_defs.h"
#include <zlib.h>
#include "b64.h"
#include "internal.h"
#include "ObjPtr.h"

static char	cDebug;
OBJPTR(DB);

void	XdbMsg(char cdebug)
{
	cDebug = cdebug;
}

int FormatMsg(const hash_t* hIn,unsigned char *outMsg,int *outLen)
{
	int	iRet = PD_OK;
	char*   csTmp = NULL;
	char*   csPtr = NULL;
	char*   csBuf;
	double  dTmp;
	char*   csMethod = NULL;
	int	iOpt = PD_TRUE;
	int	iIsVnet = PD_FALSE;

	csBuf = (char*) malloc (MAX_MSG_SIZE + 1 );

	memset(outMsg,0,sizeof(outMsg));
	if (GetField_CString(hIn,"redirect_url",&csPtr)) {
DEBUGLOG(("FormatMsg here\n"));
		strcat((char *)outMsg,csPtr);
		strcat((char *)outMsg,"?");

// p0_Cmd
		strcat((char*)outMsg,"p0_Cmd");
		strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
		strcat((char*)outMsg,PD_P0_CMD);
		strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p0_Cmd = [%s]\n",PD_P0_CMD));

// p1_MerId
		if (GetField_CString(hIn,"psp_merchant_id",&csTmp)) {
			strcat((char*)outMsg,"p1_MerId");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p1_MerId = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: ***psp_merchant_id is missing\n"));
		}

// p2_Order
		if (GetField_CString(hIn,"txn_seq",&csTmp)) {
			strcat((char*)outMsg,"p2_Order");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p2_Order = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: ***txn_seq is missing\n"));
		}

// p3_Cur
		strcat((char*)outMsg,"p3_Cur");
		strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
		strcat((char*)outMsg,PD_CCY_ISO_CNY);
		strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p3_Cur = [%s]\n",PD_CCY_ISO_CNY));


// p4_Amt
		if (GetField_Double(hIn,"psp_txn_amt",&dTmp)) {
			char csTmpAmt[PD_TMP_BUF_LEN +1];
			sprintf(csTmpAmt,"%.2f",dTmp);
			strcat((char*)outMsg,"p4_Amt");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmpAmt);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p4_Amt = [%s]\n",csTmpAmt));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: ***psp_txn_amt is missing!!!\n"));
		}

// p8_Url
		if (GetField_CString(hIn,"return_url_only",&csTmp)) {
			strcat((char*)outMsg,"p8_Url");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: p8_Url = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** return_url_only is missing\n"));
		}

// pa_FrpId
		if (GetField_CString(hIn,"bank_code",&csTmp)) {
			strcat((char*)outMsg,"pa_FrpId");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			DBObjPtr = CreateObj(DBPtr,"DBMobBankMap","IsMobileOption");
			iOpt = (unsigned long)(*DBObjPtr)(csTmp);
			if(iOpt==PD_FALSE && iOpt!=INT_ERR){
				strcat((char*)outMsg,PD_PA_FRPID_VNET);
DEBUGLOG(("FormatMsg:: pa_FrpId = [%s]\n",PD_PA_FRPID_VNET));
				iIsVnet = PD_TRUE;
			} else if(iOpt && iOpt!=INT_ERR){
				strcat((char*)outMsg,PD_PA_FRPID_EC);
DEBUGLOG(("FormatMsg:: pa_FrpId = [%s]\n",PD_PA_FRPID_EC));
			}
			strcat((char*)outMsg,MY_XDB_TOKEN);
		}

// pg_BankCode
		if (iIsVnet) {
			if (GetField_CString(hIn,"bank_code",&csTmp)) {
				strcat((char*)outMsg,"pg_BankCode");
				strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
				strcat((char*)outMsg,csTmp);
				strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: pg_BankCode = [%s]\n",csTmp));
			}
			else {
				iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** bank_code is missing\n"));
			}
		}

// pi_Url (same as p8_Url)
		if (GetField_CString(hIn,"return_url_only",&csTmp)) {
			strcat((char*)outMsg,"pi_Url");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: pi_Url = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** return_url_only is missing\n"));
		}

// pg_OrderDate
		if (GetField_CString(hIn,"local_tm_date",&csTmp)) {
			char *csTmp2 = NULL;
			char csDateTime[PD_DATETIME_LEN * 2];
			if (GetField_CString(hIn,"local_tm_time",&csTmp2)) {
				sprintf(csDateTime,"%s%s",csTmp,csTmp2);
				strcat((char*)outMsg,"pg_OrderDate");
				strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
				strcat((char*)outMsg,csDateTime);
				strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: pg_OrderDate = [%s]\n",csDateTime));
			}
			else {
				iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** local_tm_time is missing\n"));
			}
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** local_tm_date is missing\n"));
		}

// pk_ExpireTime
		if (GetField_CString(hIn,"psp_key_id",&csTmp)) {
			strcat((char*)outMsg,"pk_ExpireTime");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: pk_ExpireTime = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: *** psp_key_id is missing\n"));
		}

// hmac
		if (GetField_CString(hIn,"sign",&csTmp)) {
			strcat((char*)outMsg,"hmac");
			strcat((char*)outMsg,MY_XDB_FIELD_TOKEN);
			strcat((char*)outMsg,csTmp);
			strcat((char*)outMsg,MY_XDB_TOKEN);
DEBUGLOG(("FormatMsg:: hmac = [%s]\n",csTmp));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: ***sign is missing\n"));
		}

// url_method
		if (GetField_CString(hIn,"url_method",&csMethod)) {
DEBUGLOG(("FormatMsg:: url_method = [%s]\n",csMethod));
		}
		else 
			csMethod = strdup("");

DEBUGLOG(("FormatMsg:: outmsg = [%s]\n",outMsg));
		base64_encode(outMsg,strlen((char *)outMsg),csBuf,PD_MAX_BUFFER);
DEBUGLOG(("FormatMsg:: after encode\n"));
                outMsg[0] = '\0';
                strcat((char*)outMsg,"redirect_url");
                strcat((char*)outMsg,"=");
                strcat((char*)outMsg,csBuf);
                strcat((char*)outMsg,MY_XDB_TOKEN);
		strcat((char*)outMsg,"url_method");
		strcat((char*)outMsg,"=");
		strcat((char*)outMsg,csMethod);
                strcat((char*)outMsg,MY_XDB_TOKEN);
		strcat((char*)outMsg,"ret_status=0");
DEBUGLOG(("FormatMsg:: outMsg = [%s]\n",outMsg));

		*outLen = strlen((const char*)outMsg);
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("FormatMsg:: Redirct url not found\n"));
	}


DEBUGLOG(("FormatMsg:: normal exit iret =[%d]\n",iRet));
	FREE_ME(csBuf);
	return 	iRet;
}

int BreakDownMsg(hash_t *hOut,const unsigned char *inMsg,int inLen)
{
	int	iRet = PD_OK;
	char	*csPtr;
	hash_t  *hRec;

	hRec = (hash_t*)  malloc (sizeof(hash_t));
	hash_init(hRec,0);

DEBUGLOG(("BreakDownMsg()\n"));
DEBUGLOG(("DATA = [%s][%d]\n",inMsg,inLen));

	if (Str2Cls(hRec,(char *)inMsg,MY_XDB_TOKEN, MY_XDB_FIELD_TOKEN) == PD_OK) {
/* p1_MerId */
		if (GetField_CString(hRec,"p1_MerId",&csPtr)) {
			PutField_CString(hOut,"psp_merchant_id",csPtr);
DEBUGLOG(("BreakDownMsg:: p1_MerId:psp_merchant_id = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: p1_MerId:psp_merchant_id not found\n"));
		}

/* r0_Cmd */
		if (GetField_CString(hRec,"r0_Cmd",&csPtr)) {
			PutField_CString(hOut,"r0_Cmd",csPtr);
DEBUGLOG(("BreakDownMsg:: r0_Cmd:r0_Cmd = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r0_Cmd:r0_Cmd not found\n"));
		}

/* r1_Code */
		if (GetField_CString(hRec,"r1_Code",&csPtr)) {
			PutField_CString(hOut,"status",csPtr);
DEBUGLOG(("BreakDownMsg:: r1_Code:status = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r1_Code:status not found\n"));
		}

/* r2_TrxId */
		if (GetField_CString(hRec,"r2_TrxId",&csPtr)) {
			PutField_CString(hOut,"tid",csPtr);
DEBUGLOG(("BreakDownMsg:: r2_TrxId:tid = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r2_TrxId:tid not found\n"));
		}

/* r3_Amt */
		if (GetField_CString(hRec,"r3_Amt",&csPtr)) {
			PutField_CString(hOut,"psp_txn_amt",csPtr);
			PutField_CString(hOut,"txn_amt",csPtr);
DEBUGLOG(("BreakDownMsg:: r3_Amt:txn_amt = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r3_Amt:txn_amt not found\n"));
		}

/* r4_Cur */
		if (GetField_CString(hRec,"r4_Cur",&csPtr)) {
			PutField_CString(hOut,"psp_txn_ccy",csPtr);
DEBUGLOG(("BreakDownMsg:: r4_Cur:txn_ccy = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r4_Cur:txn_ccy not found\n"));
		}

/* r5_Pid */
		if (GetField_CString(hRec,"r5_Pid",&csPtr)) {
			PutField_CString(hOut,"r5_Pid",csPtr);
DEBUGLOG(("BreakDownMsg:: r5_Pid:r5_Pid = [%s]\n",csPtr));
		}

/* r6_Order */
		if (GetField_CString(hRec,"r6_Order",&csPtr)) {
			PutField_CString(hOut,"txn_seq",csPtr);
DEBUGLOG(("BreakDownMsg:: r6_Order:txn_seq = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r6_Order:txn_seq not found\n"));
		}

/* r8_MP */
		if (GetField_CString(hRec,"r8_MP",&csPtr)) {
			PutField_CString(hOut,"r8_MP",csPtr);
DEBUGLOG(("BreakDownMsg:: r8_MP:r8_MP = [%s]\n",csPtr));
		}

/* r9_BType */
		if (GetField_CString(hRec,"r9_BType",&csPtr)) {
			PutField_CString(hOut,"r9_BType",csPtr);
DEBUGLOG(("BreakDownMsg:: r9_BType:r9_BType = [%s]\n",csPtr));
		}
		else{
DEBUGLOG(("BreakDownMsg:: r9_BType:r9_BType not found\n"));
		}

/* ro_BankOrderId */
		if (GetField_CString(hRec,"ro_BankOrderId",&csPtr)) {
			PutField_CString(hOut,"bank_bill_no",csPtr);
DEBUGLOG(("BreakDownMsg:: ro_BankOrderId:bank_bill_no = [%s]\n",csPtr));
		}

/* rp_PayDate */
		if (GetField_CString(hRec,"rp_PayDate",&csPtr)) {
			PutField_CString(hOut,"fundin_date",csPtr);
			PutField_CString(hOut,"txn_date",csPtr);
DEBUGLOG(("BreakDownMsg:: rp_PayDate:fundin_date = [%s]\n",csPtr));
		}

/* hmac */
		if (GetField_CString(hRec,"hmac",&csPtr)) {
			PutField_CString(hOut,"sign",csPtr);
DEBUGLOG(("BreakDownMsg:: hmac:sign = [%s]\n",csPtr));
		}
		else{
			PutField_CString(hOut,"sign"," ");
DEBUGLOG(("BreakDownMsg:: hmac:sign = [%s]\n"," "));
		}
	}
	else {
DEBUGLOG(("BreakDownMsg() Error\n"));
		iRet = PD_ERR;
	}

	hash_destroy(hRec);
	FREE_ME(hRec);

DEBUGLOG(("BreakDownMsg Exit\n"));
	return	iRet;
}

int initReplyFromRequest(const hash_t* hRequest, hash_t* hResponse)
{
	int	iRet = PD_OK;

	return iRet;
}

int BuildAuthData(hash_t* hIn)
{
        int     iRet = PD_OK;
        char*   csPtr;
        char*   csBuf;
	double	dTmp;
	int	iOpt = PD_TRUE;
	int	iIsVnet = PD_FALSE;
        csBuf = (char*) malloc (MAX_MSG_SIZE + 1 );

DEBUGLOG(("BuildAuthData()\n"));
	memset(csBuf,0,MAX_MSG_SIZE);
	csBuf[0] = '\0';

/* p0_Cmd */
	strcat((char*)csBuf,PD_P0_CMD);
DEBUGLOG(("BuildAuthData:: p0_Cmd = [%s]\n", PD_P0_CMD));

/* p1_MerId */
	if (GetField_CString(hIn,"psp_merchant_id",&csPtr)) {
		strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: p1_MerId = [%s]\n",csPtr));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***psp_merchant_id is missing\n"));
	}

/* p2_Order */
	if (GetField_CString(hIn,"txn_seq",&csPtr)) {
		strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: p2_Order = [%s]\n",csPtr));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***txn_seq is missing\n"));
	}

/* p3_Cur */
	strcat((char*)csBuf,PD_CCY_ISO_CNY);
DEBUGLOG(("BuildAuthData:: p3_Cur = [%s]\n", PD_CCY_ISO_CNY));

/* p4_Amt */
	if (GetField_Double(hIn,"psp_txn_amt",&dTmp)) {
		char csTmpAmt[PD_TMP_BUF_LEN +1];
		sprintf(csTmpAmt,"%.2f",dTmp);
		strcat((char*)csBuf,csTmpAmt);
DEBUGLOG(("BuildAuthData:: p4_Amt = [%s]\n",csTmpAmt));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***psp_txn_amt is missing\n"));
	}

/* p8_Url */
	if (GetField_CString(hIn,"return_url_only",&csPtr)) {
		strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: p8_Url = [%s]\n",csPtr));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***return_url_only is missing\n"));
	}

/* pa_FrpId */
	if (GetField_CString(hIn,"bank_code",&csPtr)) {
		DBObjPtr = CreateObj(DBPtr,"DBMobBankMap","IsMobileOption");
		iOpt = (unsigned long)(*DBObjPtr)(csPtr);
		if(iOpt==PD_FALSE && iOpt!=INT_ERR){
			strcat((char*)csBuf,PD_PA_FRPID_VNET);
DEBUGLOG(("BuildAuthData:: pa_FrpId = [%s]\n",PD_PA_FRPID_VNET));
			iIsVnet = PD_TRUE;
		} else if(iOpt && iOpt!=INT_ERR){
			strcat((char*)csBuf,PD_PA_FRPID_EC);
DEBUGLOG(("BuildAuthData:: pa_FrpId = [%s]\n",PD_PA_FRPID_EC));
		}
	}

/* pg_BankCode */
	if (iIsVnet) {
		if (GetField_CString(hIn,"bank_code",&csPtr)) {
			strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: pg_BankCode = [%s]\n",csPtr));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***bank_code is missing\n"));
		}
	}

/* pi_Url (same as p8_Url)*/
	if (GetField_CString(hIn,"return_url_only",&csPtr)) {
		strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: pi_Url = [%s]\n",csPtr));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***return_url_only is missing\n"));
	}

/* pg_OrderDate */
	if (GetField_CString(hIn,"local_tm_date",&csPtr)) {
		char *csPtr2 = NULL;
		char csDateTime[PD_DATETIME_LEN * 2];
		if (GetField_CString(hIn,"local_tm_time",&csPtr2)) {
			sprintf(csDateTime,"%s%s",csPtr,csPtr2);
			strcat((char*)csBuf,csDateTime);
DEBUGLOG(("BuildAuthData:: pg_OrderDate = [%s]\n",csDateTime));
		}
		else {
			iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***local_tm_time is missing\n"));
		}
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***local_tm_date is missing\n"));
	}

/* pk_ExpireTime */
	if (GetField_CString(hIn,"psp_key_id",&csPtr)) {
		strcat((char*)csBuf,csPtr);
DEBUGLOG(("BuildAuthData:: pk_ExpireTime = [%s]\n",csPtr));
	}
	else {
		iRet = PD_ERR;
DEBUGLOG(("BuildAuthData:: ***psp_key_id is missing\n"));
	}

	PutField_CString(hIn,"auth_data",csBuf);
DEBUGLOG(("BuildAuthData:: auth_data = [%s]\n",csBuf));
	FREE_ME(csBuf);
        
DEBUGLOG(("BuildAuthData() Exit iRet = [%d]\n",iRet));
        return  iRet;
}

int BuildRspAuthData(hash_t* hIn)
{
        int     iRet = PD_OK;
        char*   csPtr;
        char*   csBuf;
        csBuf = (char*) malloc (MAX_MSG_SIZE + 1 );

DEBUGLOG(("BuildRspAuthData()\n"));
	memset(csBuf,0,MAX_MSG_SIZE);
	csBuf[0] = '\0';

// p1_MerId
	if (GetField_CString(hIn,"psp_merchant_id",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: p1_MerId:psp_merchant_id = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r0_Cmd
	if (GetField_CString(hIn,"r0_Cmd",&csPtr)) {
DEBUGLOG(("BuildRspeqData:: r0_Cmd:r0_Cmd = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r1_Code
	if (GetField_CString(hIn,"status",&csPtr)) {
DEBUGLOG(("BuildRspeqData:: r1_Code:status = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r2_TrxId
	if (GetField_CString(hIn,"tid",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r2_TrxId:tid = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r3_Amt
	if (GetField_CString(hIn,"psp_txn_amt",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r3_Amt:psp_txn_amt = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r4_Cur
	if (GetField_CString(hIn,"psp_txn_ccy",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r4_Cur:psp_txn_ccy = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r5_Pid
	if (GetField_CString(hIn,"r5_Pid",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r5_Pid:r5_Pid = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r6_Order
	if (GetField_CString(hIn,"txn_seq",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r6_Order:txn_seq = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r8_MP
	if (GetField_CString(hIn,"r8_MP",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r8_MP:r8_MP = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// r9_BType
	if (GetField_CString(hIn,"r9_BType",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: r9_BType:r9_BType = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// ro_BankOrderId
	if (GetField_CString(hIn,"bank_bill_no",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: ro_BankOrderId:bank_bill_no = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

// rp_PayDate
	if (GetField_CString(hIn,"fundin_date",&csPtr)) {
DEBUGLOG(("BuildRspAuthData:: rp_PayDate:fundin_date = [%s]\n",csPtr));
		strcat((char*)csBuf,csPtr);
	}

	PutField_CString(hIn,"auth_data",csBuf);
DEBUGLOG(("BuildRspAuthData:: auth_data = [%s]\n",csBuf));
	FREE_ME(csBuf);
        
DEBUGLOG(("BuildRspAuthData() Exit iRet = [%d]\n",iRet));
        return  iRet;
}

