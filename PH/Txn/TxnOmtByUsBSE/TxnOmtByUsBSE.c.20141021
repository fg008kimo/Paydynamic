/*
Partnerdelight (c)2010. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2014/09/22              Elvis Wong
*/

#define       PD_DETAIL_TAG   "dt"

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "internal.h"
#include "TxnOmtByUsBSE.h"
#include "myrecordset.h"

char cDebug;
OBJPTR(DB);
OBJPTR(BO);
OBJPTR(Txn);

void TxnOmtByUsBSE(char cdebug)
{
	cDebug = cdebug;
}

int GetTagName(int iHeader, char *csTagName)
{
	int	iRet = PD_OK;

	if (iHeader == 1) {
/* statement_date */
		sprintf(csTagName, "statement_date");	
	} else if (iHeader == 2) {	
/* statement_time */
		sprintf(csTagName, "statement_time");	
	} else if (iHeader == 3) {   
/* tfr_bank_name */
                sprintf(csTagName, "tfr_bank_name");
        } else if (iHeader == 4) {   
/* tfr_bank_acct_num */
                sprintf(csTagName, "tfr_bank_acct_num");
        } else if (iHeader == 5) {   
/* tfr_type */
                sprintf(csTagName, "tfr_type");
        } else if (iHeader == 6) {   
/* tfr_channel */
                sprintf(csTagName, "tfr_channel");
        } else if (iHeader == 7) {   
/* tfr_text */
                sprintf(csTagName, "tfr_text");
        } else if (iHeader == 8) {   
/* tfr_customer_text */
                sprintf(csTagName, "tfr_customer_text");
        } else if (iHeader == 9) {   
/* tfr_sender_name */
                sprintf(csTagName, "tfr_sender_name");
        } else if (iHeader == 10) {   
/* txn_ref_num */
                sprintf(csTagName, "txn_ref_num");
        } else if (iHeader == 11) {  
/* balance */
                sprintf(csTagName, "balance"); 
        } else if (iHeader == 12) {  
/* amt_type */
                sprintf(csTagName, "amt_type"); 
        } else if (iHeader == 13) {   
/* txn_amount */
                sprintf(csTagName, "txn_amount");
        } else if (iHeader == 14) {   
/* bank_charge */
                sprintf(csTagName, "bank_charge");
        } else if (iHeader == 15) {   
/* mask_skip */
                sprintf(csTagName, "mask_skip");
        } else {
		sprintf(csTagName, "%s", "\0");
   	}
DEBUGLOG(("GetTagName() iHeader = [%d], csTagName = [%s]\n",iHeader,csTagName));
	
	return iRet;
}

int Authorize(hash_t* hContext,
		hash_t* hRequest,
		hash_t* hResponse)
{
	int	iRet = PD_OK;
	//int     iDtlRet = PD_OK;	

	char	cAction;
	char	*csUser = NULL;
	char    *csFileId = NULL;

	char	*csCreateUser = NULL;
	char	*csCreateTimestamp = NULL;

	int	iHeaderVer = 0;
	int	iSkipCount = 0;
	int	iHoldCount = 0;
	int	iAcceptCount = 0;
	int	iTotalCount = 0;
	int	iSplitCount = 0;
	int	iAddCount = 0;
	int	iUpdateCount = 0;
	int	iDeleteCount = 0;
	int	iFileCount = 0;

	int	iSeq = 0;
	int	iVer = 0;
	int	iLastVer = 0;
	int	iLatestVer = 0;
	int	iOrgSysSeq = 0;
	//int	iSysSeq = 0;
	int	iUserSeq = 0;	
	int	iDisabled = 0;
	int     iSkip = 0;
        int     iMaskSkip = 0;

	char 	*csIntBankCode = NULL;
	char 	*csBankAcctNum = NULL;
	char 	*csRawDate = NULL;
	char 	*csRawTime = NULL;
	char 	*csStatementDate = NULL;
	char 	*csStatementTime = NULL;
	char 	*csTfrBankName = NULL;
	char 	*csTfrBankAcctNum = NULL;
	char 	*csTfrType = NULL;
	char 	*csTfrChannel = NULL;
	char 	*csTfrText = NULL;
	char 	*csTfrCustomerText = NULL;
	char 	*csTfrSenderName = NULL;
	char 	*csTxnRefNum = NULL;
	char 	*csBalance = NULL;
	char 	*csAmtType = NULL;
	char 	*csTxnAmount = NULL;
	char 	*csBankCharge = NULL;

	char	*csTmp;
	double	dTmp;
	int	iTmp;

	char	csTag[PD_TAG_LEN + 1];
	char	csTagName[PD_TAG_LEN + 1];
	
	int	i = 0;
	int	j = 0;
	int	k = 0;
	int	iCnt = 0;
	int	iOrderCnt = 0;
	int 	iIdx = 0;

	char	*csOrderSeq = NULL;
	char	*csOrderVer = NULL;

	char    *csData;
	char	*csDataCode;
	int	iDataCodeLen = 0;

	char    *csSubData;
	char	*csSubDataCode;
	int	iSubDataCodeLen = 0;
	
	char    *csKey;
	char	*csKeyCode;
	int	iKeyCodeLen = 0;
	
	hash_t *hRecTemp = (hash_t*) malloc (sizeof(hash_t));
	hash_t *hRecOrderAdd = (hash_t*) malloc (sizeof(hash_t));

	hash_t *hRec = (hash_t*) malloc (sizeof(hash_t));

	hash_t *hRecHeaderGet = (hash_t*) malloc (sizeof(hash_t));
	hash_t *hRecHeaderPut = (hash_t*) malloc (sizeof(hash_t));
	hash_t *hRecDetailGet = (hash_t*) malloc (sizeof(hash_t));
	hash_t *hRecDetailPut = (hash_t*) malloc (sizeof(hash_t));

	hash_t *hRecOrderGet = (hash_t*) malloc (sizeof(hash_t));
	hash_t *hRecOrderPut = (hash_t*) malloc (sizeof(hash_t));
	
	csData = (char*) malloc (4096);
	csDataCode = (char*) malloc (4096);

	csSubData = (char*) malloc (4096);
	csSubDataCode = (char*) malloc (4096);
	
	csKey = (char*) malloc (4096);
	csKeyCode = (char*) malloc (4096);

	hash_init(hRecTemp,0);
	hash_init(hRecOrderAdd,0);

/*----------------------------------------------------------------Get Data From hRequest----------------------------------------------------------------*/

/* user */
        if (GetField_CString(hRequest, "add_user", &csUser)) {
                PutField_CString(hRecTemp,"add_user",csUser);
                PutField_CString(hContext,"create_user",csUser);
                PutField_CString(hContext,"update_user",csUser);
DEBUGLOG(("Authorize() user = [%s]\n", csUser));
        } else {
                iRet = INT_USER_NOT_FOUND;
                PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() user NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() user NOT FOUND!!!\n");
        }

/* total_cnt */
        if (GetField_CString(hRequest, "cnt", &csTmp)) {
DEBUGLOG(("Authorize() total_cnt = [%s]\n", csTmp));
                iCnt = atoi(csTmp);
        } else {
                iRet = INT_ERR;
DEBUGLOG(("Authorize() total_cnt NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() total_cnt NOT FOUND!!!\n");
        }	

	if (iRet == PD_OK) {
                for (i = 0; i < iCnt; i++) {
DEBUGLOG(("Authorize() hRecTemp::cnt = [%d]\n", i));

/*------------------------------------------------------Get Data String------------------------------------------------------*/
			sprintf(csTag, "%s_i_%d", PD_DETAIL_TAG, i+1);
                        if (GetField_CString(hRequest, csTag, &csData)) {
DEBUGLOG(("Authorize() hRecTemp::data = [%s]\n", csData));

				iDataCodeLen = 0;
	
/* action */
				sprintf(csDataCode,"%s",&csData[iDataCodeLen]);
                                if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					iDataCodeLen++;

                                        sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_action_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                } else {
                                        strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
                                        iDataCodeLen += (strlen(csDataCode) + 1);
					
					sprintf(csTag, "%s_action_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
					
					cAction = csDataCode[0];
                                }
DEBUGLOG(("Authorize() hRecTemp::action = [%s]\n",csDataCode));

/* key (file_id_seq_ver) */
                                sprintf(csDataCode,"%s",&csData[iDataCodeLen]);
                                if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::key = NULL\n"));
                                } else {
                                        strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					iDataCodeLen += (strlen(csDataCode) + 1);
					
					sprintf(csTag, "%s_key_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
DEBUGLOG(("Authorize() hRecTemp::key = [%s]\n",csDataCode));

/*------------------------------------------------------Get Key String------------------------------------------------------*/
                                        sprintf(csKey,"%s",csDataCode);
                                        iKeyCodeLen = 0;

/* file_id */
                                        sprintf(csKeyCode,"%s",csKey);
                                        if (csKeyCode[0] == PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL_CHECK)
                                        {
                                                iRet = INT_FILE_ID_NOT_FOUND;
                                                PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() hRecTemp::key::file_id not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() hRecTemp() file_id not found!!\n");
                                        } else {
                                                strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);
                                                iKeyCodeLen += (strlen(csKeyCode) + 1);
						
						sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, i+1);
                                                PutField_CString(hRecTemp,csTag,csKeyCode);
DEBUGLOG(("Authorize() hRecTemp::key::file_id = [%s]\n",csKeyCode));
                                        }

/* seq */
                                        sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
                                        if (csKeyCode[0] == PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL_CHECK)
                                        {
                                                iRet = INT_STATEMENT_SEQ_NOT_FOUND;
                                                PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() hRecTemp::key::seq not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() hRecTemp() seq not found!!\n");
                                        } else {
                                                strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);
						iKeyCodeLen += (strlen(csKeyCode) + 1);
		
                                                sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, i+1);
                                                PutField_CString(hRecTemp,csTag,csKeyCode);
DEBUGLOG(("Authorize() hRecTemp::key::seq = [%s]\n",csKeyCode));
                                        }

/* ver */
                                        sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
                                        if (iKeyCodeLen >= strlen(csKey))
                                        {
                                                iRet = INT_STATEMENT_VER_NOT_FOUND;
                                                PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() hRecTemp::key::ver not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() hRecTemp() ver not found!!\n");
                                        } else {
                                                sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, i+1);
                                                PutField_CString(hRecTemp,csTag,csKeyCode);
DEBUGLOG(("Authorize() hRecTemp::key::ver = [%s]\n",csKeyCode));
                                        }
                                }

/* sub_data */
				sprintf(csDataCode,"%s",&csData[iDataCodeLen]);
				if (iDataCodeLen < strlen(csData)) {	

/*------------------------------------------------------Get Sub Data String------------------------------------------------------*/
					if (cAction == PD_ACTION_ADD) {

						iIdx = 0;

                                                sprintf(csSubData,"%s",csDataCode);
                                                iSubDataCodeLen = 0;
DEBUGLOG(("Authorize() hRecTemp::sub_data = [%s]\n",csSubData));

                                                do {

							iIdx++;

                                                        sprintf(csSubDataCode,"%s",&csSubData[iSubDataCodeLen]);
							if (csSubDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK) {
								iSubDataCodeLen++;
								
								sprintf(csSubDataCode,"%s","\0");
                                                                GetTagName(iIdx,csTagName);
                                                                sprintf(csTag, "%s_%s_%d", PD_DETAIL_TAG, csTagName, i+1);
                                                                PutField_CString(hRecTemp,csTag,csSubDataCode);
							} else {
                                                        	strtok(csSubDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
								iSubDataCodeLen += (strlen(csSubDataCode) + 1);

                                                        	GetTagName(iIdx,csTagName);
                                                        	sprintf(csTag, "%s_%s_%d", PD_DETAIL_TAG, csTagName, i+1);
                                                        	PutField_CString(hRecTemp,csTag,csSubDataCode);
							}
DEBUGLOG(("Authorize() hRecTemp::%s = [%s]\n",csTagName,csSubDataCode));

                                                } while (iSubDataCodeLen < strlen(csSubData));

					} else if (cAction == PD_ACTION_UPDATE) {
				
						iIdx = 0;
	
						sprintf(csSubData,"%s",csDataCode);
                                	        iSubDataCodeLen = 0;	
DEBUGLOG(("Authorize() hRecTemp::sub_data = [%s]\n",csSubData));
					
						do {

							sprintf(csSubDataCode,"%s",&csSubData[iSubDataCodeLen]);
							if (csSubDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK) {
								iSubDataCodeLen++;

								sprintf(csSubDataCode,"%s","\0");
							} else {
								strtok(csSubDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
								iSubDataCodeLen += (strlen(csSubDataCode) + 1);							

/*--------------------------------------------Get Sub Data Key String--------------------------------------------*/
								sprintf(csKey,"%s",csSubDataCode);	
                                                		iKeyCodeLen = 0;
	
								sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
								if (csKeyCode[0] == PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL_CHECK)
								{
									iKeyCodeLen++;

									sprintf(csKeyCode,"%s","\0");
								} else {
									strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);
									iKeyCodeLen += (strlen(csKeyCode) + 1);
	
									iTmp = atoi(csKeyCode);	
									GetTagName(iTmp,csTagName);
									sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
									sprintf(csTag, "%s_%s_%d", PD_DETAIL_TAG, csTagName, i+1);
                                        				PutField_CString(hRecTemp,csTag,csKeyCode);		
								}
DEBUGLOG(("Authorize() hRecTemp::%s = [%s]\n",csTagName,csKeyCode));
							}
						} while (iSubDataCodeLen < strlen(csSubData));				
					}	
				}
			}
		}
	}

/* order */
	if (iRet == PD_OK) {
        	if (GetField_CString(hRequest, "order", &csData)) {
DEBUGLOG(("Authorize() hRecTemp::order = [%s]\n", csData));

			iIdx = 0;
               		iDataCodeLen = 0;

			do {

				iIdx++;

                        	sprintf(csDataCode,"%s",&csData[iDataCodeLen]);
                           	if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK) {
                                	iDataCodeLen++;

                                      	sprintf(csDataCode,"%s","\0");
                            	} else {
                                   	strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
                               		iDataCodeLen += (strlen(csDataCode) + 1);
					
					sprintf(csTag, "order_%d", iIdx);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
DEBUGLOG(("Authorize() hRecTemp::order_%d = [%s]\n", iIdx,csDataCode));

                                       	sprintf(csKey,"%s",csDataCode);
                                       	iKeyCodeLen = 0;

/* order_file_id */
                                      	sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
                                    	if (csKeyCode[0] == PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL_CHECK)
                                     	{
                                     		iKeyCodeLen++;

                                            	sprintf(csKeyCode,"%s","\0");
                                    	} else {
                                          	strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);
                                            	iKeyCodeLen += (strlen(csKeyCode) + 1);

                                               	sprintf(csTag, "order_file_id_%d", iIdx);
                                               	PutField_CString(hRecTemp,csTag,csKeyCode);
                                    	}
DEBUGLOG(("Authorize() hRecTemp::%s = [%s]\n",csTag,csKeyCode));

/* order_seq */
					sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
                                        if (csKeyCode[0] == PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL_CHECK)
                                        {
                                                iKeyCodeLen++;

                                                sprintf(csKeyCode,"%s","\0");
                                        } else {
                                                strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);
                                                iKeyCodeLen += (strlen(csKeyCode) + 1);

                                                sprintf(csTag, "order_seq_%d", iIdx);
                                                PutField_CString(hRecTemp,csTag,csKeyCode);
                                        }
DEBUGLOG(("Authorize() hRecTemp::%s = [%s]\n",csTag,csKeyCode));

/* order_ver */		
					sprintf(csKeyCode,"%s",&csKey[iKeyCodeLen]);
					if (iKeyCodeLen < strlen(csKey)) {
                                                strtok(csKeyCode,PD_BANK_STATEMENT_KEY_DELIMIT_SYMBOL);

                                                sprintf(csTag, "order_ver_%d", iIdx);
                                                PutField_CString(hRecTemp,csTag,csKeyCode);
                                        }
DEBUGLOG(("Authorize() hRecTemp::%s = [%s]\n",csTag,csKeyCode));

/* order_user_seq */
                                      	sprintf(csTag, "order_user_seq_%d", iIdx);
                                    	PutField_Int(hRecTemp,csTag,iIdx);
DEBUGLOG(("Authorize() hRecTemp::%s = [%d]\n",csTag,iIdx));

                             	}

                	} while (iDataCodeLen < strlen(csData));

			iOrderCnt = iIdx;
DEBUGLOG(("Authorize() hRecTemp::order_cnt = [%d]\n",iOrderCnt));
       	 	} else {
DEBUGLOG(("Authorize() order NOT FOUND!!!\n"));
        	}
	}

#if 0
	if (iRet != PD_OK) {
                PutField_Int(hContext, "internal_error", iRet);
        }

	FREE_ME(csData);
        FREE_ME(csDataCode);
        FREE_ME(csSubData);
        FREE_ME(csSubDataCode);
        FREE_ME(csKey);
        FREE_ME(csKeyCode);

        FREE_ME(hRecTemp);
        FREE_ME(hRecOrderAdd);
	
        FREE_ME(hRec);
	
        //FREE_ME(hRecHeaderGet);
        //FREE_ME(hRecHeaderPut);
        //FREE_ME(hRecDetailGet);
        //FREE_ME(hRecDetailPut);
	//FREE_ME(hRecOrderGet);
        //FREE_ME(hRecOrderPut);

DEBUGLOG(("Authorize() Normal Exit! iRet = [%d]\n", iRet));
        return iRet;
#endif

/*----------------------------------------------------------------Get Data From hRecTemp----------------------------------------------------------------*/

	if (iRet == PD_OK) {
                for (j = 0; j < iCnt; j++) {
DEBUGLOG(("Authorize() cnt = [%d]\n", j));

			hash_init(hRec,0);
			hash_init(hRecHeaderGet,0);
			hash_init(hRecHeaderPut,0);
			hash_init(hRecDetailGet,0);
			hash_init(hRecDetailPut,0);

/* user */
        		if (GetField_CString(hRecTemp, "add_user", &csUser)) {
                		PutField_CString(hRec,"create_user",csUser);
                		PutField_CString(hRec,"update_user",csUser);
DEBUGLOG(("Authorize() user = [%s]\n", csUser));
        		} else {
                		iRet = INT_USER_NOT_FOUND;
                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() user NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() user NOT FOUND!!!\n");
        		}

/* action */
			sprintf(csTag, "%s_action_%d", PD_DETAIL_TAG, j+1);
			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
				cAction = csTmp[0];
				PutField_Char(hRec,"action",cAction);
				PutField_Char(hContext,"action",cAction);
DEBUGLOG(("Authorize() action = [%c]\n", cAction));
			} else {
                		iRet = INT_ACTION_NOT_FOUND;
                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() action not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() action not found!!\n");
        		}

/* file_id */
			sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, j+1);
			if (GetField_CString(hRecTemp, csTag, &csFileId)) {
				PutField_CString(hRec,"file_id",csFileId);
				PutField_CString(hContext,"file_id",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n", csFileId));
			} else {
              			iRet = INT_FILE_ID_NOT_FOUND;
                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() file_id not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() file_id not found!!\n");
        		}
		
			if ((iRet == PD_OK) && (cAction == PD_ACTION_ADD)) {	

/*------------------------------------------------------Add Record------------------------------------------------------*/
DEBUGLOG(("Authorize() AddRecord()\n"));

DEBUGLOG(("Authorize() CheckFileIdExist()\n"));

				snprintf(csTag,sizeof(csTag),"%s",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n",csTag));

                		//DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist");
				//if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {
				{

/*-----------------------------------Add Record::File Exist-----------------------------------*/
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));

/*---------------Get Statement Tmp (Laat Seq Record) Detail---------------*/
					DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastSeqRecDetail");
                			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::iRet = [%d]\n",iRet));

                			if (iRet == PD_OK) {		

/* seq */
						if (GetField_Int(hRecDetailGet,"seq",&iSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::seq = [%d]\n",iSeq));
        	                		}

#if 0
/* org_sys_seq */
						if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
                        			}
#endif

#if 0
/* sys_seq */
						if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::sys_seq = [%d]\n",iSysSeq));
                        			}
#endif

#if 0
/* user_seq */
						if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::user_seq = [%d]\n",iUserSeq));
                        			}
#endif

/* int_bank_code */
                                             	if (GetField_CString(hRecDetailGet,"int_bank_code",&csIntBankCode)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::int_bank_code = [%s]\n",csIntBankCode));
                                                      	PutField_CString(hRec, "int_bank_code",csIntBankCode);
                                              	}

/* bank_acct_num */
                                               	if (GetField_CString(hRecDetailGet,"bank_acct_num",&csBankAcctNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::bank_acct_num = [%s]\n",csBankAcctNum));
                                               		PutField_CString(hRec, "bank_acct_num",csBankAcctNum);
                                       		}

					} else {
						iRet = INT_ERR;
DEBUGLOG(("Authorize:: call DBOLStatementTmp(GetLastSeqRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() DBOLStatementTmp:: GetLastSeqRecDetail() failed!!\n");
					}


/*---------------Add Statement Tmp Detail---------------*/
					if (iRet == PD_OK) {

/* file_id */
						PutField_CString(hRec,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
#if 0
						sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n", iSeq));
                                        		PutField_Int(hRec, "seq",iSeq);
                                		}
#else
						iSeq++;												
						PutField_Int(hRec, "seq",iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n", iSeq));
#endif

/* ver */
#if 0
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
						if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                         	       			iVer = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n", iVer));
                                			PutField_Int(hRec, "ver",iVer);
                        			}
#else
						iVer = 0;
						PutField_Int(hRec, "ver",iVer);		
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));
#endif

#if 0
/* latest_ver */
						iLatestVer = 0;
						PutField_Int(hRec, "latest_ver",iLatestVer);		
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif

/* org_sys_seq */
						iOrgSysSeq = iSeq;
						//PutField_Int(hRec, "org_sys_seq",++iOrgSysSeq);
						PutField_Int(hRec, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));

#if 0		
/* sys_seq */
						iSysSeq = iSeq;
						//PutField_Int(hRec, "sys_seq",++iSysSeq);
						PutField_Int(hRec, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));
#endif

#if 0	
/* user_seq */
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                        		PutField_Int(hRec, "user_seq",iUserSeq);
                                		}

/*
						iUserSeq = iSeq;
						PutField_Int(hRec, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/
#endif

/* disabled */
						iDisabled = 0;
                                		PutField_Int(hRec, "disabled",iDisabled);
DEBUGLOG(("Authorize() AddDetail::disabled = [%d]\n",iDisabled));

/* skip */
/*
						sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iTmp));
                                        		PutField_Int(hRec, "skip",iTmp);
                                		}
*/

						iSkip = 0;
                                              	PutField_Int(hRec, "skip",iSkip);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iSkip));

/* mask_skip */
						sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n", iTmp));
                                        		PutField_Int(hRec, "mask_skip",iTmp);
                                		}

#if 0
/* int_bank_code */
						sprintf(csTag, "%s_int_bank_code_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"int_bank_code",csTmp);
                                		}

/* bank_acct_num */
						sprintf(csTag, "%s_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                 		               	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csTmp));
                                		        PutField_CString(hRec,"bank_acct_num",csTmp);
                                		}
#endif

/* raw_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"raw_date",csTmp);
                                		}

/* raw_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csTmp));
                                       	 		PutField_CString(hRec,"raw_time",csTmp);
						}

#if 0
/* statement_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_date = [%s]\n", csTmp));
                                       			PutField_CString(hRec,"statement_date",csTmp);
                                		}

/* statement_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"statement_time",csTmp);
                                		}
#endif

/* tfr_bank_name */
						sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_bank_name",csTmp);
                                		}

/* tfr_bank_acct_num */
						sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_bank_acct_num",csTmp);
                                		}

/* tfr_type */
						sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_type",csTmp);
                                		}

/* tfr_channel */
						sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_channel",csTmp);
                                		}

/* tft_text */
						sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_text = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_text",csTmp);
                                		}

/* tfr_customer_text */
						sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, j+1);
                   		             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n",csTmp));
                        		                PutField_CString(hRec,"tfr_customer_text",csTmp);
                                		}

/* tfr_sender_name */
						sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::sender_name = [%s]\n",csTmp));
                                        		PutField_CString(hRec,"sender_name",csTmp);
                                		}

/* txn_ref_num */
						sprintf(csTag, "%s_txn_ref_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n",csTmp));
                                        		PutField_CString(hRec,"txn_ref_num",csTmp);
                                		}

/* balance */
						sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::balance = [%.2f]\n",dTmp));
                                        		//PutField_Double(hRec,"balance",dTmp);
                                        		PutField_CString(hRec,"balance",csTmp);
                                		}

/* amt_type */
						sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n",csTmp));
                                		        PutField_CString(hRec,"amt_type",csTmp);
                                		}

/* txn_amount */
						sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%.2f]\n",dTmp));
							//PutField_Double(hRec,"txn_amount",dTmp);
							PutField_CString(hRec,"txn_amount",csTmp);
						}

/* bank_charge */
						sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%.2f]\n",dTmp));
							//PutField_Double(hRec,"bank_charge",dTmp);
                                        		PutField_CString(hRec,"bank_charge",csTmp);
                                		}

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                        			DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                        			iRet = (unsigned long)(*DBObjPtr)(hRec);
                        			if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
						}
					}
			
/*---------------Get Statement Tmp (First Seq Record) Detail---------------*/
                        		if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetFirstSeqRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::iRet = [%d]\n",iRet));

                               			 if (iRet == PD_OK) {

/* create_user */
                                        		if (GetField_CString(hRecDetailGet, "create_user", &csCreateUser)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::create_user = [%s]\n", csCreateUser));
                                        		}

/* create_timestamp */
                                        		if (GetField_CString(hRecDetailGet, "create_timestamp", &csCreateTimestamp)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::create_timestamp = [%s]\n", csCreateTimestamp));
                                        		}


                                		} else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetFirstSeqRecDetail() failed!!\n");
                                		}
                        		}

/*---------------Update Statement Tmp Detail---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::seq = [%d]\n",iSeq));

/* ver */
                                		PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::ver = [%d]\n",iVer));

/* create_user */
                                		PutField_CString(hRecDetailPut,"create_user",csCreateUser);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::create_user = [%s]\n",csCreateUser));

/* create_timestamp */
                                		PutField_CString(hRecDetailPut,"create_timestamp",csCreateTimestamp);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::create_timestamp = [%s]\n",csCreateTimestamp));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateUserTimestampDetail)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateUserTimestampDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateUserTimestampDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateUserTimestampDetail() FAILURE!!!\n");
                                		}

                        		}

/*---------------Add Order Detail---------------*/
                                        if (iRet == PD_OK) {

						sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                                                if (GetField_CString(hRecTemp, csTag, &csOrderSeq)) {
							//iOrderSeq = atoi(csTmp);														
DEBUGLOG(("Authorize() AddOrderDetail::order_seq = [%s]\n", csOrderSeq));
                                                }
						
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
                                                if (GetField_CString(hRecTemp, csTag, &csOrderVer)) {
							//iOrderVer = atoi(csTmp);
DEBUGLOG(("Authorize() AddOrderDetail::order_ver = [%s]\n", csOrderVer));
                                                }
	
						sprintf(csTag, "%s_%s_%s", csFileId, csOrderSeq, csOrderVer);
						sprintf(csTmp, "%s_%d_%d", csFileId, iSeq, iVer);
						PutField_CString(hRecOrderAdd,csTag,csTmp);  
DEBUGLOG(("Authorize() AddOrderDetail::%s = [%s]\n", csTag,csTmp));
	
						sprintf(csTag, "%s_%s_%s_file_id", csFileId, csOrderSeq, csOrderVer);
                                                sprintf(csTmp, "%s", csFileId);
						PutField_CString(hRecOrderAdd,csTag,csTmp);
DEBUGLOG(("Authorize() AddOrderDetail::%s = [%s]\n", csTag,csTmp));

						sprintf(csTag, "%s_%s_%s_seq", csFileId, csOrderSeq, csOrderVer);
						sprintf(csTmp, "%d", iSeq);
						PutField_CString(hRecOrderAdd,csTag,csTmp);
DEBUGLOG(("Authorize() AddOrderDetail::%s = [%s]\n", csTag,csTmp));

						sprintf(csTag, "%s_%s_%s_ver", csFileId, csOrderSeq, csOrderVer);
                                                sprintf(csTmp, "%d", iVer);
						PutField_CString(hRecOrderAdd,csTag,csTmp);
DEBUGLOG(("Authorize() AddOrderDetail::%s = [%s]\n", csTag,csTmp));

					}

#if 0
/*---------------Get Statement Header---------------*/
					if (iRet == PD_OK) {
						
                        			DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                        			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* skip_count */
                                			if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                			}

/* hold_count */
                                			if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                			}

/* accept_count */
                                			if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                			}

/* total_count */
                                			if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                			}

/* ver */
                                			if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                			}

/* split_count */
                                			if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                			}

/* add_count */
                                			if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                			}

/* update_count */
                                			if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetSHeader)::update_count = [%d]\n",iUpdateCount));
                                			}

/* delete_count */
                                			if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                			}

/* file_count */
                                			if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                			}

                        			} else {
                                			iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                        			}
					}

/*---------------Update Statement Header---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                                		PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));

/* hold_count */
                               	 		PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                                		PutField_Int(hRecHeaderPut, "accept_count",iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                                		PutField_Int(hRecHeaderPut, "total_count",iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer) {	
                                			PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iVer));
						} else {
                                			PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iHeaderVer));
						}

/* split_count */
                                		PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                                		PutField_Int(hRecHeaderPut, "add_count",++iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* updat_count */
                                		PutField_Int(hRecHeaderPut, "update_count",iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                                		PutField_Int(hRecHeaderPut, "delete_count",iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                                		PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                                		PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                                		}
                        		}
#else
/* ver */
					if (iVer > iHeaderVer) {
                                       		iHeaderVer = iVer;
                                   	}
DEBUGLOG(("Authorize() SaveHeader::header_ver = [%d]\n",iHeaderVer));

/* split_count */
DEBUGLOG(("Authorize() SaveHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                                        iAddCount++;
DEBUGLOG(("Authorize() SaveHeader::add_count = [%d]\n",iAddCount));

/* update_count */
DEBUGLOG(("Authorize() SaveHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
DEBUGLOG(("Authorize() SaveHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
					iFileCount = iSplitCount + iAddCount - iDeleteCount;
DEBUGLOG(("Authorize() SaveHeader::file_count = [%d]\n",iFileCount));
#endif
				}
				//} else {
/*-----------------------------------Add Record::File Not Exist-----------------------------------*/
					//iRet = INT_INVALID_FILE_ID; 
//DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
//ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: File Not Exist!!!\n");                         
				//}
			}
		
			else if ((iRet == PD_OK) && (cAction == PD_ACTION_UPDATE)) { 

/*------------------------------------------------------Update Record------------------------------------------------------*/
DEBUGLOG(("Authorize() UpdateRecord()\n"));

/*---------------Check File Exist---------------*/
DEBUGLOG(("Authorize() CheckFileIdExist()\n"));

				sprintf(csTag,"%s",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n",csTag));

                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist");
                		if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));
		
/*---------------Get Statement Tmp (Last Ver Record) Detail---------------*/

/* seq */
					sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() seq = [%d]\n", iSeq));
                                		PutField_Int(hRec,"seq",iSeq);
                                		PutField_Int(hContext,"seq",iSeq);
                        		} else {

                                		iRet = INT_STATEMENT_SEQ_NOT_FOUND;
                                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() seq not found!!\n");
                      			}

					if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastVerRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,iSeq,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::iRet = [%d]\n",iRet));
                                		if (iRet == PD_OK) {
/* disabled */
                                                        if (GetField_Int(hRecDetailGet,"disabled",&iDisabled)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::disabled = [%d]\n",iDisabled));
                                                        }

/* ver */
                                        		if (GetField_Int(hRecDetailGet,"ver",&iLastVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::ver = [%d]\n",iLastVer));
                                        		}

/* latest_ver */
                                        		if (GetField_Int(hRecDetailGet,"latest_ver",&iLatestVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::latest_ver = [%d]\n",iLatestVer));
                                        		}

/* org_sys_seq */
                                        		if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
                                        		}

#if 0
/* sys_seq */
                                        		if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::sys_seq = [%d]\n",iSysSeq));
                                        		}
#endif

#if 0
/* user_seq */
                                        		if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::user_seq = [%d]\n",iUserSeq));
                                        		}
#endif

/* skip */
                                                        if (GetField_Int(hRecDetailGet,"skip",&iSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::skip = [%d]\n",iSkip));
								PutField_Int(hRec, "skip",iSkip);
                                                        }

/* mask_skip */
                                                        if (GetField_Int(hRecDetailGet,"mask_skip",&iMaskSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::mask_skip = [%d]\n",iMaskSkip));
								PutField_Int(hRec, "mask_skip",iMaskSkip);
							}

/* int_bank_code */
							if (GetField_CString(hRecDetailGet,"int_bank_code",&csIntBankCode)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::int_bank_code = [%s]\n",csIntBankCode));
                                                                PutField_CString(hRec, "int_bank_code",csIntBankCode);
                                                        }

/* bank_acct_num */
							if (GetField_CString(hRecDetailGet,"bank_acct_num",&csBankAcctNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::bank_acct_num = [%s]\n",csBankAcctNum));
                                                                PutField_CString(hRec, "bank_acct_num",csBankAcctNum);
                                                        }

/* raw_date */
							if (GetField_CString(hRecDetailGet,"raw_date",&csRawDate)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::raw_date = [%s]\n",csRawDate));
                                                                PutField_CString(hRec, "raw_date",csRawDate);
                                                        }							

/* raw_time */
 							if (GetField_CString(hRecDetailGet,"raw_time",&csRawTime)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::raw_time = [%s]\n",csRawTime));
                                                                PutField_CString(hRec, "raw_time",csRawTime);
                                                        }                 

/* statement_date */
                                                        if (GetField_CString(hRecDetailGet,"statement_date",&csStatementDate)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::statement_date = [%s]\n",csStatementDate));
								PutField_CString(hRec, "statement_date",csStatementDate);
                                                        }

/* statement_time */
                                                        if (GetField_CString(hRecDetailGet,"statement_time",&csStatementTime)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::statement_time = [%s]\n",csStatementTime));
								PutField_CString(hRec, "statement_time",csStatementTime);
                                                        }

/* tfr_bank_name */
                                                        if (GetField_CString(hRecDetailGet,"tfr_bank_name",&csTfrBankName)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_bank_name = [%s]\n",csTfrBankName));
								PutField_CString(hRec, "tfr_bank_name",csTfrBankName);
                                                        }

/* tfr_bank_acct_num */
                                                        if (GetField_CString(hRecDetailGet,"tfr_bank_acct_num",&csTfrBankAcctNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_bank_acct_num = [%s]\n",csTfrBankAcctNum));
								PutField_CString(hRec, "tfr_bank_acct_num",csTfrBankAcctNum);
                                                        }

/* tfr_channel */
                                                        if (GetField_CString(hRecDetailGet,"tfr_channel",&csTfrChannel)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_channel = [%s]\n",csTfrChannel));
								PutField_CString(hRec, "tfr_channel",csTfrChannel);
                                                        }

/* tfr_type */
                                                        if (GetField_CString(hRecDetailGet,"tfr_type",&csTfrType)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_type = [%s]\n",csTfrType));
								PutField_CString(hRec, "tfr_type",csTfrType);
                                                        }

/* tfr_text */
                                                        if (GetField_CString(hRecDetailGet,"tfr_text",&csTfrText)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_text = [%s]\n",csTfrText));
								PutField_CString(hRec, "tfr_text",csTfrText);
                                                        }

/* tfr_customer_text */
                                                        if (GetField_CString(hRecDetailGet,"tfr_customer_text",&csTfrCustomerText)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_customer_text = [%s]\n",csTfrCustomerText));
								PutField_CString(hRec, "tfr_customer_text",csTfrCustomerText);
                                                        }

/* tfr_sender_name */
                                                        if (GetField_CString(hRecDetailGet,"sender_name",&csTfrSenderName)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_sender_name = [%s]\n",csTfrSenderName));
								PutField_CString(hRec, "sender_name",csTfrSenderName);
                                                        }

/* txn_ref_num */
                                                        if (GetField_CString(hRecDetailGet,"txn_ref_num",&csTxnRefNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::txn_ref_num = [%s]\n",csTxnRefNum));
								PutField_CString(hRec, "txn_ref_num",csTxnRefNum);
                                                        }

/* amt_type */
                                                        if (GetField_CString(hRecDetailGet,"amt_type",&csAmtType)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::amt_type = [%s]\n",csAmtType));
								PutField_CString(hRec, "amt_type",csAmtType);
                                                        }

/* txn_amount */
                                                        if (GetField_CString(hRecDetailGet,"txn_amount",&csTxnAmount)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::txn_amount = [%s]\n",csTxnAmount));
								PutField_CString(hRec, "txn_amount",csTxnAmount);
                                                        }

/* bank_charge */
                                                        if (GetField_CString(hRecDetailGet,"bank_charge",&csBankCharge)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::bank_charge = [%s]\n",csBankCharge));
								PutField_CString(hRec, "bank_charge",csBankCharge);
                                                        }

/* balance */
                                                        if (GetField_CString(hRecDetailGet,"balance",&csBalance)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::balance = [%s]\n",csBalance));
								PutField_CString(hRec, "balance",csBalance);
                                                        }

                                		} else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetLastVerRecDetail() failed!!\n");
                                		}
					}

/*---------------Check Disabled and Ver---------------*/ 
					if (iRet == PD_OK) {
/* ver */
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
	                        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
        	                        		iVer = atoi(csTmp);
DEBUGLOG(("Authorize() ver = [%d]\n", iVer));
                	               	 		PutField_Int(hRec, "ver",iVer);
                        			} else {
                                			iRet = INT_STATEMENT_VER_NOT_FOUND;
                                			PutField_Int(hRec,"internal_error",iRet);
DEBUGLOG(("Authorize() ver not found!!\n"));
ERRLOG("TnOmtByUsBSE:: Authorize() ver not found!!\n");
                       	 			}
					}

					if (iRet == PD_OK) {
						if (iDisabled == 1) {
                                                        iRet = INT_STATEMENT_RECORD_DELETED;
DEBUGLOG(("Authorize() CheckRecDisabled:: disabled = [%d]\n", iDisabled));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecDisabled failed!!\n");
                                                }
#if 0 
						else if (iVer <= iLastVer) {
							iRet = INT_STATEMENT_INVALID_VER;
DEBUGLOG(("Authorize() CheckRecVer:: ver <= last_ver \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecVer() failed!!\n");
						}
#endif
					}

/*---------------Update Statement Tmp Detail---------------*/
					if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateRecDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::seq = [%d]\n",iSeq));

/* ver */
						iVer++;
                                		PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateRecDetail::ver = [%d]\n",iVer));

/* latest_ver */
                                		PutField_Int(hRecDetailPut, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() UpdateRecDetail::latest_ver = [%d]\n",iLatestVer));

#if 0
/* org_sys_seq */
                                		PutField_Int(hRecDetailPut, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
#endif

#if 0
/* sys_seq */
                                		PutField_Int(hRecDetailPut, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::sys_seq = [%d]\n",iSysSeq));
#endif

#if 0
/* user_seq */
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
              	          			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n",iUserSeq));				
*/
#endif

/* update_user */
                                		PutField_CString(hRecDetailPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateRecDetail::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateRecDetail() FAILURE!!!\n");
                                		}
                        		}

/*---------------Add Statement Tmp Detail---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRec,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hRec, "seq",iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n",iSeq));

/* ver */
                                		PutField_Int(hRec, "ver",iVer);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));

#if 0
/* latest_ver */
						iLatestVer = 0;
                                		PutField_Int(hRec, "latest_ver",iLatest_Ver);
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif

/* org_sys_seq */
                                		PutField_Int(hRec, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));

#if 0
/* sys_seq */
                                		PutField_Int(hRec, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));
#endif

#if 0
/* user_seq */
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRec, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hRec, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/
#endif

/* disabled */
						iDisabled = 0;
                                		PutField_Int(hRec, "disabled",iDisabled);
DEBUGLOG(("Authorize() AddDetail::disabled = [%d]\n",iDisabled));

/* skip */
						sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iTmp));
                                        		PutField_Int(hRec, "skip",iTmp);
                                		}

/* mask_skip */
						sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n", iTmp));
                                        		PutField_Int(hRec, "mask_skip",iTmp);
						}
	
/* int_bank_code */
						sprintf(csTag, "%s_int_bank_code_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"int_bank_code",csTmp);
                                		}

/* bank_acct_num */
						sprintf(csTag, "%s_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"bank_acct_num",csTmp);
                                		}

/* raw_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"raw_date",csTmp);
                                		}

/* raw_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"raw_time",csTmp);
                                		}

#if 0
/* statement_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_date = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"statement_date",csTmp);
						}

/* statement_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
   		                             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csTmp));
                 		                       PutField_CString(hRec,"statement_time",csTmp);
						}
#endif

/* tfr_bank_name */
						sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_bank_name",csTmp);
						}

/* tfr_bank_acct_num */
						sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_bank_acct_num",csTmp);
						}

/* tfr_type */
						sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_type",csTmp);
						}

/* tfr_channel */
						sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_channel",csTmp);
						}

/* tft_text */
						sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_text = [%s]\n", csTmp));
                                        		PutField_CString(hRec,"tfr_text",csTmp);
						}

/* tfr_customer_text */
						sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, j+1);
                   		             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n",csTmp));
                                		        PutField_CString(hRec,"tfr_customer_text",csTmp);
						}

/* sender_name */
						sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::sender_name = [%s]\n",csTmp));
                                        		PutField_CString(hRec,"sender_name",csTmp);
						}

/* txn_ref_num */
						sprintf(csTag, "%s_txn_ref_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n",csTmp));
                                 		       PutField_CString(hRec,"txn_ref_num",csTmp);
						}

/* balance */
						sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, j+1);
		                                if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                		                        dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::balance = [%.2f]\n",dTmp));
							//PutField_Double(hRec,"balance",dTmp);
							PutField_CString(hRec,"balance",csTmp);
						}

/* amt_type */
						sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, j+1);
		                                if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n",csTmp));
                		                        PutField_CString(hRec,"amt_type",csTmp);
						}

/* txn_amount */
						sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%.2f]\n",dTmp));
							//PutField_Double(hRec,"txn_amount",dTmp);
							PutField_CString(hRec,"txn_amount",csTmp);
						}

/* bank_charge */
						sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, j+1);
						if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%.2f]\n",dTmp));
							//PutField_Double(hRec,"bank_charge",dTmp);
							PutField_CString(hRec,"bank_charge",csTmp);
						}

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hRec);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
                                		}
                        		}

#if 0
/*---------------Get Statement Header---------------*/
					if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                                		if (iRet == PD_OK) {

/* skip_count */
                                        		if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                        		}

/* hold_count */
                                        		if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                        		}

/* accept_count */
                                        		if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                        		}

/* total_count */
                                        		if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                        		}

/* ver */
                                        		if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                        		}

/* split_count */
                                        		if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                        		}

/* add_count */
                                        		if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                        		}

/* update_count */
                                        		if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::update_count = [%d]\n",iUpdateCount));
                                        		}

/* delete_count */
                                       	 		if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                        		}

/* file_count */
                                        		if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                        		}
                                		}
                                		else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                                		}
                        		}

/*---------------Update Statement Header---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                                		PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));

/* hold_count */
                                		PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                                		PutField_Int(hRecHeaderPut, "accept_count",iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                                		PutField_Int(hRecHeaderPut, "total_count",iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer)
						{
                                			PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iVer));
						} else {
                                			PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iHeaderVer));
						}
	
/* split_count */
                                		PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                               			PutField_Int(hRecHeaderPut, "add_count",iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* update_count */
                                		PutField_Int(hRecHeaderPut, "update_count",++iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                                		PutField_Int(hRecHeaderPut, "delete_count",iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                                		PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                                		PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update()\n"));

                               	 		DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                                		}
                        		}
#else
/* ver */
                                	if (iVer > iHeaderVer) {
                                        	iHeaderVer = iVer;
                                	}
DEBUGLOG(("Authorize() SaveHeader::header_ver = [%d]\n",iHeaderVer));

/* split_count */
DEBUGLOG(("Authorize() SaveHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
DEBUGLOG(("Authorize() SaveHeader::add_count = [%d]\n",iAddCount));

/* update_count */
                                	iUpdateCount++;
DEBUGLOG(("Authorize() SaveHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
DEBUGLOG(("Authorize() SaveHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
                                	iFileCount = iSplitCount + iAddCount - iDeleteCount;
DEBUGLOG(("Authorize() SaveHeader::file_count = [%d]\n",iFileCount));
#endif
				}
                		else {
                        		iRet = INT_FILE_ID_NOT_FOUND;
DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
ERRLOG("TxnOmtByUsBSE::Authorize::ValidateProcess::CheckFileIdExist:: failed!!\n");
                		}
			}

			else if ((iRet == PD_OK) && (cAction == PD_ACTION_DELETE)) { 	

/*------------------------------------------------------Delete Record------------------------------------------------------*/
DEBUGLOG(("Authorize() DeleteRecord()\n"));

/*---------------Check File Exist---------------*/
DEBUGLOG(("Authorize() CheckFileIdExist()\n"));

				sprintf(csTag,"%s",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n",csTag));

                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist"); 
				if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));

/*---------------Get Statement Tmp (Last Ver Record) Detail---------------*/

/* seq */
					sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);		
					if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                				iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() seq = [%d]\n", iSeq));
                				PutField_Int(hRec,"seq",iSeq);
                				PutField_Int(hContext,"seq",iSeq);
       	 				} else {
						iRet = INT_STATEMENT_SEQ_NOT_FOUND;
						PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() seq not found!!\n");
        				}

					if (iRet == PD_OK) {
              					DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastVerRecDetail");
                   				iRet = (unsigned long)(*DBObjPtr)(csFileId,iSeq,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* disabled */
							if (GetField_Int(hRecDetailGet,"disabled",&iDisabled)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::disabled = [%d]\n",iDisabled));
                               				}

/* ver */
                             				if (GetField_Int(hRecDetailGet,"ver",&iLastVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::ver = [%d]\n",iLastVer));
                            				}

/* latest_ver */
                             				if (GetField_Int(hRecDetailGet,"latest_ver",&iLatestVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::latest_ver = [%d]\n",iLatestVer));
                              				}

/* org_sys_seq */
                             				if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
								PutField_Int(hRec, "org_sys_seq",iOrgSysSeq);
                           				}

#if 0
/* sys_seq */
                             				if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::sys_seq = [%d]\n",iSysSeq));
                            				}
#endif

#if 0
/* user_seq */
                              				if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::user_seq = [%d]\n",iUserSeq));
                               				}
#endif

/* skip */
                                                        if (GetField_Int(hRecDetailGet,"skip",&iSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::skip = [%d]\n",iSkip));
								PutField_Int(hRec, "skip",iSkip);
                                                        }

/* mask_skip */
                                                        if (GetField_Int(hRecDetailGet,"mask_skip",&iMaskSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::mask_skip = [%d]\n",iMaskSkip));
								PutField_Int(hRec, "mask_skip",iMaskSkip);
							}

/* int_bank_code */
                                                        if (GetField_CString(hRecDetailGet,"int_bank_code",&csIntBankCode)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::int_bank_code = [%s]\n",csIntBankCode));
                                                                PutField_CString(hRec, "int_bank_code",csIntBankCode);
                                                        }

/* bank_acct_num */
                                                        if (GetField_CString(hRecDetailGet,"bank_acct_num",&csBankAcctNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::bank_acct_num = [%s]\n",csBankAcctNum));
                                                                PutField_CString(hRec, "bank_acct_num",csBankAcctNum);
                                                        }

/* raw_date */
                                                        if (GetField_CString(hRecDetailGet,"raw_date",&csRawDate)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::raw_date = [%s]\n",csRawDate));
                                                                PutField_CString(hRec, "raw_date",csRawDate);
                                                        }

/* raw_time */
                                                        if (GetField_CString(hRecDetailGet,"raw_time",&csRawTime)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::raw_time = [%s]\n",csRawTime));
                                                                PutField_CString(hRec, "raw_time",csRawTime);
                                                        }

/* statement_date */
							if (GetField_CString(hRecDetailGet,"statement_date",&csStatementDate)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::statement_date = [%s]\n",csStatementDate));
								PutField_CString(hRec, "statement_date",csStatementDate);
							}

/* statement_time */
							if (GetField_CString(hRecDetailGet,"statement_time",&csStatementTime)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::statement_time = [%s]\n",csStatementTime));
								PutField_CString(hRec, "statement_time",csStatementTime);
                                                        }

/* tfr_bank_name */
							if (GetField_CString(hRecDetailGet,"tfr_bank_name",&csTfrBankName)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_bank_name = [%s]\n",csTfrBankName));
								PutField_CString(hRec, "tfr_bank_name",csTfrBankName);
                                                        }

/* tfr_bank_acct_num */
                                                        if (GetField_CString(hRecDetailGet,"tfr_bank_acct_num",&csTfrBankAcctNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_bank_acct_num = [%s]\n",csTfrBankAcctNum));
								PutField_CString(hRec, "tfr_bank_acct_num",csTfrBankAcctNum);
                                                        }

/* tfr_channel */
                                                        if (GetField_CString(hRecDetailGet,"tfr_channel",&csTfrChannel)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_channel = [%s]\n",csTfrChannel));
								PutField_CString(hRec, "tfr_channel",csTfrChannel);
                                                        }

/* tfr_type */
                                                        if (GetField_CString(hRecDetailGet,"tfr_type",&csTfrType)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_type = [%s]\n",csTfrType));
								PutField_CString(hRec, "tfr_type",csTfrType);
                                                        }

/* tfr_text */
                                                        if (GetField_CString(hRecDetailGet,"tfr_text",&csTfrText)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_text = [%s]\n",csTfrText));
								PutField_CString(hRec, "tfr_text",csTfrText);
                                                        }

/* tfr_customer_text */
                                                        if (GetField_CString(hRecDetailGet,"tfr_customer_text",&csTfrCustomerText)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_customer_text = [%s]\n",csTfrCustomerText));
								PutField_CString(hRec, "tfr_customer_text",csTfrCustomerText);
                                                        }

/* tfr_sender_name */
                                                        if (GetField_CString(hRecDetailGet,"sender_name",&csTfrSenderName)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::tfr_sender_name = [%s]\n",csTfrSenderName));
								PutField_CString(hRec, "sender_name",csTfrSenderName);
                                                        }

/* txn_ref_num */
                                                        if (GetField_CString(hRecDetailGet,"txn_ref_num",&csTxnRefNum)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::txn_ref_num = [%s]\n",csTxnRefNum));
								PutField_CString(hRec, "txn_ref_num",csTxnRefNum);
                                                        }

/* amt_type */
                                                        if (GetField_CString(hRecDetailGet,"amt_type",&csAmtType)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::amt_type = [%s]\n",csAmtType));
								PutField_CString(hRec, "amt_type",csAmtType);
                                                        }

/* txn_amount */
                                                        if (GetField_CString(hRecDetailGet,"txn_amount",&csTxnAmount)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::txn_amount = [%s]\n",csTxnAmount));
								PutField_CString(hRec, "txn_amount",csTxnAmount);
                                                        }						

/* bank_charge */
                                                        if (GetField_CString(hRecDetailGet,"bank_charge",&csBankCharge)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::bank_charge = [%s]\n",csBankCharge));
								PutField_CString(hRec, "bank_charge",csBankCharge);
                                                        }

/* balance */
                                                        if (GetField_CString(hRecDetailGet,"balance",&csBalance)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::balance = [%s]\n",csBalance));
								PutField_CString(hRec, "balance",csBalance);
                                                        }

                        			}
                        			else {
                                			iRet = INT_ERR;
DEBUGLOG(("Authorize:: call DBOLStatementTmp(GetLastVerRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetLastVerRecDetail:: failed!!\n");
                        			}
					}

/*---------------Check Disabled and Ver---------------*/ 
					if (iRet == PD_OK) {
/* ver */
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iVer = atoi(csTmp);
DEBUGLOG(("Authorize() ver = [%d]\n", iVer));
                                			PutField_Int(hRec, "ver",iVer);
                                			PutField_Int(hContext, "ver",iVer);
                        			} else {
                                			iRet = INT_STATEMENT_VER_NOT_FOUND;
                                			PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() ver not found!!\n"));
ERRLOG("TnOmtByUsBSE:: Authorize() ver not found!!\n");
                       	 			}
					}

					if (iRet == PD_OK) {
						if (iDisabled == 1) {
							iRet = INT_STATEMENT_RECORD_DELETED;
DEBUGLOG(("Authorize() CheckRecDisabled:: disabled = [%d]\n", iDisabled));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecDisabled failed!!\n");
						}
#if 0 
						else if (iVer <= iLastVer) {
							iRet = INT_STATEMENT_INVALID_VER;
DEBUGLOG(("Authorize() CheckRecVer:: ver <= last_ver \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecVer failed!!\n");
						}
#endif
					}

/*---------------Update Statement Tmp Detail---------------*/ 
             				if (iRet == PD_OK) {

/* file_id */     
	        				PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateRecDetail::file_id = [%s]\n",csFileId));
             
/* seq */
                       	 			PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::seq = [%d]\n",iSeq));

/* ver */
						iVer++;
		       				PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateRecDetail::ver = [%d]\n",iVer));

/* latest_ver */
                      				PutField_Int(hRecDetailPut, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() UpdateRecDetail::latest_ver = [%d]\n",iLatestVer));
        
#if 0
/* org_sys_seq */
	              				PutField_Int(hRecDetailPut, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
#endif     

#if 0    
/* sys_seq */	
	              				PutField_Int(hRecDetailPut, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::sys_seq = [%d]\n",iSysSeq));
#endif

#if 0
/* user_seq */	
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n",iUserSeq));
*/
#endif

/* update_user */
                               			PutField_CString(hRecDetailPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateRecDetail::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update()\n"));

                     				DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateRecDetail");
                     				iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateRecDetail() FAILURE!!!\n");
                     				}
           				}

/*---------------Add Statement Tmp Detail---------------*/
             				if (iRet == PD_OK) {

/* file_id */
                     				PutField_CString(hRec,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
                        			PutField_Int(hRec, "seq",iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n",iSeq));
             
/* ver */
		       				PutField_Int(hRec, "ver",iVer);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));
         
#if 0
/* latest_ver */
						iLatestVer = 0;
	             				PutField_Int(hRec, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif     

#if 0   
/* org_sys_seq */
	             				PutField_Int(hRec, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
#endif     
 
#if 0      
/* sys_seq */
		      				PutField_Int(hRec, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));
#endif

#if 0	
/* user_seq */	
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                	        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                        	        		iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRec, "user_seq",iUserSeq);
                        			} 

/*
						PutField_Int(hRec, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/
#endif         
 
/* disabled */
	         				PutField_Int(hRec, "disabled",1);
DEBUGLOG(("Authorize() AddDetail::disabled = [1]\n"));

#if 0
/* skip */
						PutField_Int(hRec, "skip",iSkip);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n",iSkip));
#endif

#if 0
/* mask_skip */
						PutField_Int(hRec, "mask_skip",iMaskSkip);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n",iMaskSkip));
#endif

#if 0	
/* int_bank_code */
                             			PutField_CString(hRec,"int_bank_code",csIntBankCode);
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csIntBankCode));

/* bank_acct_num */
                        	     		PutField_CString(hRec,"bank_acct_num",csBankAcctNum);
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csBankAcctNum));

/* raw_date */
                    		          	PutField_CString(hRec,"raw_date",csRawDate);
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csRawDate));

/* raw_time */
                              			PutField_CString(hRec,"raw_time",csRawTime);
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csRawTime));
#endif

#if 0
/* statement_date */
						PutField_CString(hRec, "statement_date",csStatementDate);
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n",csStatementDate));

/* statement_time */
						PutField_CString(hRec, "statement_time",csStatementTime);
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csStatementTime));

/* tfr_bank_name */
						PutField_CString(hRec, "tfr_bank_name",csTfrBankName);
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTfrBankName));

/* tfr_bank_acct_num */
						PutField_CString(hRec, "tfr_bank_acct_num",csTfrBankAcctNum);
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTfrBankAcctNum));

/* tfr_type */
						PutField_CString(hRec, "tfr_type",csTfrType);
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTfrType));

/* tfr_channel */
						PutField_CString(hRec, "tfr_channel",csTfrChannel);
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTfrChannel));

/* tft_text */
						PutField_CString(hRec, "tft_text",csTfrText);
DEBUGLOG(("Authorize() AddDetail::tft_text = [%s]\n", csStatementTime));

/* tfr_customer_text */
						PutField_CString(hRec, "tfr_customer_text",csTfrCustomerText);
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n", csTfrCustomerText));

/* tfr_sender_name */
						PutField_CString(hRec, "sender_name",csTfrSenderName);
DEBUGLOG(("Authorize() AddDetail::tfr_sender_name = [%s]\n", csTfrSenderName));

/* txn_ref_num */
						PutField_CString(hRec, "txn_ref_num",csTxnRefNum);
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n", csTxnRefNum));

/* balance */
						PutField_CString(hRec, "balance",csBalance);
DEBUGLOG(("Authorize() AddDetail::balance = [%s]\n", csBalance));

/* amt_type */
						PutField_CString(hRec, "amt_type",csAmtType);
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n", csAmtType));

/* txn_amount */
						PutField_CString(hRec, "txn_amount",csTxnAmount);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%s]\n", csTxnAmount));

/* bank_charge */
						PutField_CString(hRec, "bank_charge",csBankCharge);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%s]\n", csBankCharge));
#endif

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                	     			DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                     				iRet = (unsigned long)(*DBObjPtr)(hRec);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
                     				}
           				}

#if 0
/*---------------Get Statement Header---------------*/
                        		if (iRet == PD_OK) {

                       	 			DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                        			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* skip_count */
                                			if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                			}

/* hold_count */
                                			if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                			}

/* accept_count */
                                			if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                			}

/* total_count */
                                			if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                			}

/* ver */
                                			if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                			}

/* split_count */
                                			if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                			}

/* add_count */
                                			if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                			}

/* update_count */
                                			if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::update_count = [%d]\n",iUpdateCount));
                                			}

/* delete_count */
                                			if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                			}

/* file_count */
                                			if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                			}
                        			}
                        			else {
                        	        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                        			}
					}

/*---------------Update Statement Header---------------*/
					if (iRet == PD_OK) {

/* file_id */
                     				PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                     				PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));
                       	
/* hold_count */
						PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                       				PutField_Int(hRecHeaderPut, "accept_count",++iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                      				PutField_Int(hRecHeaderPut, "total_count",++iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer) {
                       					PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iVer));
						} else {
                       					PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iHeaderVer));
						}

/* split_count */
                      				PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                     				PutField_Int(hRecHeaderPut, "add_count",iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* update_count */
                      				PutField_Int(hRecHeaderPut, "update_count",iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                      				PutField_Int(hRecHeaderPut, "delete_count",++iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                       				PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                       	 			PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(DBOLStatement)::UpdateHeader()\n"));

                      				DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                    				iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(DBOLStatement)::UpdateHeader() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                    				}
               				}
#else
/* ver */
                               	 	if (iVer > iHeaderVer) {
                                        	iHeaderVer = iVer;
                                	}
DEBUGLOG(("Authorize() SaveHeader::header_ver = [%d]\n",iHeaderVer));

/* split_count */
DEBUGLOG(("Authorize() SaveHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
DEBUGLOG(("Authorize() SaveHeader::add_count = [%d]\n",iAddCount));

/* update_count */
DEBUGLOG(("Authorize() SaveHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                                	iDeleteCount++;
DEBUGLOG(("Authorize() SaveHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
                                	iFileCount = iSplitCount + iAddCount - iDeleteCount;
DEBUGLOG(("Authorize() SaveHeader::file_count = [%d]\n",iFileCount));
#endif
				}
				else {
                        		iRet = INT_FILE_ID_NOT_FOUND;
DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckFileIdExist:: failed!!\n");
                		}
			}
		}
	}

/*------------------------------------------------------Order Record------------------------------------------------------*/
DEBUGLOG(("Authorize() OrderRecord()\n"));
	
 	if (iRet == PD_OK) {
                for (k = 0; k < iOrderCnt; k++) {
DEBUGLOG(("Authorize() order() order_cnt = [%d]\n", k));

			hash_init(hRecOrderGet,0);
        		hash_init(hRecOrderPut,0);

			sprintf(csTag, "order_%d", k+1);
                        if (GetField_CString(hRecTemp, csTag, &csTmp)) {				
				sprintf(csTag, "%s", csTmp);
				if (GetField_CString(hRecOrderAdd, csTag, &csTmp)) {
DEBUGLOG(("Authorize() order() %s = [%s]\n", csTag,csTmp));					

/* file_id */
                        		sprintf(csTagName, "%s_file_id", csTag);
                        		if (GetField_CString(hRecOrderAdd, csTagName, &csFileId)) {
DEBUGLOG(("Authorize() order() file_id = [%s]\n", csFileId));
                                		PutField_CString(hRecOrderPut,"file_id",csFileId);
                        		} else {
                                		iRet = INT_FILE_ID_NOT_FOUND;
                                		PutField_Int(hRecOrderPut,"internal_error",iRet);
DEBUGLOG(("Authorize() order() file_id not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() order() file_id not found!!\n");
                       			}

/* seq */
					sprintf(csTagName, "%s_seq", csTag);
                                        if (GetField_CString(hRecOrderAdd, csTagName, &csTmp)) {
                                		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() order() seq = [%d]\n", iSeq));
                                		PutField_Int(hRecOrderPut,"seq",iSeq);
                        		} else {
                                		iRet = INT_STATEMENT_SEQ_NOT_FOUND;
                                		PutField_Int(hRecOrderPut,"internal_error",iRet);
DEBUGLOG(("Authorize() order() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() order() seq not found!!\n");
                        		}
				} else {
/* file_id */
                        		sprintf(csTag, "order_file_id_%d", k+1);
                        		if (GetField_CString(hRecTemp, csTag, &csFileId)) {
DEBUGLOG(("Authorize() order() file_id = [%s]\n", csFileId));
                                		PutField_CString(hRecOrderPut,"file_id",csFileId);
                        		} else {
                                		iRet = INT_FILE_ID_NOT_FOUND;
                                		PutField_Int(hRecOrderPut,"internal_error",iRet);
DEBUGLOG(("Authorize() order() file_id not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() order() file_id not found!!\n");
                        		}

/* seq */
                        		sprintf(csTag, "order_seq_%d", k+1);
                        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() order() seq = [%d]\n", iSeq));
                                		PutField_Int(hRecOrderPut,"seq",iSeq);
                        		} else {
                                		iRet = INT_STATEMENT_SEQ_NOT_FOUND;
                                		PutField_Int(hRecOrderPut,"internal_error",iRet);
DEBUGLOG(("Authorize() order() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() order() seq not found!!\n");
                        		}
				}
			}

/* user_seq */
                        sprintf(csTag, "order_user_seq_%d", k+1);
                        if (GetField_Int(hRecTemp, csTag, &iUserSeq)) {
DEBUGLOG(("Authorize() order() user_seq = [%d]\n", iUserSeq));
                                PutField_Int(hRecOrderPut,"user_seq",iUserSeq);
                        }

			if (iRet == PD_OK) {
                        	DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastVerRecDetail");
                            	iRet = (unsigned long)(*DBObjPtr)(csFileId,iSeq,hRecOrderGet);
DEBUGLOG(("Authorize() order() call DBOLStatementTmp(GetLastVerRecDetail)::iRet = [%d]\n",iRet));

                           	if (iRet == PD_OK) {

/* ver */
                              		if (GetField_Int(hRecOrderGet,"ver",&iLastVer)) {
DEBUGLOG(("Authorize() order() call DBOLStatementTmp(GetLastVerRecDetail)::ver = [%d]\n",iLastVer));
                                       	}

				} else {
                                 	iRet = INT_ERR;
DEBUGLOG(("Authorize() order() call DBOLStatementTmp(GetLastVerRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() order() call DBOLStatementTmp:: GetLastVerRecDetail() failed!!\n");
                           	}
			}

		  	if (iRet == PD_OK) {

/* file_id */
                           	PutField_CString(hRecOrderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() order() UpdateUserSeqDetail::file_id = [%s]\n",csFileId));

/* seq */
                           	PutField_Int(hRecOrderPut, "seq",iSeq);
DEBUGLOG(("Authorize() order() UpdateUserSeqDetail::seq = [%d]\n",iSeq));

/* ver */
                           	PutField_Int(hRecOrderPut, "ver",iLastVer);
DEBUGLOG(("Authorize() order() UpdateUserSeqDetail::ver = [%d]\n",iLastVer));

/* user_seq */
                            	PutField_Int(hRecOrderPut,"user_seq",iUserSeq);
DEBUGLOG(("Authorize() order() UpdateUserSeqDetail::user_seq = [%d]\n",iUserSeq));

DEBUGLOG(("Authorize() order() call DBOLStatementTmp(UpdateUserSeqDetail)::Update()\n"));

                          	DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateUserSeqDetail");
                            	iRet = (unsigned long)(*DBObjPtr)(hRecOrderPut);
                             	if (iRet != PD_OK) {
DEBUGLOG(("Authorize() order() call DBOLStatementTmp(UpdateUserSeqDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() order() call DBOLStatementTmp:: UpdateUserSeqDetail() FAILURE!!!\n");
                             	}

                      	}
		}
	}	

/*----------------------------------------------------------------Re-Upload Bank Statement----------------------------------------------------------------*/
#if 0	
	/* Get Statement Header*/

	/* Get BAID */
	
	/* Get country */

	/* Get acct_ccy, sys_switch, restricted */

	/* Check bank acct status */

	/* Get bank_acct_type */
	
	/* Get stmt file format */	

	/* Process Stmt Tmp */

	/* Process Stmt Detail */

	/* Result */
	//PutField_Int(hContext,"message_code",iRet);

	if (iRet == PD_OK) {
		/* Success */

		/* Status */

		/* Update Header */
		
		/* Txn Commit */

        }
        else {
		/* Failure */

		/* Txn Abort */

		/* Status */
	
		/* Update Header */

		/* Add Error */

        }

	/* Update Tmp */	

#endif

/*----------------------------------------------------------------Results----------------------------------------------------------------*/
	if (iRet != PD_OK) {
		PutField_Int(hContext, "internal_error", iRet);
DEBUGLOG(("Authorize() internal_error! iRet = [%d]\n", iRet));
	}

	PutField_Int(hResponse,"ret",iRet);
	
	FREE_ME(csData);
        FREE_ME(csDataCode);
        FREE_ME(csSubData);
        FREE_ME(csSubDataCode);
        FREE_ME(csKey);
        FREE_ME(csKeyCode);

        FREE_ME(hRecTemp);
	FREE_ME(hRecOrderAdd);

	FREE_ME(hRec);

	FREE_ME(hRecHeaderGet);
       	FREE_ME(hRecHeaderPut);
     	FREE_ME(hRecDetailGet);
      	FREE_ME(hRecDetailPut);

	FREE_ME(hRecOrderGet);
        FREE_ME(hRecOrderPut);

DEBUGLOG(("Authorize() Normal Exit! iRet = [%d]\n", iRet));
	return iRet;
}
