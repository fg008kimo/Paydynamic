/*
Partnerdelight (c)2010. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2014/09/22              Elvis Wong
*/

#define       PD_DETAIL_TAG   "dt"

#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "internal.h"
#include "TxnOmtByUsBSE.h"
#include "myrecordset.h"

char cDebug;
OBJPTR(DB);
OBJPTR(BO);
OBJPTR(Txn);

void TxnOmtByUsBSE(char cdebug)
{
	cDebug = cdebug;
}

int Authorize(hash_t* hContext,
		hash_t* hRequest,
		hash_t* hResponse)
{
	int	iRet = PD_OK;
	int     iDtlRet = PD_OK;	

	char	cAction;
	char	*csUser = NULL;
	char    *csFileId = NULL;

	char    csFileName[PD_FILENAME_LEN + 1];
	
	char	*csCreateUser = NULL;
	char	*csCreateTimestamp = NULL;

	int	iHeaderVer = 0;
	int	iSkipCount = 0;
	int	iHoldCount = 0;
	int	iAcceptCount = 0;
	int	iTotalCount = 0;
	int	iSplitCount = 0;
	int	iAddCount = 0;
	int	iUpdateCount = 0;
	int	iDeleteCount = 0;
	int	iFileCount = 0;

	int	iSeq = 0;
	int	iVer = 0;
	int	iLastVer = 0;
	int	iLatestVer = 0;
	int	iOrgSysSeq = 0;
	int	iSysSeq = 0;
	int	iUserSeq = 0;	
	int	iDisabled = 0;
	//int	iSkip = 0;
	//int	iMaskSkip = 0;

	char	*csTmp;
	//char	cTmp;
	double	dTmp;
	int	iTmp;

	int	i = 0;
	int	j = 0;
	int	iCnt = 0;

	char	csTag[PD_TAG_LEN + 1];

	char    *csKey;
	char	*csKeyCode;
	int	iKeyCodeLen = 0;

	char    *csData;
	char	*csDataCode;
	int	iDataCodeLen = 0;

	hash_t *hRecTemp = (hash_t*) malloc (sizeof(hash_t));
        hash_init(hRecTemp,0);

	hash_t *hRecHeaderGet = (hash_t*) malloc (sizeof(hash_t));
        hash_init(hRecHeaderGet,0);

	hash_t *hRecHeaderPut = (hash_t*) malloc (sizeof(hash_t));
        hash_init(hRecHeaderPut,0);

	hash_t *hRecDetailGet = (hash_t*) malloc (sizeof(hash_t));
        hash_init(hRecDetailGet,0);

	hash_t *hRecDetailPut = (hash_t*) malloc (sizeof(hash_t));
        hash_init(hRecDetailPut,0);
	
	csKey = (char*) malloc (128);
	csKeyCode = (char*) malloc (128);

	csData = (char*) malloc (128);
	csDataCode = (char*) malloc (128);

/*----------------------------------------------------------------Get Data From hRequest----------------------------------------------------------------*/

/* user */
        if (GetField_CString(hRequest, "add_user", &csUser)) {
                PutField_CString(hContext,"create_user",csUser);
                PutField_CString(hContext,"update_user",csUser);
DEBUGLOG(("Authorize() user = [%s]\n", csUser));
        } else {
                iRet = INT_USER_NOT_FOUND;
                PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() user NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() user NOT FOUND!!!\n");
        }

/* total_cnt */
        if (GetField_CString(hRequest, "total_cnt", &csTmp)) {
DEBUGLOG(("Authorize() total_cnt = [%s]\n", csTmp));
                iCnt = atoi(csTmp);
        } else {
DEBUGLOG(("Authorize() total_cnt NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() total_cnt NOT FOUND!!!\n");
                iRet = INT_ERR;
        }	

	if (iRet == PD_OK) {
                for (i = 0; i < iCnt; i++) {
DEBUGLOG(("Authorize() hRecTemp::cnt = [%d]\n", i));

/* action */
			sprintf(csTag, "%s_action_%d", PD_DETAIL_TAG, i+1);
        		if (GetField_CString(hRequest, csTag, &csTmp)) {
                		PutField_CString(hRecTemp,csTag,csTmp);
DEBUGLOG(("Authorize() hRecTemp::action = [%s]\n", csTmp));
        		} else {
                		iDtlRet = INT_ERR;
DEBUGLOG(("Authorize() action NOT FOUND!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() action NOT FOUND!!!\n");
        		}

/* key */
			sprintf(csTag, "%s_key_%d", PD_DETAIL_TAG, i+1);
			if (GetField_CString(hRequest, csTag, &csTmp)) {
DEBUGLOG(("Authorize() hRecTemp::csTmp = [%s]\n", csTmp));

				sprintf(csKeyCode,"%s",csTmp);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
                                        sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::file_id = NULL\n"));
                                } else {
        				strtok(csKeyCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, i+1);
					PutField_CString(hRecTemp,csTag,csKeyCode);
DEBUGLOG(("Authorize() hRecTemp::file_id = [%s]\n",csKeyCode));
					iKeyCodeLen = strlen(csKeyCode) + 1;
				}

				sprintf(csKey,"%s",&csTmp[iKeyCodeLen]);
				sprintf(csKeyCode,"%s",csKey);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
                                        sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::seq = NULL\n"));
                                } else {
					strtok(csKeyCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, i+1);
					PutField_CString(hRecTemp,csTag,csKeyCode);	
                        	        iKeyCodeLen += (strlen(csKeyCode) + 1);
DEBUGLOG(("Authorize() hRecTemp::seq = [%s]\n",csKeyCode));
				}

				sprintf(csKey,"%s",&csTmp[iKeyCodeLen]);
				sprintf(csKeyCode,"%s",csKey);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
                                        sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::ver = NULL\n"));
                                } else {
					sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, i+1);
					PutField_CString(hRecTemp,csTag,csKeyCode);
DEBUGLOG(("Authorize() hRecTemp::ver = [%s]\n",csKeyCode));
				}
        		} else {
                              	iDtlRet = INT_ERR;
DEBUGLOG(("Authorize() [%s] NOT FOUND!!!\n", csTag));
ERRLOG("TxnOmtByUsBSE::Authorize() [%s] NOT FOUND!!!\n", csTag);
                        }

/* data */
			sprintf(csTag, "%s_data_%d", PD_DETAIL_TAG, i+1);
        		if (GetField_CString(hRequest, csTag, &csTmp)) {
DEBUGLOG(("Authorize() hRecTemp::data = [%s]\n", csTmp));

				iDataCodeLen = 0;

                		sprintf(csDataCode,"%s",csTmp);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
				{
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::statement_date = NULL\n"));
				} else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::statement_date = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::statement_time = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::statement_time = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_bank_name = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_bank_name = [%s]\n",csDataCode));
				}
		
                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");	
					sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_bank_acct_num = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_bank_acct_num = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_channel = NULL\n"));
                                } else {
               				strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_channel = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_type = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, i+1);
					PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_type = [%s]\n",csDataCode));
				}
	
                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_text = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;								
DEBUGLOG(("Authorize() hRecTemp::tfr_text = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_customer_text = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_customer_text = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_sender_name = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::tfr_sender_name = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_tfr_ref_num_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::tfr_ref_num = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_tfr_ref_num_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;			
DEBUGLOG(("Authorize() hRecTemp::tfr_ref_num = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::amt_type = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::amt_type = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::txn_amount = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::txn_amount = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::bank_charge = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::bank_charge = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::balance = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += strlen(csDataCode) + 1;
DEBUGLOG(("Authorize() hRecTemp::balance = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
                                        iDataCodeLen++;
DEBUGLOG(("Authorize() hRecTemp::skip = NULL\n"));
                                } else {
                			strtok(csDataCode,PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL);
					sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
					iDataCodeLen += (strlen(csDataCode) + 1);	
DEBUGLOG(("Authorize() hRecTemp::skip = [%s]\n",csDataCode));
				}

                		sprintf(csData,"%s",&csTmp[iDataCodeLen]);
                		sprintf(csDataCode,"%s",csData);
				if (csDataCode[0] == PD_BANK_STATEMENT_DATA_DELIMIT_SYMBOL_CHECK)
                                {
					sprintf(csDataCode,"%s","\0");
                                        sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, i+1);
                                        PutField_CString(hRecTemp,csTag,csDataCode);
DEBUGLOG(("Authorize() hRecTemp::mask_skip = NULL\n"));
                                } else {
					sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, i+1);
                			PutField_CString(hRecTemp,csTag,csDataCode);
DEBUGLOG(("Authorize() hRecTemp::mask_skip = [%s]\n",csDataCode));
				}
			} else {
                                iDtlRet = INT_ERR;
DEBUGLOG(("Authorize() [%s] NOT FOUND!!!\n", csTag));
ERRLOG("TxnOmtByUsBSE::Authorize() [%s] NOT FOUND!!!\n", csTag);
                        }
		} 
	}

/*----------------------------------------------------------------Get Data From hRecTemp----------------------------------------------------------------*/

	if (iRet == PD_OK) {
                for (j = 0; j < iCnt; j++) {
DEBUGLOG(("Authorize()::cnt = [%d]\n", j));

/* action */
			sprintf(csTag, "%s_action_%d", PD_DETAIL_TAG, j+1);
			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
				cAction = csTmp[0];
				PutField_Char(hContext,"action",cAction);
DEBUGLOG(("Authorize() action = [%c]\n", cAction));
			} else {
                		iRet = INT_ACTION_NOT_FOUND;
                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() action not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() action not found!!\n");
        		}

/* file_id */
			sprintf(csTag, "%s_file_id_%d", PD_DETAIL_TAG, j+1);
			if (GetField_CString(hRecTemp, csTag, &csFileId)) {
				PutField_CString(hContext,"file_id",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n", csFileId));
			} else {
              			iRet = INT_FILE_ID_NOT_FOUND;
                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() file_id not found!!\n"));
ERRLOG("TxnOmtByUsSCE:: Authorize() file_id not found!!\n");
        		}
		
			if ((iRet == PD_OK) && (cAction == PD_ACTION_ADD)) {	

/*------------------------------------------------------Add Record------------------------------------------------------*/
DEBUGLOG(("Authorize()::cAction()::Add\n"));

DEBUGLOG(("Authorize()::CheckFileIdExist()\n"));

				snprintf(csTag,sizeof(csTag),"%s",csFileId);
DEBUGLOG(("Authorize()::file_id = [%s]\n",csTag));

				snprintf(csFileName,sizeof(csFileName),"SF%s",csFileId);
DEBUGLOG(("Authorize()::file_name = [%s]\n",csFileName));

                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist");
				if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {

/*-----------------------------------Add Record::File Exist-----------------------------------*/
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));

/*---------------Get Statement Tmp (Laat Seq Record) Detail---------------*/
					DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastSeqRecDetail");
                			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::iRet = [%d]\n",iRet));

                			if (iRet == PD_OK) {		

/* seq */
						if (GetField_Int(hRecDetailGet,"seq",&iSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::seq = [%d]\n",iSeq));
        	                		}

/* org_sys_seq */
						if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
                        			}

/* sys_seq */
						if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::sys_seq = [%d]\n",iSysSeq));
                        			}

#if 0
/* user_seq */
						if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastSeqRecDetail)::user_seq = [%d]\n",iUserSeq));
                        			}
#endif

					} else {
						iRet = INT_ERR;
DEBUGLOG(("Authorize:: call DBOLStatementTmp(GetLastSeqRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() DBOLStatementTmp:: GetLastSeqRecDetail() failed!!\n");
					}


/*---------------Add Statement Tmp Detail---------------*/
					if (iRet == PD_OK) {

/* file_id */
						PutField_CString(hContext,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
						sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n", iSeq));
                                        		PutField_Int(hContext, "seq",iSeq);
                                		}

/*
                              			PutField_Int(hContext, "seq",++iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n",iSeq));
*/

/* ver */
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
						if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                         	       			iVer = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n", iVer));
                                			PutField_Int(hContext, "ver",iVer);
                        			}

/*
						iVer = 0;
						PutField_Int(hContext, "ver",iVer);		
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));
*/

#if 0
/* latest_ver */
						iLatestVer = 0;
						PutField_Int(hContext, "latest_ver",iLatestVer);		
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif
		
/* org_sys_seq */
						iOrgSysSeq = iSeq;
						//PutField_Int(hContext, "org_sys_seq",++iOrgSysSeq);
						PutField_Int(hContext, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
		
/* sys_seq */
						iSysSeq = iSeq;
						//PutField_Int(hContext, "sys_seq",++iSysSeq);
						PutField_Int(hContext, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));

#if 0	
/* user_seq */
						sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRequest, csTag, &csTmp)) {
                                        		iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                        		PutField_Int(hContext, "user_seq",iUserSeq);
                                		}

/*
						PutField_Int(hContext, "user_seq",++iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/
#endif

/* disabled */
						iDisabled = 0;
                                		PutField_Int(hContext, "disabled",iDisabled);
DEBUGLOG(("Authorize() AddDetail::disabled = [%d]\n",iDisabled));

/* skip */
						sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iTmp));
                                        		PutField_Int(hContext, "skip",iTmp);
                                		}

/* mask_skip */
						sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n", iTmp));
                                        		PutField_Int(hContext, "mask_skip",iTmp);
                                		}

#if 0
/* int_bank_code */
						sprintf(csTag, "%s_int_bank_code_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"int_bank_code",csTmp);
                                		}

/* bank_acct_num */
						sprintf(csTag, "%s_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                 		               	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csTmp));
                                		        PutField_CString(hContext,"bank_acct_num",csTmp);
                                		}

/* raw_date */
						sprintf(csTag, "%s_raw_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"raw_date",csTmp);
                                		}

/* raw_time */
						sprintf(csTag, "%s_raw_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csTmp));
                                       	 		PutField_CString(hContext,"raw_time",csTmp);
						}
#endif

/* statement_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_date = [%s]\n", csTmp));
                                       			PutField_CString(hContext,"statement_date",csTmp);
                                		}

/* statement_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"statement_time",csTmp);
                                		}

/* tfr_bank_name */
						sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_bank_name",csTmp);
                                		}

/* tfr_bank_acct_num */
						sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_bank_acct_num",csTmp);
                                		}

/* tfr_type */
						sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_type",csTmp);
                                		}

/* tfr_channel */
						sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_channel",csTmp);
                                		}

/* tft_text */
						sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_text = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_text",csTmp);
                                		}

/* tfr_customer_text */
						sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, j+1);
                   		             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n",csTmp));
                        		                PutField_CString(hContext,"tfr_customer_text",csTmp);
                                		}

/* tfr_sender_name */
						sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::sender_name = [%s]\n",csTmp));
                                        		PutField_CString(hContext,"sender_name",csTmp);
                                		}

/* txn_ref_num */
						sprintf(csTag, "%s_tfr_ref_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n",csTmp));
                                        		PutField_CString(hContext,"txn_ref_num",csTmp);
                                		}

/* balance */
						sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::balance = [%.2f]\n",dTmp));
                                        		//PutField_Double(hContext,"balance",dTmp);
                                        		PutField_CString(hContext,"balance",csTmp);
                                		}

/* amt_type */
						sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n",csTmp));
                                		        PutField_CString(hContext,"amt_type",csTmp);
                                		}

/* txn_amount */
						sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"txn_amount",dTmp);
							PutField_CString(hContext,"txn_amount",csTmp);
						}

/* bank_charge */
						sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"bank_charge",dTmp);
                                        		PutField_CString(hContext,"bank_charge",csTmp);
                                		}

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                        			DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                        			iRet = (unsigned long)(*DBObjPtr)(hContext);
                        			if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
						}
					}
			
/*---------------Get Statement Tmp (First Seq Record) Detail---------------*/
                        		if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetFirstSeqRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::iRet = [%d]\n",iRet));

                               			 if (iRet == PD_OK) {

/* create_user */
                                        		if (GetField_CString(hRecDetailGet, "create_user", &csCreateUser)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::create_user = [%s]\n", csCreateUser));
                                        		}

/* create_timestamp */
                                        		if (GetField_CString(hRecDetailGet, "create_timestamp", &csCreateTimestamp)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail)::create_timestamp = [%s]\n", csCreateTimestamp));
                                        		}


                                		} else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetFirstSeqRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetFirstSeqRecDetail() failed!!\n");
                                		}
                        		}

/*---------------Update Statement Tmp Detail---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::seq = [%d]\n",iSeq));

/* ver */
                                		PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::ver = [%d]\n",iVer));

/* create_user */
                                		PutField_CString(hRecDetailPut,"create_user",csCreateUser);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::create_user = [%s]\n",csCreateUser));

/* create_timestamp */
                                		PutField_CString(hRecDetailPut,"create_timestamp",csCreateTimestamp);
DEBUGLOG(("Authorize() UpdateUserTimestampDetail::create_timestamp = [%s]\n",csCreateTimestamp));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateUserTimestampDetail)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateUserTimestampDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateUserTimestampDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateUserTimestampDetail() FAILURE!!!\n");
                                		}

                        		}

/*---------------Get Statement Header---------------*/
					if (iRet == PD_OK) {
						
                        			DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                        			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* skip_count */
                                			if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                			}

/* hold_count */
                                			if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                			}

/* accept_count */
                                			if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                			}

/* total_count */
                                			if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                			}

/* ver */
                                			if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                			}

/* split_count */
                                			if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                			}

/* add_count */
                                			if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                			}

/* update_count */
                                			if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetSHeader)::update_count = [%d]\n",iUpdateCount));
                                			}

/* delete_count */
                                			if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                			}

/* file_count */
                                			if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                			}

                        			} else {
                                			iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                        			}
					}

/*---------------Update Statement Header---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                                		PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));

/* hold_count */
                               	 		PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                                		PutField_Int(hRecHeaderPut, "accept_count",iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                                		PutField_Int(hRecHeaderPut, "total_count",iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer) {	
                                			PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iVer));
						} else {
                                			PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iHeaderVer));
						}

/* split_count */
                                		PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                                		PutField_Int(hRecHeaderPut, "add_count",++iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* updat_count */
                                		PutField_Int(hRecHeaderPut, "update_count",iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                                		PutField_Int(hRecHeaderPut, "delete_count",iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                                		PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                                		PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                                		}
                        		}
				} else {
/*-----------------------------------Add Record::File Not Exist-----------------------------------*/
					iRet = INT_INVALID_FILE_ID; 
DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: File Not Exist!!!\n");                         
				}
			}
		
			else if ((iRet == PD_OK) && (cAction == PD_ACTION_UPDATE)) { 

/*------------------------------------------------------Update Record------------------------------------------------------*/
DEBUGLOG(("Authorize()::cAction()::Update\n"));

/*---------------Check File Exist---------------*/
DEBUGLOG(("Authorize() CheckFileIdExist()\n"));

				sprintf(csTag,"%s",csFileId);
DEBUGLOG(("Authorize()::file_id = [%s]\n",csTag));

                		snprintf(csFileName,sizeof(csFileName),"SF%s",csFileId);
DEBUGLOG(("Authorize() file_name = [%s]\n",csFileName));

                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist");
                		if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));
		
/*---------------Get Statement Tmp (Last Ver Record) Detail---------------*/

/* seq */
					sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);
                        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                		iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() seq = [%d]\n", iSeq));
                                		PutField_Int(hContext,"seq",iSeq);
                        		} else {

                                		iRet = INT_STATEMENT_SEQ_NOT_FOUND;
                                		PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() seq not found!!\n");
                      			}

					if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastVerRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,iSeq,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::iRet = [%d]\n",iRet));
                                		if (iRet == PD_OK) {

/* ver */
                                        		if (GetField_Int(hRecDetailGet,"ver",&iLastVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::ver = [%d]\n",iLastVer));
                                        		}

/* latest_ver */
                                        		if (GetField_Int(hRecDetailGet,"latest_ver",&iLatestVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::latest_ver = [%d]\n",iLatestVer));
                                        		}

/* org_sys_seq */
                                        		if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
                                        		}

/* sys_seq */
                                        		if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::sys_seq = [%d]\n",iSysSeq));
                                        		}

#if 0
/* user_seq */
                                        		if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::user_seq = [%d]\n",iUserSeq));
                                        		}
#endif

#if 0
/* skip */
                                        		if (GetField_Int(hRecDetailGet,"skip",&iSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::skip = [%d]\n",iSkip));
                                        		}

/* mask_skip */
                                        		if (GetField_Int(hRecDetailGet,"mask_skip",&iMaskSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::mask_skip = [%d]\n",iMaskSkip));
                                        		}
#endif

                                		} else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetLastVerRecDetail() failed!!\n");
                                		}
					}

/*---------------Check Ver---------------*/ 
					if (iRet == PD_OK) {
/* ver */
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
	                        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
        	                        		iVer = atoi(csTmp);
DEBUGLOG(("Authorize() ver = [%d]\n", iVer));
                	               	 		PutField_Int(hContext, "ver",iVer);
                        			} else {
                                			iRet = INT_STATEMENT_VER_NOT_FOUND;
                                			PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() ver not found!!\n"));
ERRLOG("TnOmtByUsBSE:: Authorize() ver not found!!\n");
                       	 			}
					}
	
					if (iRet == PD_OK) {
						if (iVer <= iLastVer) {
							iRet = INT_STATEMENT_INVALID_VER;
DEBUGLOG(("Authorize() CheckRecVer:: ver <= last_ver \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecVer() failed!!\n");
						}
					}

/*---------------Update Statement Tmp Detail---------------*/
					if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateRecDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::seq = [%d]\n",iSeq));

/* ver */
                                		PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateRecDetail::ver = [%d]\n",iVer));

/* latest_ver */
                                		PutField_Int(hRecDetailPut, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() UpdateRecDetail::latest_ver = [%d]\n",iLatestVer));

/* org_sys_seq */
                                		PutField_Int(hRecDetailPut, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::org_sys_seq = [%d]\n",iOrgSysSeq));

/* sys_seq */
                                		PutField_Int(hRecDetailPut, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::sys_seq = [%d]\n",iSysSeq));

/* user_seq */
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
              	          			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n",iUserSeq));				
*/

#if 0
/* skip */
                                		PutField_Int(hRecDetailPut, "skip",iSkip);
DEBUGLOG(("Authorize() UpdateRecDetail::skip = [%d]\n",iSkip));

/* mask_skip */
                                		PutField_Int(hRecDetailPut, "mask_skip",iMaskSkip);
DEBUGLOG(("Authorize() UpdateRecDetail::mask_skip = [%d]\n",iMaskSkip));
#endif

/* update_user */
                                		PutField_CString(hRecDetailPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateRecDetail::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateRecDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateRecDetail() FAILURE!!!\n");
                                		}
                        		}

/*---------------Add Statement Tmp Detail---------------*/
                        if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hContext,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
                                		PutField_Int(hContext, "seq",iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n",iSeq));

/* ver */
                                		PutField_Int(hContext, "ver",iVer);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));

#if 0
/* latest_ver */
						iLatestVer = 0;
                                		PutField_Int(hContext, "latest_ver",iLatest_Ver);
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif

/* org_sys_seq */
                                		PutField_Int(hContext, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));

/* sys_seq */
                                		PutField_Int(hContext, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));

/* user_seq */
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hContext, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hContext, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/

/* disabled */
						iDisabled = 0;
                                		PutField_Int(hContext, "disabled",iDisabled);
DEBUGLOG(("Authorize() AddDetail::disabled = [%d]\n",iDisabled));

/* skip */
						sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iTmp));
                                        		PutField_Int(hContext, "skip",iTmp);
                                		}

/* mask_skip */
						sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n", iTmp));
                                        		PutField_Int(hContext, "mask_skip",iTmp);
                                		}

#if 0
/* int_bank_code */
						sprintf(csTag, "%s_int_bank_code_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"int_bank_code",csTmp);
                                		}

/* bank_acct_num */
						sprintf(csTag, "%s_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"bank_acct_num",csTmp);
                                		}

/* raw_date */
						sprintf(csTag, "%s_raw_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"raw_date",csTmp);
                                		}

/* raw_time */
						sprintf(csTag, "%s_rwa_time_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"raw_time",csTmp);
                                		}
#endif

/* statement_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_date = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"statement_date",csTmp);
                                		}

/* statement_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
   		                             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csTmp));
                 		                       PutField_CString(hContext,"statement_time",csTmp);
                        		        }

/* tfr_bank_name */
						sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_bank_name",csTmp);
                                		}

/* tfr_bank_acct_num */
						sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_bank_acct_num",csTmp);
                                		}

/* tfr_type */
						sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_type",csTmp);
                                		}

/* tfr_channel */
						sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_channel",csTmp);
                                		}

/* tft_text */
						sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_text = [%s]\n", csTmp));
                                        		PutField_CString(hContext,"tfr_text",csTmp);
                                		}

/* tfr_customer_text */
						sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, j+1);
                   		             	if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n",csTmp));
                                		        PutField_CString(hContext,"tfr_customer_text",csTmp);
                                		}

/* sender_name */
						sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::sender_name = [%s]\n",csTmp));
                                        		PutField_CString(hContext,"sender_name",csTmp);
                                		}

/* txn_ref_num */
						sprintf(csTag, "%s_tfr_ref_num_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n",csTmp));
                                 		       PutField_CString(hContext,"txn_ref_num",csTmp);
                                		}

/* balance */
						sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, j+1);
		                                if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                		                        dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::balance = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"balance",dTmp);
							PutField_CString(hContext,"balance",csTmp);
						}

/* amt_type */
						sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, j+1);
		                                if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n",csTmp));
                		                        PutField_CString(hContext,"amt_type",csTmp);
                                		}

/* txn_amount */
						sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, j+1);
                                		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"txn_amount",dTmp);
							PutField_CString(hContext,"txn_amount",csTmp);
						}

/* bank_charge */
						sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, j+1);
						if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                        		dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"bank_charge",dTmp);
							PutField_CString(hContext,"bank_charge",csTmp);
						}

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                                		DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                                		iRet = (unsigned long)(*DBObjPtr)(hContext);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
                                		}
                        		}

/*---------------Get Statement Header---------------*/
					if (iRet == PD_OK) {

                                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                                		if (iRet == PD_OK) {

/* skip_count */
                                        		if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                        		}

/* hold_count */
                                        		if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                        		}

/* accept_count */
                                        		if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                        		}

/* total_count */
                                        		if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                        		}

/* ver */
                                        		if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                        		}

/* split_count */
                                        		if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                        		}

/* add_count */
                                        		if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                        		}

/* update_count */
                                        		if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::update_count = [%d]\n",iUpdateCount));
                                        		}

/* delete_count */
                                       	 		if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                        		}

/* file_count */
                                        		if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                        		}
                                		}
                                		else {
                                        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                                		}
                        		}

/*---------------Update Statement Header---------------*/
                        		if (iRet == PD_OK) {

/* file_id */
                                		PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                                		PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));

/* hold_count */
                                		PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                                		PutField_Int(hRecHeaderPut, "accept_count",iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                                		PutField_Int(hRecHeaderPut, "total_count",iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer)
						{
                                			PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iVer));
						} else {
                                			PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n",iHeaderVer));
						}
	
/* split_count */
                                		PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                               			PutField_Int(hRecHeaderPut, "add_count",iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* update_count */
                                		PutField_Int(hRecHeaderPut, "update_count",++iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                                		PutField_Int(hRecHeaderPut, "delete_count",iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                                		PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                                		PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update()\n"));

                               	 		DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                                		iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                                		if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(UpdateHeader)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                                		}
                        		}
				}
                		else {
                        		iRet = INT_FILE_ID_NOT_FOUND;
DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
ERRLOG("TxnOmtByUsBSE::Authorize::ValidateProcess::CheckFileIdExist:: failed!!\n");
                		}	
			}

			else if ((iRet == PD_OK) && (cAction == PD_ACTION_DELETE)) { 	

/*------------------------------------------------------Delete Record------------------------------------------------------*/
DEBUGLOG(("Authorize()::cAction()::Delete\n"));

/*---------------Check File Exist---------------*/
DEBUGLOG(("Authorize() CheckFileIdExist()\n"));

				sprintf(csTag,"%s",csFileId);
DEBUGLOG(("Authorize() file_id = [%s]\n",csTag));

                		snprintf(csFileName,sizeof(csFileName),"SF%s",csFileId);
DEBUGLOG(("Authorize() file_name = [%s]\n",csFileName));

                		DBObjPtr = CreateObj(DBPtr,"DBOLStatement","CheckFileIdExist"); 
				if ((unsigned long)(*DBObjPtr)(csTag) == FOUND) {
DEBUGLOG(("Authorize() call DBOLStatement(CheckFileIdExist)::File Exist()!!!\n"));

/*---------------Get Statement Tmp (Last Ver Record) Detail---------------*/

/* seq */
					sprintf(csTag, "%s_seq_%d", PD_DETAIL_TAG, j+1);		
					if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                				iSeq = atoi(csTmp);
DEBUGLOG(("Authorize() seq = [%d]\n", iSeq));
                				PutField_Int(hContext,"seq",iSeq);
       	 				} else {
						iRet = INT_STATEMENT_SEQ_NOT_FOUND;
						PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() seq not found!!\n"));
ERRLOG("TxnOmtByUsBSE:: Authorize() seq not found!!\n");
        				}

					if (iRet == PD_OK) {
              					DBObjPtr = CreateObj(DBPtr,"DBOLStatementTmp","GetLastVerRecDetail");
                   				iRet = (unsigned long)(*DBObjPtr)(csFileId,iSeq,hRecDetailGet);
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* disabled */
							if (GetField_Int(hRecDetailGet,"disabled",&iDisabled)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::disabled = [%d]\n",iDisabled));
                               				}

/* ver */
                             				if (GetField_Int(hRecDetailGet,"ver",&iLastVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::ver = [%d]\n",iLastVer));
                            				}

/* latest_ver */
                             				if (GetField_Int(hRecDetailGet,"latest_ver",&iLatestVer)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::latest_ver = [%d]\n",iLatestVer));
                              				}

/* org_sys_seq */
                             				if (GetField_Int(hRecDetailGet,"org_sys_seq",&iOrgSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::org_sys_seq = [%d]\n",iOrgSysSeq));
                           				}

/* sys_seq */
                             				if (GetField_Int(hRecDetailGet,"sys_seq",&iSysSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::sys_seq = [%d]\n",iSysSeq));
                            				}

#if 0
/* user_seq */
                              				if (GetField_Int(hRecDetailGet,"user_seq",&iUserSeq)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::user_seq = [%d]\n",iUserSeq));
                               				}
#endif

#if 0
/* skip */
                              				if (GetField_Int(hRecDetailGet,"skip",&iSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::skip = [%d]\n",iSkip));
                                			}

/* mask_skip */
                            				if (GetField_Int(hRecDetailGet,"mask_skip",&iMaskSkip)) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(GetLastVerRecDetail)::mask_skip = [%d]\n",iMaskSkip));
                               				}
#endif

                        			}
                        			else {
                                			iRet = INT_ERR;
DEBUGLOG(("Authorize:: call DBOLStatementTmp(GetLastVerRecDetail):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: GetLastVerRecDetail:: failed!!\n");
                        			}
					}

/*---------------Check Disabled and Ver---------------*/ 
					if (iRet == PD_OK) {
/* ver */
						sprintf(csTag, "%s_ver_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iVer = atoi(csTmp);
DEBUGLOG(("Authorize() ver = [%d]\n", iVer));
                                			PutField_Int(hContext, "ver",iVer);
                        			} else {
                                			iRet = INT_STATEMENT_VER_NOT_FOUND;
                                			PutField_Int(hContext,"internal_error",iRet);
DEBUGLOG(("Authorize() ver not found!!\n"));
ERRLOG("TnOmtByUsBSE:: Authorize() ver not found!!\n");
                       	 			}
					}

					if (iRet == PD_OK) {
						if (iDisabled == 1) {
							iRet = INT_STATEMENT_RECORD_DELETED;
DEBUGLOG(("Authorize() CheckRecDisabled:: disabled = [%d]\n", iDisabled));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecDisabled failed!!\n");
						} else if (iVer <= iLastVer) {
							iRet = INT_STATEMENT_INVALID_VER;
DEBUGLOG(("Authorize() CheckRecVer:: ver <= last_ver \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckRecVer failed!!\n");
						}
					}

/*---------------Update Statement Tmp Detail---------------*/ 
             				if (iRet == PD_OK) {

/* file_id */     
	        				PutField_CString(hRecDetailPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateRecDetail::file_id = [%s]\n",csFileId));
             
/* seq */
                       	 			PutField_Int(hRecDetailPut, "seq",iSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::seq = [%d]\n",iSeq));

/* ver */
		       				PutField_Int(hRecDetailPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateRecDetail::ver = [%d]\n",iVer));

/* latest_ver */
                      				PutField_Int(hRecDetailPut, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() UpdateRecDetail::latest_ver = [%d]\n",iLatestVer));
        
/* org_sys_seq */
	              				PutField_Int(hRecDetailPut, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
         
/* sys_seq */	
	              				PutField_Int(hRecDetailPut, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::sys_seq = [%d]\n",iSysSeq));

/* user_seq */	
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                        			if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                                			iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
                        			}

/*
						PutField_Int(hRecDetailPut, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() UpdateRecDetail::user_seq = [%d]\n",iUserSeq));
*/

#if 0
/* skip */
                                		PutField_Int(hRecDetailPut, "skip",iSkip);
DEBUGLOG(("Authorize() UpdateRecDetail::skip = [%d]\n",iSkip));

/* mask_skip */
                                		PutField_Int(hRecDetailPut, "mask_skip",iMaskSkip);
DEBUGLOG(("Authorize() UpdateRecDetail::mask_skip = [%d]\n",iMaskSkip));
#endif

/* update_user */
                               			PutField_CString(hRecDetailPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateRecDetail::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update()\n"));

                     				DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "UpdateRecDetail");
                     				iRet = (unsigned long)(*DBObjPtr)(hRecDetailPut);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(UpdateRecDetail)::Update() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: UpdateRecDetail() FAILURE!!!\n");
                     				}
           				}

/*---------------Add Statement Tmp Detail---------------*/
             				if (iRet == PD_OK) {

/* file_id */
                     				PutField_CString(hContext,"file_id",csFileId);
DEBUGLOG(("Authorize() AddDetail::file_id = [%s]\n",csFileId));

/* seq */
                        			PutField_Int(hContext, "seq",iSeq);
DEBUGLOG(("Authorize() AddDetail::seq = [%d]\n",iSeq));
             
/* ver */
		       				PutField_Int(hContext, "ver",iVer);
DEBUGLOG(("Authorize() AddDetail::ver = [%d]\n",iVer));
         
#if 0
/* latest_ver */
						iLatestVer = 0;
	             				PutField_Int(hContext, "latest_ver",iLatestVer);
DEBUGLOG(("Authorize() AddDetail::latest_ver = [%d]\n",iLatestVer));
#endif     
           
/* org_sys_seq */
	             				PutField_Int(hContext, "org_sys_seq",iOrgSysSeq);
DEBUGLOG(("Authorize() AddDetail::org_sys_seq = [%d]\n",iOrgSysSeq));
                 
/* sys_seq */
		      				PutField_Int(hContext, "sys_seq",iSysSeq);
DEBUGLOG(("Authorize() AddDetail::sys_seq = [%d]\n",iSysSeq));
	
/* user_seq */	
						sprintf(csTag, "%s_user_seq_%d", PD_DETAIL_TAG, j+1);
                	        		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                        	        		iUserSeq = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n", iUserSeq));
                                			PutField_Int(hContext, "user_seq",iUserSeq);
                        			} 

/*
						PutField_Int(hContext, "user_seq",iUserSeq);
DEBUGLOG(("Authorize() AddDetail::user_seq = [%d]\n",iUserSeq));
*/
          
/* disabled */
	         				PutField_Int(hContext, "disabled",1);
DEBUGLOG(("Authorize() AddDetail::disabled = [1]\n"));

/* skip */
						sprintf(csTag, "%s_skip_%d", PD_DETAIL_TAG, j+1);
		                       		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
        		                     		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::skip = [%d]\n", iTmp));
                          				PutField_Int(hContext, "skip",iTmp);
                     				}

/* mask_skip */
						sprintf(csTag, "%s_mask_skip_%d", PD_DETAIL_TAG, j+1);
		                     		if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                		              		iTmp = atoi(csTmp);
DEBUGLOG(("Authorize() AddDetail::mask_skip = [%d]\n", iTmp));
                               				PutField_Int(hContext, "mask_skip",iTmp);
                       				}

#if 0	
/* int_bank_code */
						sprintf(csTag, "%s_int_bank_code_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::int_bank_code = [%s]\n", csTmp));
                             				PutField_CString(hContext,"int_bank_code",csTmp);
                      				}

/* bank_acct_num */
						sprintf(csTag, "%s_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                      				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::bank_acct_num = [%s]\n", csTmp));
                        	     			PutField_CString(hContext,"bank_acct_num",csTmp);
                     				}

/* raw_date */
						sprintf(csTag, "%s_raw_date_%d", PD_DETAIL_TAG, j+1);
                      				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_date = [%s]\n", csTmp));
                    		          		PutField_CString(hContext,"raw_date",csTmp);
                      				}

/* raw_time */
						sprintf(csTag, "%s_raw_time_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::raw_time = [%s]\n", csTmp));
                              				PutField_CString(hContext,"raw_time",csTmp);
                      				}
#endif

/* statement_date */
						sprintf(csTag, "%s_statement_date_%d", PD_DETAIL_TAG, j+1);
                      				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_date = [%s]\n", csTmp));
                           				PutField_CString(hContext,"statement_date",csTmp);
                    				}

/* statement_time */
						sprintf(csTag, "%s_statement_time_%d", PD_DETAIL_TAG, j+1);
                     				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::statement_time = [%s]\n", csTmp));
                        	     			PutField_CString(hContext,"statement_time",csTmp);
                     				}

/* tfr_bank_name */
						sprintf(csTag, "%s_tfr_bank_name_%d", PD_DETAIL_TAG, j+1);
                				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_name = [%s]\n", csTmp));
                        	    			PutField_CString(hContext,"tfr_bank_name",csTmp);
                      				}

/* tfr_bank_acct_num */
						sprintf(csTag, "%s_tfr_bank_acct_num_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_bank_acct_num = [%s]\n", csTmp));
                        	     			PutField_CString(hContext,"tfr_bank_acct_num",csTmp);
                      				}

/* tfr_type */
						sprintf(csTag, "%s_tfr_type_%d", PD_DETAIL_TAG, j+1);
                      				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_type = [%s]\n", csTmp));
                        	    			PutField_CString(hContext,"tfr_type",csTmp);
                      				}

/* tfr_channel */
						sprintf(csTag, "%s_tfr_channel_%d", PD_DETAIL_TAG, j+1);
                     				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_channel = [%s]\n", csTmp));
                        	   			PutField_CString(hContext,"tfr_channel",csTmp);
                        			}

/* tft_text */
						sprintf(csTag, "%s_tfr_text_%d", PD_DETAIL_TAG, j+1);
                     				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_text = [%s]\n", csTmp));
                        	    			PutField_CString(hContext,"tfr_text",csTmp);
                     				}

/* tfr_customer_text */
						sprintf(csTag, "%s_tfr_customer_text_%d", PD_DETAIL_TAG, j+1);
                      				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::tfr_customer_text = [%s]\n",csTmp));
                        	     			PutField_CString(hContext,"tfr_customer_text",csTmp);
                       				}

/* sender_name */
						sprintf(csTag, "%s_tfr_sender_name_%d", PD_DETAIL_TAG, j+1);
                     				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::sender_name = [%s]\n",csTmp));
                              				PutField_CString(hContext,"sender_name",csTmp);
                      				}

/* txn_ref_num */
						sprintf(csTag, "%s_tfr_ref_num_%d", PD_DETAIL_TAG, j+1);
                    				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::txn_ref_num = [%s]\n",csTmp));
                        	    			PutField_CString(hContext,"txn_ref_num",csTmp);
                       				}

/* balance */
						sprintf(csTag, "%s_balance_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                        	     			dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::balance = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"balance",dTmp);
                               				PutField_CString(hContext,"balance",csTmp);
                      				}

/* amt_type */
						sprintf(csTag, "%s_amt_type_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
DEBUGLOG(("Authorize() AddDetail::amt_type = [%s]\n",csTmp));
                        	      			PutField_CString(hContext,"amt_type",csTmp);
                     				}

/* txn_amount */
						sprintf(csTag, "%s_txn_amount_%d", PD_DETAIL_TAG, j+1);
                       				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                       		      			dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::txn_amount = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"txn_amount",dTmp);
                        	     			PutField_CString(hContext,"txn_amount",csTmp);
                    				}

/* bank_charge */
						sprintf(csTag, "%s_bank_charge_%d", PD_DETAIL_TAG, j+1);	
                     				if (GetField_CString(hRecTemp, csTag, &csTmp)) {
                     	        			dTmp = atof(csTmp);
DEBUGLOG(("Authorize() AddDetail::bank_charge = [%.2f]\n",dTmp));
							//PutField_Double(hContext,"bank_charge",dTmp);
                	             			PutField_CString(hContext,"bank_charge",csTmp);
                	     	 		}

DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add()\n"));

                	     			DBObjPtr = CreateObj(DBPtr, "DBOLStatementTmp", "AddDetail");
                     				iRet = (unsigned long)(*DBObjPtr)(hContext);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatementTmp(AddDetail)::Add() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatementTmp:: AddDetail() FAILURE!!!\n");
                     				}
           				}

/*---------------Get Statement Header---------------*/
                        		if (iRet == PD_OK) {

                       	 			DBObjPtr = CreateObj(DBPtr,"DBOLStatement","GetHeader");
                        			iRet = (unsigned long)(*DBObjPtr)(csFileId,hRecHeaderGet);
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::iRet = [%d]\n",iRet));

                        			if (iRet == PD_OK) {

/* skip_count */
                                			if (GetField_Int(hRecHeaderGet,"skip_count",&iSkipCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::skip_count = [%d]\n",iSkipCount));
                                			}

/* hold_count */
                                			if (GetField_Int(hRecHeaderGet,"hold_count",&iHoldCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::hold_count = [%d]\n",iHoldCount));
                                			}

/* accept_count */
                                			if (GetField_Int(hRecHeaderGet,"accept_count",&iAcceptCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::accept_count = [%d]\n",iAcceptCount));
                                			}

/* total_count */
                                			if (GetField_Int(hRecHeaderGet,"total_count",&iTotalCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::total_count = [%d]\n",iTotalCount));
                                			}

/* ver */
                                			if (GetField_Int(hRecHeaderGet,"ver",&iHeaderVer)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::ver = [%d]\n",iHeaderVer));
                                			}

/* split_count */
                                			if (GetField_Int(hRecHeaderGet,"split_count",&iSplitCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::split_count = [%d]\n",iSplitCount));
                                			}

/* add_count */
                                			if (GetField_Int(hRecHeaderGet,"add_count",&iAddCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::add_count = [%d]\n",iAddCount));
                                			}

/* update_count */
                                			if (GetField_Int(hRecHeaderGet,"update_count",&iUpdateCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::update_count = [%d]\n",iUpdateCount));
                                			}

/* delete_count */
                                			if (GetField_Int(hRecHeaderGet,"delete_count",&iDeleteCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::delete_count = [%d]\n",iDeleteCount));
                                			}

/* file_count */
                                			if (GetField_Int(hRecHeaderGet,"file_count",&iFileCount)) {
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader)::file_count = [%d]\n",iFileCount));
                                			}
                        			}
                        			else {
                        	        		iRet = INT_ERR;
DEBUGLOG(("Authorize() call DBOLStatement(GetHeader):: failed\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: GetHeader() failed!!\n");
                        			}
					}

/*---------------Update Statement Header---------------*/
					if (iRet == PD_OK) {

/* file_id */
                     				PutField_CString(hRecHeaderPut,"file_id",csFileId);
DEBUGLOG(("Authorize() UpdateHeader::file_id = [%s]\n",csFileId));

/* skip_count */
                     				PutField_Int(hRecHeaderPut, "skip_count",iSkipCount);
DEBUGLOG(("Authorize() UpdateHeader::skip_count = [%d]\n",iSkipCount));
                       	
/* hold_count */
						PutField_Int(hRecHeaderPut, "hold_count",iHoldCount);
DEBUGLOG(("Authorize() UpdateHeader::hold_count = [%d]\n",iHoldCount));

/* accept_count */
                       				PutField_Int(hRecHeaderPut, "accept_count",++iAcceptCount);
DEBUGLOG(("Authorize() UpdateHeader::accept_count = [%d]\n",iAcceptCount));

/* total_count */
                      				PutField_Int(hRecHeaderPut, "total_count",++iTotalCount);
DEBUGLOG(("Authorize() UpdateHeader::total_count = [%d]\n",iTotalCount));

/* ver */
						if (iVer > iHeaderVer) {
                       					PutField_Int(hRecHeaderPut, "ver",iVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n,iVer"));
						} else {
                       					PutField_Int(hRecHeaderPut, "ver",iHeaderVer);
DEBUGLOG(("Authorize() UpdateHeader::ver = [%d]\n,iiHeaderVer"));
						}

/* split_count */
                      				PutField_Int(hRecHeaderPut, "split_count",iSplitCount);
DEBUGLOG(("Authorize() UpdateHeader::split_count = [%d]\n",iSplitCount));

/* add_count */
                     				PutField_Int(hRecHeaderPut, "add_count",iAddCount);
DEBUGLOG(("Authorize() UpdateHeader::add_count = [%d]\n",iAddCount));

/* update_count */
                      				PutField_Int(hRecHeaderPut, "update_count",iUpdateCount);
DEBUGLOG(("Authorize() UpdateHeader::update_count = [%d]\n",iUpdateCount));

/* delete_count */
                      				PutField_Int(hRecHeaderPut, "delete_count",++iDeleteCount);
DEBUGLOG(("Authorize() UpdateHeader::delete_count = [%d]\n",iDeleteCount));

/* file_count */
						iFileCount = iSplitCount + iAddCount - iDeleteCount;
                       				PutField_Int(hRecHeaderPut, "file_count",iFileCount);
DEBUGLOG(("Authorize() UpdateHeader::file_count = [%d]\n",iFileCount));

/* update_user */
                       	 			PutField_CString(hRecHeaderPut,"update_user",csUser);
DEBUGLOG(("Authorize() UpdateHeader::update_user = [%s]\n",csUser));

DEBUGLOG(("Authorize() call DBOLStatement(DBOLStatement)::UpdateHeader()\n"));

                      				DBObjPtr = CreateObj(DBPtr, "DBOLStatement", "UpdateHeader");
                    				iRet = (unsigned long)(*DBObjPtr)(hRecHeaderPut);
                       				if (iRet != PD_OK) {
DEBUGLOG(("Authorize() call DBOLStatement(DBOLStatement)::UpdateHeader() FAILURE!!!\n"));
ERRLOG("TxnOmtByUsBSE::Authorize() call DBOLStatement:: UpdateHeader() FAILURE!!!\n");
                    				}
               				}
				}
				else {
                        		iRet = INT_FILE_ID_NOT_FOUND;
DEBUGLOG(("Authorize() call DBOLStatement::File Not Exist()!!! \n"));
ERRLOG("TxnOmtByUsBSE::Authorize() CheckFileIdExist:: failed!!\n");
                		}
			}
		}
	}

	if (iRet != PD_OK) {
		PutField_Int(hContext, "internal_error", iRet);
	}

        FREE_ME(csKey);
        FREE_ME(csKeyCode);
        FREE_ME(csData);
        FREE_ME(csDataCode);
        FREE_ME(hRecTemp);

	FREE_ME(hRecHeaderGet);
	FREE_ME(hRecHeaderPut);
	FREE_ME(hRecDetailGet);
	FREE_ME(hRecDetailPut);

DEBUGLOG(("Authorize() Normal Exit! iRet = [%d]\n", iRet));
	return iRet;
}
