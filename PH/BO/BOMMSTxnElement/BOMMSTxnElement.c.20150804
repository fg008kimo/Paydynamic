/*
Partnerdelight (c)2011. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2015/06/16              Cody Chan
Changed to hash_t*
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "myhash.h"
#include "myrecordset.h"
#include "internal.h"
#include "common.h"
#include "BOMMSTxnElement.h"

char    cDebug;
OBJPTR(DB);
OBJPTR(BO);

void BOMMSTxnElement(char    cdebug)
{
	cDebug = cdebug;
}

int     AddTxnElement(hash_t *hReq)
{
	int 	iRet = PD_OK;
	hash_t	*hData;
	char	*csTxnSeq;
	char	*csPtr;
	double	dTmp;
	
DEBUGLOG(("BOMMSTxnElement::AddTxnElement ()\n"));
	hData = (hash_t*)  malloc (sizeof(hash_t));
	hash_init(hData,0);

/* txn seq */
	if (GetField_CString(hReq,"txn_seq",&csTxnSeq)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElement txn_seq = [%s]\n",csTxnSeq));
		PutField_CString(hData,"txn_id",csTxnSeq);
	}
	else {
DEBUGLOG(("BOMMSTxnElement::AddTxnElement txn_seq not found\n"));
ERRLOG("BOMMSTxnElement::AddTxnElement txn_seq not found\n");
		iRet = PD_ERR;
	}


/* txn_element_type */
	if (GetField_CString(hReq,"txn_element_type",&csPtr)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElement txn_elelemt_type = [%s]\n",csPtr));
		PutField_CString(hData,"txn_element_type",csPtr);
	}

/* amt */
	if (GetField_Double(hReq,"amount",&dTmp)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElement amount = [%lf]\n",dTmp));
		if (dTmp >= 0.0)  {
			PutField_CString(hData,"amt_type",PD_CR);
			PutField_Double(hData,"amount",dTmp);
		}
		else {
			PutField_CString(hData,"amt_type",PD_DR);
			PutField_Double(hData,"amount",dTmp *(-1));
		}
	}
		
/* ccy */
	if (GetField_CString(hReq,"ccy",&csPtr)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElement elelemt_type = [%s]\n",csPtr));
		PutField_CString(hData,"ccy",csPtr);
	}
		

	DBObjPtr = CreateObj(BOPtr,"DBMmsTxnElement","Add");
       	iRet = (unsigned long)((DBObjPtr)(hData));
DEBUGLOG(("BOMMSTxnElement::AddTxnElement return from DBMmsTxnElement:Add iRet = [%d]\n",iRet));
	
	FREE_ME(hData);
DEBUGLOG(("BOMMSTxnElement::AddTxnElement () iRet = [%d]\n",iRet));
	return iRet;	
}

