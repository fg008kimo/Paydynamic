/*
Partnerdelight (c)2011. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2015/06/16              Cody Chan
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "myhash.h"
#include "myrecordset.h"
#include "internal.h"
#include "common.h"
#include "BOMMSTxnElements.h"

char    cDebug;
OBJPTR(DB);
OBJPTR(BO);

void BOMMSTxnElements(char    cdebug)
{
	cDebug = cdebug;
}

int     AddTxnElements(hash_t *hContext, recordset_t *rRecordSet)
{
	int 	iRet = PD_OK;
	hash_t	*hRec,*hData;
	char	*csTxnSeq;
	char	*csPtr;
	double	dTmp;
	
DEBUGLOG(("BOMMSTxnElement::AddTxnElements ()\n"));
	hData = (hash_t*)  malloc (sizeof(hash_t));
	hash_init(hData,0);

	if (GetField_CString(hContext,"txn_seq",&csTxnSeq)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements txn_seq = [%s]\n",csTxnSeq));
	}
	else {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements txn_seq not found\n"));
ERRLOG("BOMMSTxnElement::AddTxnElements txn_seq not found\n");
		iRet = PD_ERR;
	}

	hRec = RecordSet_GetFirst(rRecordSet);
	while (hRec && iRet == PD_OK) {
		hash_init(hData,0);

/* txn seq */
		PutField_CString(hData,"txn_id",csTxnSeq);

/* txn_element_type */
		if (GetField_CString(hRec,"txn_element_type",&csPtr)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements txn_elelemt_type = [%s]\n",csPtr));
			PutField_CString(hData,"txn_element_type",csPtr);
		}
/* amt */
		if (GetField_Double(hRec,"amount",&dTmp)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements amount = [%lf]\n",dTmp));
			PutField_Double(hData,"amount",dTmp);
		}
		
/* ccy */
		if (GetField_CString(hRec,"ccy",&csPtr)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements elelemt_type = [%s]\n",csPtr));
			PutField_CString(hData,"ccy",csPtr);
		}
		
/* amt_type */
		if (GetField_CString(hRec,"amt_type",&csPtr)) {
DEBUGLOG(("BOMMSTxnElement::AddTxnElements amt_type = [%s]\n",csPtr));
			PutField_CString(hData,"amt_type",csPtr);
		}

		DBObjPtr = CreateObj(BOPtr,"DBMmsTxnElement","Add");
        	iRet = (unsigned long)((DBObjPtr)(hData));
DEBUGLOG(("BOMMSTxnElement::AddTxnElements return from DBMmsTxnElement:Add iRet = [%d]\n",iRet));
		if (iRet != PD_OK) 
			break;
		hRec = RecordSet_GetNext(rRecordSet);
	}
	
	FREE_ME(hData);
DEBUGLOG(("BOMMSTxnElement::AddTxnElements () iRet = [%d]\n",iRet));
	return iRet;	
}

