/*
Partnerdelight (c)2011. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2015/06/16              Cody Chan
Changed to hash_t*
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "myhash.h"
#include "myrecordset.h"
#include "internal.h"
#include "common.h"
#include "BOMMSPhTxn.h"

char    cDebug;
OBJPTR(DB);
OBJPTR(BO);

void BOMMSPhTxn(char    cdebug)
{
	cDebug = cdebug;
}

int     AddLog(hash_t *hContext,const hash_t* hRequest)
{
	int 	iRet = PD_OK;
	char	*csPtr;
	double	dTmp;
	hash_t	*hData;

DEBUGLOG(("BOMMSPhTxn:AddLog()\n"));
	hData = (hash_t*)  malloc (sizeof(hash_t));
        hash_init(hData,0);

/* node_id */
	if (GetField_CString(hRequest,"req_node_id",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog req_node_id = [%s]\n",csPtr));
		PutField_CString(hData,"node_id",csPtr);
	}

/* ph_txn_id */
	if (GetField_CString(hRequest,"node_ref",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog node_ref = [%s]\n",csPtr));
		PutField_CString(hData,"ph_txn_id",csPtr);
	}

/* client_id */
	if (GetField_CString(hRequest,"client_id",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog client_id = [%s]\n",csPtr));
		PutField_CString(hData,"client_id",csPtr);
	}

/* psp_id */
	if (GetField_CString(hRequest,"psp_id",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog psp_id = [%s]\n",csPtr));
		PutField_CString(hData,"psp_id",csPtr);
	}

/* baid */
	if (GetField_CString(hRequest,"baid",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog baid = [%s]\n",csPtr));
		PutField_CString(hData,"baid",csPtr);
	}

/* transmission_datetime */
	if (GetField_CString(hRequest,"transmission_datetime",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog transmission_datetime = [%s]\n",csPtr));
		PutField_CString(hData,"transmission_datetime",csPtr);
	}

/* tm_date */
	if (GetField_CString(hRequest,"tm_date",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog tm_date = [%s]\n",csPtr));
		PutField_CString(hData,"tm_date",csPtr);
	}

/* tm_time */
	if (GetField_CString(hRequest,"tm_time",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog tm_time = [%s]\n",csPtr));
		PutField_CString(hData,"tm_time",csPtr);
	}

/* txn_amt */
	if (GetField_Double(hContext,"txn_amt",&dTmp)){
DEBUGLOG(("BOMMSPhTxn:AddLog txn_amt = [%lf]\n",dTmp));
		PutField_Double(hData,"txn_amt",dTmp);
	}

/* txn_ccy */
	if (GetField_CString(hRequest,"txn_ccy",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog txn_ccy = [%s]\n",csPtr));
		PutField_CString(hData,"txn_ccy",csPtr);
	}

/* local_tm_date */
	if (GetField_CString(hContext,"local_tm_date",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog local_tm_date = [%s]\n",csPtr));
		PutField_CString(hData,"local_tm_date",csPtr);
	}

/* local_tm_time */
	if (GetField_CString(hContext,"local_tm_time",&csPtr)){
DEBUGLOG(("BOMMSPhTxn:AddLog local_tm_time = [%s]\n",csPtr));
		PutField_CString(hData,"local_tm_time",csPtr);
	}

	PutField_CString(hData,"add_user",PD_UPDATE_USER);

	DBObjPtr = CreateObj(BOPtr,"DBMmsPHTransaction","Add");
        iRet = (unsigned long)((DBObjPtr)(hData));

	FREE_ME(hData);
	FREE_ME(hData);
DEBUGLOG(("BOMMSPhTxn:AddLog()iRet = [%d]\n",iRet));
	return iRet;
}
