/*
Partnerdelight (c)2011. All rights reserved. No part of this software may be reproduced in any form without written permission
of an authorized representative of Partnerdelight.

Change Description                                 Change Date             Change By
-------------------------------                    ------------            --------------
Init Version                                       2011/04/27              Cody Chan
Add Count Request Txn Amt			   2012/01/17		   Cody Chan
*/

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "common.h"
#include "utilitys.h"
#include "ObjPtr.h"
#include "myhash.h"
#include "myrecordset.h"
#include "internal.h"
#include "common.h"
#include "BOStat.h"

char    cDebug;
OBJPTR(DB);

void BOStat(char    cdebug)
{
        cDebug = cdebug;
}

int UpdateDspStat(hash_t *hContext,
                        const hash_t *hRequest,
                        const hash_t *hResponse)
{
	int	iRet = PD_OK;
	char	*csOrgCountryId;
	char	*csOrgChannelCode;
	char	*csOrgServiceCode;
	char	*csOrgPayMethod;
	char	*csOrgPspId;
	char	*csOrgTxnCcy;
	char	*csOrgDstTxnCcy;
	char	*csTxnCode;
	double	dOrgDstTxnAmt;


        if (GetField_CString(hContext,"txn_code",&csTxnCode)) {
DEBUGLOG(("BOStat:UpdateDspStat() txn_code = [%s]\n",csTxnCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() txn_code not found!!!\n"));
        }

/*org country id */
        if (GetField_CString(hContext,"org_txn_country",&csOrgCountryId)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_txn_country = [%s]\n",csOrgCountryId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_txn_country is missing!!!\n"));
        }

/*org channel code */
        if (GetField_CString(hContext,"org_channel_code",&csOrgChannelCode)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_channel_code = [%s]\n",csOrgChannelCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_channel_code is missing!!!\n"));
        }

/*org sercice code */
        if (GetField_CString(hContext,"org_service_code",&csOrgServiceCode)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_service_code = [%s]\n",csOrgServiceCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_service_code is missing!!!\n"));
        }

/*org pay method */
        if (GetField_CString(hContext,"org_pay_method",&csOrgPayMethod)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_pay_method = [%s]\n",csOrgPayMethod));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_pay_method is missing!!!\n"));
		iRet = INT_ERR;
        }



/*org psp id */
        if (GetField_CString(hContext,"org_psp_id",&csOrgPspId)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_psp_id = [%s]\n",csOrgPspId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_psp_id is missing!!!\n"));
        }

/*org txn ccy */
        if (GetField_CString(hContext,"org_txn_ccy",&csOrgTxnCcy)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_txn_ccy = [%s]\n",csOrgTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_txn_ccy is missing!!!\n"));
        }

/*org psp_txn ccy */
        if (GetField_CString(hContext,"org_dst_txn_ccy",&csOrgDstTxnCcy)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_dst_txn_ccy = [%s]\n",csOrgDstTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_dst_txn_ccy is missing!!!\n"));
	}


/*org psp txn amount */
        if (GetField_Double(hContext,"org_dst_txn_amt",&dOrgDstTxnAmt)) {
DEBUGLOG(("BOStat:UpdateDspStat() org_dst_txn_amt = [%lf]\n",dOrgDstTxnAmt));
        }
	else {
DEBUGLOG(("BOStat:UpdateDstStat() org_dst_txn_amt is missing!!!\n"));
	}

	if(iRet == PD_OK){
		DBObjPtr = CreateObj(DBPtr,"DBTxnCounters","CounterCreate");
		if ((*DBObjPtr)(csTxnCode,
			csOrgCountryId,
			csOrgChannelCode,
			csOrgServiceCode,
			csOrgPayMethod,
			'P',
                        csOrgPspId,
                        csOrgDstTxnCcy,
			dOrgDstTxnAmt,
                        PD_UPDATE_USER) != PD_OK) {
                	iRet = INT_ERR;
DEBUGLOG(("BOStat:UpdateDspStat() CounterCreate Failed\n"));
		}
        }

DEBUGLOG(("BOStat:UpdateDspStat() iRet = [%d]\n",iRet));
	return iRet;
}

int UpdateDspMerchantStat(hash_t *hContext,
                        const hash_t *hRequest,
                        const hash_t *hResponse)
{
	int	iRet = PD_OK;
	char	*csOrgCountryId;
	char	*csOrgChannelCode;
	char	*csOrgServiceCode;
	char	*csOrgPayMethod;
	char	*csOrgMerchantId;
	char	*csOrgTxnCcy;
	char	*csTxnCode;
	double	dOrgTxnAmt;

	if (GetField_CString(hContext,"txn_code",&csTxnCode)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() txn_code = [%s]\n",csTxnCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() txn_code not found!!!\n"));
        }

/*org country id */
        if (GetField_CString(hContext,"org_txn_country",&csOrgCountryId)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_country = [%s]\n",csOrgCountryId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_country is missing!!!\n"));
        }


/*org channel code */
        if (GetField_CString(hContext,"org_channel_code",&csOrgChannelCode)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_channel_code = [%s]\n",csOrgChannelCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_channel_code is missing!!!\n"));
        }

/*org sercice code */
        if (GetField_CString(hContext,"org_service_code",&csOrgServiceCode)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_service_code = [%s]\n",csOrgServiceCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_service_code is missing!!!\n"));
        }

/*org pay method */
        if (GetField_CString(hContext,"org_pay_method",&csOrgPayMethod)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_pay_method = [%s]\n",csOrgPayMethod));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspStat() org_pay_method is missing!!!\n"));
        }

/*org merchant id */
        if (GetField_CString(hContext,"org_merchant_id",&csOrgMerchantId)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_merchant_id = [%s]\n",csOrgMerchantId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_merchant_id is missing!!!\n"));
        }

/*org txn ccy */
        if (GetField_CString(hContext,"org_txn_ccy",&csOrgTxnCcy)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_ccy = [%s]\n",csOrgTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_ccy is missing!!!\n"));
        }


/*org psp txn amount */
        if (GetField_Double(hContext,"org_txn_amt",&dOrgTxnAmt)) {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_amt = [%lf]\n",dOrgTxnAmt));
        }
	else {
DEBUGLOG(("BOStat:UpdateDspMerchantStat() org_txn_amt is missing!!!\n"));
	}

	DBObjPtr = CreateObj(DBPtr,"DBTxnCounters","CounterCreate");
        if ((*DBObjPtr)(csTxnCode,
                        csOrgCountryId,
			csOrgChannelCode,
			csOrgServiceCode,
			csOrgPayMethod,
			'M',
                        csOrgMerchantId,
                        csOrgTxnCcy,
                        dOrgTxnAmt,
                        PD_UPDATE_USER) != PD_OK) {
                iRet = INT_ERR;
DEBUGLOG(("BOStat:UpdateDspMerchantStat() CounterCreate Failed\n"));
        }
DEBUGLOG(("BOStat:UpdateDspMerchantStat() iRet = [%d]\n",iRet));
	return iRet;
}

int UpdateDspReqStat(hash_t *hContext,
                        const hash_t *hRequest,
                        const hash_t *hResponse)
{
	int	iRet = PD_OK;
	char	*csOrgCountryId;
	char	*csOrgChannelCode;
	char	*csOrgServiceCode;
	char	*csOrgPayMethod;
	char	*csOrgPspId;
	char	*csOrgTxnCcy;
	char	*csOrgDstTxnCcy;
	char	*csTxnCode;
	char	csTxnCodeNew[PD_TXN_CODE_LEN +1];
	double	dOrgDstTxnAmt;


        if (GetField_CString(hContext,"txn_code",&csTxnCode)) {
DEBUGLOG(("BOStat:UpdateDspReqStat() txn_code = [%s]\n",csTxnCode));
		if (!strcmp(csTxnCode,PD_INITIAL_REQ_TXN_CODE)) {
                        strcpy(csTxnCodeNew,PD_INITIAL_TXN_CODE);
                }
                else
                        strcpy(csTxnCodeNew,csTxnCode);
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqStat() txn_code not found!!!\n"));
        }

/*org country id */
        if (GetField_CString(hContext,"org_txn_country",&csOrgCountryId)) {
DEBUGLOG(("BOStat:UpdateDspReqStat() org_txn_country = [%s]\n",csOrgCountryId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqStat() org_txn_country is missing!!!\n"));
        }

/*org channel code */
        if (GetField_CString(hContext,"org_channel_code",&csOrgChannelCode)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_channel_code = [%s]\n",csOrgChannelCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_channel_code is missing!!!\n"));
        }

/*org sercice code */
        if (GetField_CString(hContext,"org_service_code",&csOrgServiceCode)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_service_code = [%s]\n",csOrgServiceCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_service_code is missing!!!\n"));
        }

/*selected pay method */
        if (GetField_CString(hContext,"selected_pay_method",&csOrgPayMethod)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_pay_method = [%s]\n",csOrgPayMethod));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_pay_method is missing!!!\n"));
		iRet = INT_ERR;
        }



/*psp id */
        if (GetField_CString(hContext,"psp_id",&csOrgPspId)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() psp_id = [%s]\n",csOrgPspId));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() _psp_id is missing!!!\n"));
        }

/*org txn ccy */
        if (GetField_CString(hContext,"org_txn_ccy",&csOrgTxnCcy)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_txn_ccy = [%s]\n",csOrgTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() org_txn_ccy is missing!!!\n"));
        }

/*org psp_txn ccy */
        if (GetField_CString(hContext,"dst_txn_ccy",&csOrgDstTxnCcy)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() dst_txn_ccy = [%s]\n",csOrgDstTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateReqDspStat() dst_txn_ccy is missing!!!\n"));
	}


/*org psp txn amount */
        if (GetField_Double(hContext,"dst_txn_amt",&dOrgDstTxnAmt)) {
DEBUGLOG(("BOStat:UpdateReqDspStat() dst_txn_amt = [%lf]\n",dOrgDstTxnAmt));
        }
	else {
DEBUGLOG(("BOStat:UpdateReqDspStat() dst_txn_amt is missing!!!\n"));
	}

	if(iRet == PD_OK){
		DBObjPtr = CreateObj(DBPtr,"DBTxnCounters","ReqCounterCreate");
		if ((*DBObjPtr)(csTxnCodeNew,
			csOrgCountryId,
			csOrgChannelCode,
			csOrgServiceCode,
			csOrgPayMethod,
			'P',
                        csOrgPspId,
                        csOrgDstTxnCcy,
			dOrgDstTxnAmt,
                        PD_UPDATE_USER) != PD_OK) {
                	iRet = INT_ERR;
DEBUGLOG(("BOStat:UpdateReqDspStat() CounterCreate Failed\n"));
		}
        }

DEBUGLOG(("BOStat:UpdateReqDspStat() iRet = [%d]\n",iRet));
	return iRet;
}

int UpdateDspReqMerchantStat(hash_t *hContext,
                        const hash_t *hRequest,
                        const hash_t *hResponse)
{
	int	iRet = PD_OK;
	char	*csOrgCountryId;
	char	*csOrgChannelCode;
	char	*csOrgServiceCode;
	char	*csOrgPayMethod;
	char	*csOrgMerchantId;
	char	*csOrgTxnCcy;
	char	*csTxnCode;
	char	csTxnCodeNew[PD_TXN_CODE_LEN +1];
	double	dOrgTxnAmt;

	if (GetField_CString(hContext,"txn_code",&csTxnCode)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() txn_code = [%s]\n",csTxnCode));
		if (!strcmp(csTxnCode,PD_INITIAL_REQ_TXN_CODE)) {
			strcpy(csTxnCodeNew,PD_INITIAL_TXN_CODE);
		}
		else 
			strcpy(csTxnCodeNew,csTxnCode);
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() txn_code not found!!!\n"));
        }


/*org country id */
        if (GetField_CString(hContext,"org_txn_country",&csOrgCountryId)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_country = [%s]\n",csOrgCountryId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_country is missing!!!\n"));
        }


/*org channel code */
        if (GetField_CString(hContext,"org_channel_code",&csOrgChannelCode)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_channel_code = [%s]\n",csOrgChannelCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_channel_code is missing!!!\n"));
        }

/*org sercice code */
        if (GetField_CString(hContext,"org_service_code",&csOrgServiceCode)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_service_code = [%s]\n",csOrgServiceCode));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_service_code is missing!!!\n"));
        }

/*org pay method */
        if (GetField_CString(hContext,"selected_pay_method",&csOrgPayMethod)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_pay_method = [%s]\n",csOrgPayMethod));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_pay_method is missing!!!\n"));
        }

/*org merchant id */
        if (GetField_CString(hContext,"org_merchant_id",&csOrgMerchantId)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_merchant_id = [%s]\n",csOrgMerchantId));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_merchant_id is missing!!!\n"));
        }

/*org txn ccy */
        if (GetField_CString(hContext,"org_txn_ccy",&csOrgTxnCcy)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_ccy = [%s]\n",csOrgTxnCcy));
        }
        else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_ccy is missing!!!\n"));
        }


/*org psp txn amount */
        if (GetField_Double(hContext,"org_txn_amt",&dOrgTxnAmt)) {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_amt = [%lf]\n",dOrgTxnAmt));
        }
	else {
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() org_txn_amt is missing!!!\n"));
	}

	DBObjPtr = CreateObj(DBPtr,"DBTxnCounters","ReqCounterCreate");
        if ((*DBObjPtr)(csTxnCodeNew,
                        csOrgCountryId,
			csOrgChannelCode,
			csOrgServiceCode,
			csOrgPayMethod,
			'M',
                        csOrgMerchantId,
                        csOrgTxnCcy,
                        dOrgTxnAmt,
                        PD_UPDATE_USER) != PD_OK) {
                iRet = INT_ERR;
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() CounterCreate Failed\n"));
        }
DEBUGLOG(("BOStat:UpdateDspReqMerchantStat() iRet = [%d]\n",iRet));
	return iRet;
}

